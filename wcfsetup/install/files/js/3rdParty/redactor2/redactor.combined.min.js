// redactor.combined.min.js -- DO NOT EDIT

// redactor.js
(function (window, undefined) { !function(t){"use strict";function e(t,i){return new e.prototype.init(t,i)}var i,n;Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;return function(){return e.apply(t)}}),i=0,n=null,"function"==typeof window.require&&require(["Environment"],(function(t){n=t})),t.fn.redactor=function(i){var n=[],r=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each((function(){var e,s,o=t.data(this,"redactor");"-1"!==i.search(/\./)?void 0!==o[(e=i.split("."))[0]]&&(e=o[e[0]][e[1]]):e=o[i],void 0!==o&&t.isFunction(e)?void 0!==(s=e.apply(o,r))&&s!==o&&n.push(s):t.error('No such method "'+i+'" for Redactor')})):this.each((function(){t.data(this,"redactor",{}),t.data(this,"redactor",e(this,i))})),0===n.length?this:1===n.length?n[0]:n},t.Redactor=e,t.Redactor.VERSION="2.99",t.Redactor.modules=["air","autosave","block","buffer","build","button","caret","clean","code","core","detect","dropdown","events","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","marker","modal","observe","offset","paragraphize","paste","placeholder","progress","selection","shortcuts","storage","toolbar","upload","uploads3","utils","browser"],t.Redactor.settings={},t.Redactor.opts={animation:!1,lang:"en",direction:"ltr",spellcheck:!0,overrideStyles:!0,stylesClass:!1,scrollTarget:document,focus:!1,focusEnd:!1,clickToEdit:!1,structure:!1,tabindex:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:!1,callbacks:{},placeholder:!1,linkify:!0,enterKey:!0,pastePlainText:!1,pasteImages:!0,pasteLinks:!0,pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i"],preClass:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveFields:!1,imageUpload:null,imageUploadParam:"file",imageUploadFields:!1,imageUploadForms:!1,imageTag:"figure",imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",dragImageUpload:!0,multipleImageUpload:!0,clipboardImageUpload:!0,fileUpload:null,fileUploadParam:"file",fileUploadFields:!1,fileUploadForms:!1,dragFileUpload:!0,s3:!1,linkNewTab:!1,linkTooltip:!0,linkNofollow:!1,linkSize:30,linkValidation:!0,pasteLinkTarget:!1,videoContainerClass:"video-container",toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,air:!1,airWidth:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,buttons:["format","bold","italic","deleted","lists","image","file","link","horizontalrule"],buttonsTextLabeled:!1,buttonsHide:[],buttonsHideOnMobile:[],script:!0,removeNewlines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},keepStyleAttr:[],keepInlineOnEnter:!1,shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,activeButtons:["deleted","italic","bold"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted"},langs:{en:{format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U",lists:"Lists","link-insert":"Insert link","link-edit":"Edit link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save",delete:"Delete",text:"Text",edit:"Edit",title:"Title",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line","upload-label":"Drop file here or ",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center","accessibility-help-label":"Rich text editor"}},type:"textarea",inline:!1,inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],paragraphize:!0,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","center","p"],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",emptyHtmlRendered:t("").html("​").html(),imageTypes:["image/png","image/jpeg","image/gif","image/webp"],userAgent:navigator.userAgent.toLowerCase(),observe:{dropdowns:[]},regexps:{linkyoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,linkvimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,linkimage:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},e.fn=t.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(e,n){if(this.$element=t(e),this.uuid=i++,this.sBuffer=[],this.sRebuffer=[],this.loadOptions(n),this.loadModules(),this.opts.clickToEdit&&!this.$element.hasClass("redactor-click-to-edit"))return this.loadToEdit(n);this.$element.hasClass("redactor-click-to-edit")&&this.$element.removeClass("redactor-click-to-edit"),this.reIsBlock=new RegExp("^("+this.opts.blockTags.join("|").toUpperCase()+")$","i"),this.reIsInline=new RegExp("^("+this.opts.inlineTags.join("|").toUpperCase()+")$","i"),this.opts.dragImageUpload=null!==this.opts.imageUpload&&this.opts.dragImageUpload,this.opts.dragFileUpload=null!==this.opts.fileUpload&&this.opts.dragFileUpload,this.formatting={},this.lang.load(),t.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.$editor=this.$element,this.detectType(),this.core.callback("start"),this.core.callback("startToEdit"),this.start=!0,this.build.start()},detectType:function(){this.build.isInline()||this.opts.inline?this.opts.type="inline":this.build.isTag("DIV")?this.opts.type="div":this.build.isTag("PRE")&&(this.opts.type="pre")},loadToEdit:function(e){this.$element.on("click.redactor-click-to-edit",t.proxy((function(){this.initToEdit(e)}),this)),this.$element.addClass("redactor-click-to-edit")},initToEdit:function(e){t.extend(e.callbacks,{startToEdit:function(){this.insert.node(this.marker.get(),!1)},initToEdit:function(){this.selection.restore(),this.clickToCancelStorage=this.code.get(),t(this.opts.clickToCancel).off(".redactor-click-to-edit"),t(this.opts.clickToCancel).show().on("click.redactor-click-to-edit",t.proxy((function(i){i.preventDefault(),this.core.destroy(),this.events.syncFire=!1,this.$element.html(this.clickToCancelStorage),this.core.callback("cancel",this.clickToCancelStorage),this.events.syncFire=!0,this.clickToCancelStorage="",t(this.opts.clickToCancel).hide(),t(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",t.proxy((function(){this.initToEdit(e)}),this)),this.$element.addClass("redactor-click-to-edit")}),this)),t(this.opts.clickToSave).off(".redactor-click-to-edit"),t(this.opts.clickToSave).show().on("click.redactor-click-to-edit",t.proxy((function(i){i.preventDefault(),this.core.destroy(),this.core.callback("save",this.code.get()),t(this.opts.clickToCancel).hide(),t(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",t.proxy((function(){this.initToEdit(e)}),this)),this.$element.addClass("redactor-click-to-edit")}),this))}}),this.$element.redactor(e),this.$element.off(".redactor-click-to-edit")},loadOptions:function(e){var i={};void 0!==t.Redactor.settings.namespace?this.$element.hasClass(t.Redactor.settings.namespace)&&(i=t.Redactor.settings):i=t.Redactor.settings,this.opts=t.extend({},t.Redactor.opts,this.$element.data(),e),this.opts=t.extend({},this.opts,i)},getModuleMethods:function(t){return Object.getOwnPropertyNames(t).filter((function(e){return"function"==typeof t[e]}))},loadModules:function(){var e,i=t.Redactor.modules.length;for(e=0;e<i;e++)this.bindModuleMethods(t.Redactor.modules[e])},bindModuleMethods:function(t){var e,i,n;if(void 0!==this[t])for(this[t]=this[t](),i=(e=this.getModuleMethods(this[t])).length,n=0;n<i;n++)this[t][e[n]]=this[t][e[n]].bind(this)},air:function(){return{enabled:!1,collapsed:function(){},collapsedEnd:function(){},build:function(){},append:function(){},createContainer:function(){},show:function(){},bindHide:function(){},hide:function(){}}},autosave:function(){return{enabled:!1,html:!1,init:function(){},is:function(){},send:function(){},getHiddenFields:function(){},success:function(){},disable:function(){}}},block:function(){return{format:function(e,i,n,r){if(e="quote"===e?"blockquote":e,this.block.tags=["p","blockquote","pre","h1","h2","h3","h4","h5","h6","div","figure"],-1!==t.inArray(e,this.block.tags))return"p"===e&&void 0===i&&(i="class"),this.buffer.set(),this.utils.isCollapsed()?this.block.formatCollapsed(e,i,n,r):this.block.formatUncollapsed(e,i,n,r)},formatCollapsed:function(e,i,n,r){var s,o,a,l,c,h;if(this.selection.save(),o=(s=this.selection.block()).tagName.toLowerCase(),-1!==t.inArray(o,this.block.tags)){if(a=!1,o===e&&void 0===i&&(e="p",a=!0),a&&(this.block.removeAllClass(),this.block.removeAllAttr()),"blockquote"===o&&this.utils.isEndOfElement(s)?(this.marker.remove(),(l=document.createElement("p")).innerHTML=this.opts.invisibleSpace,t(s).after(l),this.caret.start(l),0!==(c=t(s).children().last()).length&&"BR"===c[0].tagName&&c.remove()):l=this.utils.replaceToTag(s,e),"object"==typeof i)for(h in r=n,i)l=this.block.setAttr(l,h,i[h],r);else l=this.block.setAttr(l,i,n,r);return"pre"===e&&1===l.length&&t(l).html(t.trim(t(l).html())),this.selection.restore(),this.block.removeInlineTags(l),l}this.selection.restore()},formatUncollapsed:function(e,i,n,r){var s,o,a,l,c,h,d,u;for(this.selection.save(),s=[],(o=this.selection.blocks())[0]&&(t(o[0]).hasClass("redactor-in")||t(o[0]).hasClass("redactor-box"))&&(o=this.core.editor().find(this.opts.blockTags.join(", "))),a=o.length,l=0;l<a;l++)if(c=o[l].tagName.toLowerCase(),-1!==t.inArray(c,this.block.tags)&&"figure"!==c){if(h=this.utils.replaceToTag(o[l],e),"object"==typeof i)for(d in r=n,i)h=this.block.setAttr(h,d,i[d],r);else h=this.block.setAttr(h,i,n,r);s.push(h),this.block.removeInlineTags(h)}return this.selection.restore(),"pre"===e&&0!==s.length&&(u=s[0],t.each(s,(function(e,i){0!==e&&(t(u).append("\n"+t.trim(i.html())),t(i).remove())})),(s=[]).push(u)),s},removeInlineTags:function(e){var i,n,r;e=e[0]||e,i=this.opts.inlineTags,n=["PRE","H1","H2","H3","H4","H5","H6"],-1!==t.inArray(e.tagName,n)&&("PRE"!==e.tagName&&(r=i.indexOf("a"),i.splice(r,1)),t(e).find(i.join(",")).not(".redactor-selection-marker").contents().unwrap())},setAttr:function(t,e,i,n){if(void 0===e)return t;var r=void 0===n?"replace":n;return t="class"===e?this.block[r+"Class"](i,t):"remove"===r||"removeAll"===r?this.block[r+"Attr"](e,t):this.block[r+"Attr"](e,i,t)},getBlocks:function(e){var i,n;return e=void 0===e?this.selection.blocks():e,t(e).hasClass("redactor-box")?(i=[],n=this.core.editor().children(),t.each(n,t.proxy((function(t,e){this.utils.isBlock(e)&&i.push(e)}),this)),i):e},replaceClass:function(e,i){return t(this.block.getBlocks(i)).removeAttr("class").addClass(e)[0]},toggleClass:function(e,i){return t(this.block.getBlocks(i)).toggleClass(e)[0]},addClass:function(e,i){return t(this.block.getBlocks(i)).addClass(e)[0]},removeClass:function(e,i){return t(this.block.getBlocks(i)).removeClass(e)[0]},removeAllClass:function(e){return t(this.block.getBlocks(e)).removeAttr("class")[0]},replaceAttr:function(e,i,n){return n=this.block.removeAttr(e,n),t(n).attr(e,i)[0]},toggleAttr:function(e,i,n){var r,s;return n=this.block.getBlocks(n),r=this,s=[],t.each(n,(function(n,o){t(o).attr(e)?s.push(r.block.removeAttr(e,o)):s.push(r.block.addAttr(e,i,o))})),s},addAttr:function(e,i,n){return t(this.block.getBlocks(n)).attr(e,i)[0]},removeAttr:function(e,i){return t(this.block.getBlocks(i)).removeAttr(e)[0]},removeAllAttr:function(e){e=this.block.getBlocks(e);var i=[];return t.each(e,(function(t,e){if(void 0!==e.attributes)for(;e.attributes.length;)e.removeAttribute(e.attributes[0].name);i.push(e)})),i}}},buffer:function(){return{set:function(t){void 0===t&&this.buffer.clear(),void 0===t||"undo"===t?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){var t=this.selection.saveInstant(),e=this.sBuffer[this.sBuffer.length-1],i=this.core.editor().html(),n=void 0===e||e[0]!==i;n&&this.sBuffer.push([i,t])},setRedo:function(){var t=this.selection.saveInstant();this.sRebuffer.push([this.core.editor().html(),t])},add:function(){this.sBuffer.push([this.core.editor().html(),0])},undo:function(){if(0!==this.sBuffer.length){var t=this.sBuffer.pop();this.buffer.set("redo"),this.core.editor().html(t[0]),this.selection.restoreInstant(t[1]),this.selection.restore(),this.observe.load()}},redo:function(){if(0!==this.sRebuffer.length){var t=this.sRebuffer.pop();this.buffer.set("undo"),this.core.editor().html(t[0]),this.selection.restoreInstant(t[1]),this.selection.restore(),this.observe.load()}},clear:function(){this.sRebuffer=[]}}},build:function(){return{start:function(){if("textarea"!==this.opts.type)throw new Error("Only `<textarea>` types are allowed.");this.build.startTextarea(),this.build.setIn(),this.build.setId(),this.build.enableEditor(),this.build.setOptions(),this.build.callEditor()},createContainerBox:function(){this.$box=t('<div class="redactor-box" role="application" />')},setIn:function(){this.core.editor().addClass("redactor-in")},setId:function(){var t="textarea"===this.opts.type?"redactor-uuid-"+this.uuid:this.$element.attr("id");this.core.editor().attr("id",void 0===t?"redactor-uuid-"+this.uuid:t)},getName:function(){var t=this.$element.attr("name");return void 0===t?"content-"+this.uuid:t},buildTextarea:function(){},loadFromTextarea:function(){this.$editor=t("<div />"),this.$textarea=this.$element,this.$element.attr("name",this.build.getName()),this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.build.setStartAttrs(),this.$editor.addClass("redactor-layer"),this.opts.overrideStyles&&this.$editor.addClass("redactor-styles"),this.$element.hide(),this.$box.prepend('<span class="redactor-voice-label" id="redactor-voice-'+this.uuid+'" aria-hidden="false">'+this.lang.get("accessibility-help-label")+"</span>")},setStartAttrs:function(){this.$editor.attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},startTextarea:function(){this.build.createContainerBox(),this.build.loadFromTextarea(),this.code.start(this.core.textarea().val()),this.core.textarea().val(this.clean.onSync(this.$editor.html()))},isTag:function(t){return this.$element[0].tagName===t},isInline:function(){return!this.build.isTag("TEXTAREA")&&!this.build.isTag("DIV")&&!this.build.isTag("PRE")},enableEditor:function(){this.core.editor().attr({contenteditable:!0})},setOptions:function(){"inline"===this.opts.type&&(this.opts.enterKey=!1),"inline"!==this.opts.type&&"pre"!==this.opts.type||(this.opts.toolbarMobile=!1,this.opts.toolbar=!1),this.core.editor().attr("spellcheck",this.opts.spellcheck),this.opts.structure&&this.core.editor().addClass("redactor-structure"),this.opts.stylesClass&&this.core.editor().addClass(this.opts.stylesClass),"textarea"===this.opts.type&&(this.core.box().attr("dir",this.opts.direction),this.core.editor().attr("dir",this.opts.direction),this.opts.tabindex&&this.core.editor().attr("tabindex",this.opts.tabindex),this.opts.minHeight?this.core.editor().css("min-height",this.opts.minHeight):this.core.editor().css("min-height","40px"),this.opts.maxHeight&&this.core.editor().css("max-height",this.opts.maxHeight),this.opts.maxWidth&&this.core.editor().css({"max-width":this.opts.maxWidth,margin:"auto"}))},callEditor:function(){this.build.disableBrowsersEditing(),this.events.init(),this.build.setHelpers(),this.toolbarsButtons=this.button.init(),this.toolbar.build(),this.core.editor().on("mouseup.redactor-observe."+this.uuid+" keyup.redactor-observe."+this.uuid+" focus.redactor-observe."+this.uuid+" touchstart.redactor-observe."+this.uuid,t.proxy(this.observe.toolbar,this)),this.core.element().on("blur.callback.redactor",t.proxy((function(){this.button.setInactiveAll()}),this)),this.modal.templates(),this.build.plugins(),this.code.html=this.code.cleaned(this.core.editor().html()),this.core.callback("init"),this.core.callback("initToEdit"),this.start=!1},setHelpers:function(){this.opts.focus?setTimeout(this.focus.start,100):this.opts.focusEnd&&setTimeout(this.focus.end,100)},disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1)}catch(t){}},plugins:function(){this.opts.plugins&&t.each(this.opts.plugins,t.proxy((function(i,n){var r,s,o,a,l,c="undefined"!=typeof RedactorPlugins&&void 0!==RedactorPlugins[n]?RedactorPlugins:e.fn;if(t.isFunction(c[n])){for(this[n]=c[n](),s=(r=this.getModuleMethods(this[n])).length,o=0;o<s;o++)this[n][r[o]]=this[n][r[o]].bind(this);void 0!==this[n].langs&&(a={},void 0!==this[n].langs[this.opts.lang]?a=this[n].langs[this.opts.lang]:void 0===this[n].langs[this.opts.lang]&&void 0!==this[n].langs.en&&(a=this[n].langs.en),l=this,t.each(a,(function(t,e){void 0===l.opts.curLang[t]&&(l.opts.curLang[t]=e)}))),"function"==typeof this[n].init&&this[n].init()}}),this))}}},button:function(){return{toolbar:function(){return void 0!==this.button.$toolbar&&this.button.$toolbar?this.button.$toolbar:this.$toolbar},init:function(){return{format:{title:this.lang.get("format"),icon:!0,dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("heading1"),func:"block.format"},h2:{title:this.lang.get("heading2"),func:"block.format"},h3:{title:this.lang.get("heading3"),func:"block.format"},h4:{title:this.lang.get("heading4"),func:"block.format"},h5:{title:this.lang.get("heading5"),func:"block.format"},h6:{title:this.lang.get("heading6"),func:"block.format"}}},bold:{title:this.lang.get("bold-abbr"),icon:!0,label:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic-abbr"),icon:!0,label:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted-abbr"),icon:!0,label:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline-abbr"),icon:!0,label:this.lang.get("underline"),func:"inline.format"},lists:{title:this.lang.get("lists"),icon:!0,dropdown:{unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},ul:{title:"&bull; "+this.lang.get("bulletslist"),icon:!0,func:"list.toggle"},ol:{title:"1. "+this.lang.get("numberslist"),icon:!0,func:"list.toggle"},outdent:{title:this.lang.get("outdent"),icon:!0,func:"indent.decrease"},indent:{title:this.lang.get("indent"),icon:!0,func:"indent.increase"},image:{title:this.lang.get("image"),icon:!0,func:"image.show"},file:{title:this.lang.get("file"),icon:!0,func:"file.show"},link:{title:this.lang.get("link"),icon:!0,dropdown:{link:{title:this.lang.get("link-insert"),func:"link.show",observe:{element:"a",in:{title:this.lang.get("link-edit")},out:{title:this.lang.get("link-insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},horizontalrule:{title:this.lang.get("horizontalrule"),icon:!0,func:"line.insert"}}},setFormatting:function(){for(var t in this.toolbarsButtons.format.dropdown)this.toolbarsButtons.format.dropdown.hasOwnProperty(t)&&-1===this.opts.formatting.indexOf(t)&&delete this.toolbarsButtons.format.dropdown[t]},hideButtons:function(){0!==this.opts.buttonsHide.length&&this.button.hideButtonsSlicer(this.opts.buttonsHide)},hideButtonsOnMobile:function(){this.detect.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&this.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile)},hideButtonsSlicer:function(e){t.each(e,t.proxy((function(t,e){var i=this.opts.buttons.indexOf(e);-1!==i&&this.opts.buttons.splice(i,1)}),this))},load:function(t){this.button.buttons=[],this.opts.buttons.forEach(function(e){if(("image"!==e||this.image.is())&&this.toolbarsButtons.hasOwnProperty(e)){var i=elCreate("li");i.appendChild(this.button.build(e,this.toolbarsButtons[e])[0]),t[0].appendChild(i)}}.bind(this))},buildButtonTooltip:function(){},build:function(e,i){var n,r=t('<a href="javascript:void(null);" rel="'+e+'" />');return r.addClass("re-button re-"+e),r.attr({role:"button",tabindex:"-1"}),r.html(i.title),(i.func||i.command||i.dropdown)&&this.button.setEvent(r,e,i),i.dropdown&&(r.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0),n=t('<ul class="dropdownMenu redactor-dropdown-menu redactor-dropdown-menu-'+r[0].rel+'" data-dropdown-allow-flip="horizontal" data-dropdown-ignore-page-scroll="true" />'),r.data("dropdown",n),this.dropdown.build(e,n,i.dropdown),this.button.setupDropdown(r[0],n[0])),this.button.buttons.push(r),r},setupDropdown:function(t,e){require(["Ui/SimpleDropdown"],function(i){i.initFragment(t,e),i.registerCallback(t.id,function(t,e){"close"===e&&this.dropdown.hideOut()}.bind(this)),elData(t,"a11y-mouse-event","mousedown"),elData(t,"aria-expanded",!1),t.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation()}))}.bind(this))},getButtons:function(){return this.button.toolbar().find("a.re-button")},getButtonsKeys:function(){return this.button.buttons},setEvent:function(e,i,n){e.on("mousedown",t.proxy((function(t){var r,s;return t.preventDefault(),e.hasClass("redactor-button-disabled")||(r="func",s=n.func,n.command?(r="command",s=n.command):n.dropdown&&(r="dropdown",s=!1),this.button.toggle(t,i,r,s)),!1}),this))},toggle:function(t,e,i,n,r){!this.detect.isIe()&&this.detect.isDesktop()||(this.utils.freezeScroll(),t.returnValue=!1),"command"===i?this.inline.format(n):"dropdown"===i?this.dropdown.show(t,e):this.button.clickCallback(t,n,e,r),"dropdown"!==i&&this.dropdown.hideAll(!1),!this.detect.isIe()&&this.detect.isDesktop()||this.utils.unfreezeScroll()},clickCallback:function(e,i,n,r){var s;if(e instanceof Event?e.preventDefault():e&&e.originalEvent&&e.originalEvent.preventDefault(),r=void 0===r?n:r,t.isFunction(i))i.call(this,n);else if("-1"!==i.search(/\./)){if(void 0===this[(s=i.split("."))[0]])return;"object"==typeof r?this[s[0]][s[1]].apply(this,r):this[s[0]][s[1]].call(this,r)}else"object"==typeof r?this[i].apply(this,r):this[i].call(this,r);this.observe.buttons(e,n)},all:function(){return this.button.buttons},get:function(t){if(!1!==this.opts.toolbar)return this.button.toolbar().find("a.re-"+t)},set:function(t,e){if(!1!==this.opts.toolbar){var i=this.button.toolbar().find("a.re-"+t);return i.html(e).attr("aria-label",e),i}},add:function(e,i){if(!0!==this.button.isAdded(e))return t();var n=this.button.build(e,{title:i});return this.button.toolbar().append(t("<li>").append(n)),n},addFirst:function(e,i){if(!0!==this.button.isAdded(e))return t();var n=this.button.build(e,{title:i});return this.button.toolbar().prepend(t("<li>").append(n)),n},addAfter:function(e,i,n){var r,s;return!0!==this.button.isAdded(i)?t():(r=this.button.build(i,{title:n}),0!==(s=this.button.get(e)).length?s.parent().after(t("<li>").append(r)):this.button.toolbar().append(t("<li>").append(r)),r)},addBefore:function(e,i,n){var r,s;return!0!==this.button.isAdded(i)?t():(r=this.button.build(i,{title:n}),0!==(s=this.button.get(e)).length?s.parent().before(t("<li>").append(r)):this.button.toolbar().append(t("<li>").append(r)),r)},isAdded:function(t){var e=this.opts.buttonsHideOnMobile.indexOf(t);return!(!1===this.opts.toolbar||-1!==e&&this.detect.isMobile())},setIcon:function(t,e){this.opts.buttonsTextLabeled||t.html(e).addClass("re-button-icon")},changeIcon:function(t,e){var i=this.button.get(t);0!==i.length&&i.find("i").removeAttr("class").addClass("re-icon-"+e)},addCallback:function(e,i){var n,r;void 0!==e&&!1!==this.opts.toolbar&&(n="dropdown"===i?"dropdown":"func",r=e.attr("rel"),e.on("mousedown",t.proxy((function(t){if(e.hasClass("redactor-button-disabled"))return!1;this.button.toggle(t,r,n,i)}),this)))},addDropdown:function(e,i){var n,r;if(!1!==this.opts.toolbar)return e.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0),n=e.attr("rel"),this.button.addCallback(e,"dropdown"),r=t('<ul class="dropdownMenu redactor-dropdown-menu redactor-dropdown-menu-'+n+'" data-dropdown-allow-flip="horizontal" data-dropdown-ignore-page-scroll="true" />'),e.data("dropdown",r),i&&(this.dropdown.build(n,r,i),this.button.setupDropdown(e[0],r[0])),r},setActive:function(t){this.button.get(t).addClass("redactor-act").attr({"aria-pressed":!0,tabindex:0})},setInactive:function(t){this.button.get(t).removeClass("redactor-act").attr({"aria-pressed":!1,tabindex:"html"===t?0:-1})},setInactiveAll:function(t){var e=this.button.toolbar().find("a.re-button");void 0!==t&&(e=e.not(".re-"+t)),e.removeClass("redactor-act").attr({"aria-pressed":!1,tabindex:"html"===t?0:-1})},disable:function(t){this.button.get(t).addClass("redactor-button-disabled").attr("aria-disabled",!0)},enable:function(t){this.button.get(t).removeClass("redactor-button-disabled").attr("aria-disabled",!1)},disableAll:function(t){var e=this.button.toolbar().find("a.re-button");void 0!==t&&(Array.isArray(t)||(t=[t]),t=t.map((function(t){return".re-"+t})),e=e.not(t.join(","))),e.addClass("redactor-button-disabled").attr("aria-disabled",!0)},enableAll:function(){this.button.toolbar().find("a.re-button").removeClass("redactor-button-disabled").attr("aria-disabled",!1)},remove:function(t){this.button.get(t).remove()}}},caret:function(){return{set:function(t,e,i){var n,r,s=this.core.editor().scrollTop();this.core.editor().focus(),this.core.editor().scrollTop(s),i=void 0===i?0:1,t=t[0]||t,e=e[0]||e,n=this.selection.get(),r=this.selection.range(n);try{r.setStart(t,0),r.setEnd(e,i)}catch(t){}this.selection.update(n,r)},prepare:function(t){return this.detect.isFirefox()&&void 0!==this.start&&this.core.editor().focus(),t[0]||t},start:function(e){var i,n,r,s;if(e=this.caret.prepare(e)){if("BR"===e.tagName)return this.caret.before(e);r=t(e).children().first(),s=this.utils.isInlineTag(e.tagName),""===e.innerHTML||s?this.caret.setStartEmptyOrInline(e,s):r&&0!==r.length&&this.utils.isInlineTag(r[0].tagName)&&""===r.text()?this.caret.setStartEmptyOrInline(r[0],!0):((i=window.getSelection()).removeAllRanges(),(n=document.createRange()).selectNodeContents(e),n.collapse(!0),i.addRange(n))}},setStartEmptyOrInline:function(e,i){var n=window.getSelection(),r=document.createRange(),s=document.createTextNode("​");r.setStart(e,0),r.insertNode(s),r.setStartAfter(s),r.collapse(!0),n.removeAllRanges(),n.addRange(r),i||this.core.editor().on("keydown.redactor-remove-textnode",(function(){t(s).remove(),t(this).off("keydown.redactor-remove-textnode")}))},end:function(e){var i,n,r;if(e=this.caret.prepare(e)){if("BR"!==e.tagName&&""===e.innerHTML)return this.caret.start(e);if("BR"===e.tagName)return(r=document.createElement("span")).className="redactor-invisible-space",r.innerHTML="&#x200b;",t(e).after(r),(i=window.getSelection()).removeAllRanges(),(n=document.createRange()).setStartBefore(r),n.setEndBefore(r),i.addRange(n),void t(r).replaceWith((function(){return t(this).contents()}));if(e.lastChild&&1===e.lastChild.nodeType)return this.caret.after(e.lastChild);if((i=window.getSelection()).getRangeAt||i.rangeCount)try{(n=i.getRangeAt(0)).selectNodeContents(e),n.collapse(!1),i.removeAllRanges(),i.addRange(n)}catch(t){}}},after:function(e){var i,n,r,s;if(e=this.caret.prepare(e))return"BR"===e.tagName?this.caret.end(e):void(this.utils.isBlockTag(e.tagName)?void 0===(r=this.caret.next(e))?this.caret.end(e):("TABLE"===r.tagName?r=t(r).find("th, td").first()[0]:"UL"!==r.tagName&&"OL"!==r.tagName||(r=t(r).find("li").first()[0]),this.caret.start(r)):(r=this.caret.next(e))&&"BR"===r.nodeName?this.caret.before(r):(s=document.createTextNode("​"),(i=window.getSelection()).removeAllRanges(),(n=document.createRange()).setStartAfter(e),n.insertNode(s),n.setStartAfter(s),n.collapse(!0),i.addRange(n)))},before:function(e){var i,n,r;(e=this.caret.prepare(e))&&(this.utils.isBlockTag(e.tagName)?void 0===(r=this.caret.prev(e))?this.caret.start(e):("TABLE"===r.tagName?r=t(r).find("th, td").last()[0]:"UL"!==r.tagName&&"OL"!==r.tagName||(r=t(r).find("li").last()[0]),this.caret.end(r)):((i=window.getSelection()).removeAllRanges(),(n=document.createRange()).setStartBefore(e),n.collapse(!0),i.addRange(n)))},next:function(e){var i=t(e).next();return i.hasClass("redactor-script-tag, redactor-selection-marker")?i.next()[0]:i[0]},prev:function(e){var i=t(e).prev();return i.hasClass("redactor-script-tag, redactor-selection-marker")?i.prev()[0]:i[0]},offset:function(t){return this.offset.get(t)}}},clean:function(){return{onSet:function(e){var i,n,r,s,o;return e=this.clean.savePreCode(e),this.opts.script&&(e=e.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" $1>$2</pre>')),e=(e=(e=(e=(e=e.replace(/\$/g,"&#36;")).replace(/&amp;/g,"&")).replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">')).replace(/<span id="selection-marker-1"(.*?[^>]?)>​<\/span>/gi,"###marker1###")).replace(/<span id="selection-marker-2"(.*?[^>]?)>​<\/span>/gi,"###marker2###"),i=this,n=t("<div/>").html(t.parseHTML(e,document,!0)),(r=this.opts.replaceTags)&&(s=Object.keys(this.opts.replaceTags),n.find(s.join(",")).each((function(t,e){i.utils.replaceToTag(e,r[e.tagName.toLowerCase()])}))),n.find("span, a").attr("data-redactor-span",!0),n.find(this.opts.inlineTags.join(",")).each((function(){var e=t(this);e.attr("style")&&e.attr("data-redactor-style-cache",e.attr("style"))})),e=n.html(),o=["font","html","head","link","body","meta","applet"],this.opts.script||o.push("script"),e=this.clean.stripTags(e,o),this.opts.removeComments&&(e=e.replace(/<!--[\s\S]*?-->/gi,"")),-1!==(e=(e=(e=this.paragraphize.load(e)).replace("###marker1###",'<span id="selection-marker-1" class="redactor-selection-marker">​</span>')).replace("###marker2###",'<span id="selection-marker-2" class="redactor-selection-marker">​</span>')).search(/^(||\s||<br\s?\/?>||&nbsp;)$/i)?this.opts.emptyHtml:e},onGet:function(t){return this.clean.onSync(t)},onSync:function(e){var i,n;return-1!==(e=(e=e.replace(/\u200B/g,"")).replace(/&#x200b;/gi,"")).search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i)?"":(e=(e=(e=(e=e.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>")).replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<img(.*?)style="(.*?)opacity: 0\.5;(.*?)"(.*?)>/gi,'<img$1style="$2$3"$4>'),(i=t("<div/>").html(t.parseHTML(e,document,!0))).find('*[style=""]').removeAttr("style"),i.find('*[class=""]').removeAttr("class"),i.find('*[rel=""]').removeAttr("rel"),i.find('*[data-image=""]').removeAttr("data-image"),i.find('*[alt=""]').removeAttr("alt"),i.find('*[title=""]').removeAttr("title"),i.find("*[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),i.find(".redactor-invisible-space, .redactor-unlink").each((function(){t(this).contents().unwrap()})),i.find("span, a").removeAttr("data-redactor-span data-redactor-style-cache").each((function(){0===this.attributes.length&&t(this).contents().unwrap()})),i.find("img").removeAttr("rel"),i.find(".redactor-selection-marker, #redactor-insert-marker").remove(),e=i.html(),this.opts.script&&(e=e.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2<\/script>")),e=(e=(e=(e=(e=this.clean.restoreFormTags(e)).replace(new RegExp("<br\\s?/?></h","gi"),"</h")).replace(new RegExp("<br\\s?/?></li>","gi"),"</li>")).replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")).replace(/<pre>/gi,"<pre>\n"),this.opts.preClass&&(e=e.replace(/<pre>/gi,'<pre class="'+this.opts.preClass+'">')),this.opts.linkNofollow&&(e=(e=e.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>")).replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),n={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"},t.each(n,(function(t,i){e=e.replace(new RegExp(t,"g"),i)})),e=(e=e.replace(/&amp;/g,"&")).replace(/\n{2,}/g,"\n"),this.opts.removeNewlines&&(e=e.replace(/\r?\n/g,"")),e)},onPaste:function(e,i,n){!0!==n&&(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<o:p[^>]*>/gi,"")).replace(/<\/o:p>/gi,""),this.clean.isHtmlMsWord(e)&&(e=this.clean.cleanMsWord(e)));return e=t.trim(e),i.pre?this.opts.preSpaces&&(e=e.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))):(e=this.clean.replaceBrToNl(e),e=this.clean.removeTagsInsidePre(e)),!0!==n&&(e=this.clean.removeEmptyInlineTags(e),!1===i.encode&&(e=e.replace(/&/g,"&amp;"),e=this.clean.convertTags(e,i),e=this.clean.getPlainText(e),e=this.clean.reconvertTags(e,i))),i.text&&(e=this.clean.replaceNbspToSpaces(e),e=this.clean.getPlainText(e)),i.lists&&(e=e.replace("\n","<br>")),i.encode&&(e=this.clean.encodeHtml(e)),i.paragraphize&&(e=(e=e.replace(/ \n/g," ")).replace(/\n /g," "),e=(e=this.paragraphize.load(e)).replace(/<p><\/p>/g,"")),e=(e=e.replace(/<li><p>/g,"<li>")).replace(/<\/p><\/li>/g,"</li>")},getCurrentType:function(t,e){var i=this.selection.blocks(),n={text:!1,encode:!1,paragraphize:!0,line:this.clean.isHtmlLine(t),blocks:this.clean.isHtmlBlocked(t),pre:!1,lists:!1,block:!0,inline:!0,links:!0,images:!0};return 1===i.length&&this.utils.isCurrentOrParent(["h1","h2","h3","h4","h5","h6","a","figcaption"])?(n.text=!0,n.paragraphize=!1,n.inline=!1,n.images=!1,n.links=!1,n.line=!0):"inline"===this.opts.type||!1===this.opts.enterKey?(n.paragraphize=!1,n.block=!1,n.line=!0):1===i.length&&this.utils.isCurrentOrParent(["li"])?(n.lists=!0,n.block=!1,n.paragraphize=!1,n.images=!1):1===i.length&&this.utils.isCurrentOrParent(["th","td","blockquote"])?(n.block=!1,n.paragraphize=!1):("pre"===this.opts.type||1===i.length&&this.utils.isCurrentOrParent("pre"))&&(n.inline=!1,n.block=!1,n.encode=!0,n.pre=!0,n.paragraphize=!1,n.images=!1,n.links=!1),!0===n.line&&(n.paragraphize=!1),!0===e&&(n.text=!1),n},isHtmlBlocked:function(t){var e=t.match(new RegExp("</("+this.opts.blockTags.join("|").toUpperCase()+")>","gi")),i=t.match(new RegExp("<hr(.*?[^>])>","gi"));return null!==e||null!==i},isHtmlLine:function(t){var e,i;return!this.clean.isHtmlBlocked(t)&&(e=t.match(/<br\s?\/?>/gi),i=t.match(/\n/gi),!e&&!i)},isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},removeEmptyInlineTags:function(e){var i=this.opts.inlineTags,n=t("<div/>").html(t.parseHTML(e,document,!0)),r=this,s=n.find("span"),o=n.find(i.join(","));return o.removeAttr("style"),o.each((function(){var e=t(this).html();0===this.attributes.length&&r.utils.isEmpty(e)&&t(this).replaceWith((function(){return t(this).contents()}))})),s.each((function(){t(this).html();0===this.attributes.length&&t(this).replaceWith((function(){return t(this).contents()}))})),e=(e=(e=(e=n.html()).replace("\x3c!--?php","<?php")).replace("\x3c!--?","<?")).replace("?--\x3e","?>"),n.remove(),e},cleanMsWord:function(e){var i,n,r,s;return e=(e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"")).replace(/\n/g," ")).replace(/<\/p>/gi,'</p><p><br data-redactor="br"></p>')).replace(/<\/div>|<\/li>|<\/td>/gi,"\n\n"),i=t("<div/>").html(e),elBySelAll("br",i[0],(function(t){var e,i;if("br"===elData(t,"redactor"))t.removeAttribute("data-redactor");else if((e=t.parentNode)&&"P"===e.nodeName){for(i=elCreate("p");t.nextSibling;)i.appendChild(t.nextSibling);e.parentNode.insertBefore(i,e.nextSibling),elRemove(t)}})),n=!1,r=1,s=[],i.find("p[style]").each((function(){var e,o,a,l,c,h,d,u=t(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(u)if(e=parseInt(u[1]),o=parseInt(u[2]),a=t(this).html().match(/^[\w]+\./)?"ol":"ul",(l=t("<li/>").html(t(this).html())).html(l.html().replace(/^([\w\.]+)</,"<")),l.find("span:first").remove(),1==o&&-1==t.inArray(e,s))c=t("<"+a+"/>").attr({"data-level":o,"data-list":e}).html(l),t(this).replaceWith(c),n=e,s.push(e);else{if(o>r){for(h=i.find('[data-level="'+r+'"][data-list="'+n+'"]'),d=r;d<o;d++)(c=t("<"+a+"/>")).appendTo(h.find("li").last()),h=c;h.attr({"data-level":o,"data-list":e}).html(l)}else i.find('[data-level="'+o+'"][data-list="'+e+'"]').last().append(l);r=o,n=e,t(this).remove()}})),i.find("[data-level][data-list]").removeAttr("data-level data-list"),elBySelAll("ol, ul",i[0],(function(t){["nextElementSibling","previousElementSibling"].forEach((function(e){for(var i=t[e];i&&"P"===i.nodeName&&""===i.className&&"<br>"===i.innerHTML;)elRemove(i),i=t[e]}))})),e=i.html()},replaceNbspToSpaces:function(t){return t.replace("&nbsp;"," ")},replaceBrToNl:function(t){return t.replace(/<br\s?\/?>/gi,"\n")},replaceNlToBr:function(t){return t.replace(/\n/g,"<br />")},convertTags:function(e,i){var n,r,s,o,a,l=t("<div>").html(e);if(l.find("iframe").remove(),(n=l.find("a")).removeAttr("style"),!1!==this.opts.pasteLinkTarget&&n.attr("target",this.opts.pasteLinkTarget),i.links&&this.opts.pasteLinks&&l.find("a").each((function(t,e){var i,n,r,s;if(e.href){for(i='#####[a href="'+e.href+'"',r=0,s=e.attributes.length;r<s;r++)"href"!==(n=e.attributes.item(r)).name&&(i+=" "+n.name+'="'+n.value+'"');e.outerHTML=i+"]#####"+e.innerHTML+"#####[/a]#####"}})),e=l.html(),i.images&&this.opts.pasteImages&&(e=e.replace(/<img(.*?)src="(.*?)"(.*?[^>])>/gi,'#####[img$1src="$2"$3]#####')),this.opts.pastePlainText)return e;for(r=i.lists?["ul","ol","li"]:this.opts.pasteBlockTags,o=(s=i.block||i.lists?i.inline?r.concat(this.opts.pasteInlineTags):r:i.inline?this.opts.pasteInlineTags:[]).length,a=0;a<o;a++)e=e.replace(new RegExp("</"+s[a]+">","gi"),"###/"+s[a]+"###"),e="td"===s[a]||"th"===s[a]?e.replace(new RegExp("<"+s[a]+'(.*?[^>])((colspan|rowspan)="(.*?[^>])")?(.*?[^>])>',"gi"),"###"+s[a]+" $2###"):this.utils.isInlineTag(s[a])?(e=(e=e.replace(new RegExp("<"+s[a]+'([^>]*)class="([^>]*)"[^>]*>',"gi"),"###"+s[a]+' class="$2"###')).replace(new RegExp("<"+s[a]+'([^>]*)data-redactor-style-cache="([^>]*)"[^>]*>',"gi"),"###"+s[a]+' cache="$2"###')).replace(new RegExp("<"+s[a]+"[^>]*>","gi"),"###"+s[a]+"###"):e.replace(new RegExp("<"+s[a]+"[^>]*>","gi"),"###"+s[a]+"###");return e},reconvertTags:function(t,e){var i,n,r,s,o;if((e.links&&this.opts.pasteLinks||e.images&&this.opts.pasteImages)&&(t=(t=t.replace(new RegExp("#####\\[","gi"),"<")).replace(new RegExp("\\]#####","gi"),">")),this.opts.pastePlainText)return t;for(i=e.lists?["ul","ol","li"]:this.opts.pasteBlockTags,r=(n=e.block||e.lists?e.inline?i.concat(this.opts.pasteInlineTags):i:e.inline?this.opts.pasteInlineTags:[]).length,s=0;s<r;s++)t=t.replace(new RegExp("###/"+n[s]+"###","gi"),"</"+n[s]+">");for(s=0;s<r;s++)t=t.replace(new RegExp("###"+n[s]+"###","gi"),"<"+n[s]+">");for(s=0;s<r;s++)"td"===n[s]||"th"===n[s]?t=t.replace(new RegExp("###"+n[s]+"(?:\\s?|\\s([^#]*?))###","gi"),"<"+n[s]+"$1>"):this.utils.isInlineTag(n[s])&&(o="span"===n[s]?' data-redactor-span="true"':"",t=(t=t.replace(new RegExp("###"+n[s]+' cache="(.*?[^#])"###',"gi"),"<"+n[s]+' style="$1"'+o+' data-redactor-style-cache="$1">')).replace(new RegExp("###"+n[s]+"s?(.*?[^#])###","gi"),"<"+n[s]+"$1>"));return t},cleanPre:function(e){e=void 0===e?t(this.selection.block()).closest("pre",this.core.editor()[0]):e,t(e).find("br").replaceWith((function(){return document.createTextNode("\n")})),t(e).find("p").replaceWith((function(){return t(this).contents()}))},removeTagsInsidePre:function(e){var i=t("<div />").append(e);return i.find("pre").replaceWith((function(){var e=t(this).html();return e=(e=e.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/(<([^>]+)>)/gi,""),t("<pre />").append(e)})),e=i.html(),i.remove(),e},getPlainText:function(e){e=(e=(e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<p><\/p>/g,"")).replace(/<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/<\/p>/gi,"\n\n")).replace(/<\/H[1-6]>/gi,"\n\n");var i=document.createElement("div");return i.innerHTML=e,e=i.textContent||i.innerText,t.trim(e)},savePreCode:function(t){return t=this.clean.savePreFormatting(t),t=this.clean.saveCodeFormatting(t),t=this.clean.restoreSelectionMarkers(t)},savePreFormatting:function(e){var i=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null===i||t.each(i,t.proxy((function(t,i){var n,r,s,o=[],a=!1;i.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>/i)?(a=!0,n=(o=i.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>([\w\W]*?)<\/code>(([\n\r\s]+)?)<\/pre>/i))[5],r=o[1],s=o[4]):(n=(o=i.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i))[2],r=o[1]),n=(n=n.replace(/<br\s?\/?>/g,"\n")).replace(/&nbsp;/g," "),this.opts.preSpaces&&(n=n.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),n=(n=this.clean.encodeEntities(n)).replace(/\$/g,"&#36;"),e=a?e.replace(i,"<pre"+r+"><code"+s+">"+n+"</code></pre>"):e.replace(i,"<pre"+r+">"+n+"</pre>")}),this)),e},saveCodeFormatting:function(e){var i=e.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null===i||t.each(i,t.proxy((function(t,i){var n=i.match(/<code(.*?)>([\w\W]*?)<\/code>/i);n[2]=n[2].replace(/&nbsp;/g," "),n[2]=this.clean.encodeEntities(n[2]),n[2]=n[2].replace(/\$/g,"&#36;"),e=e.replace(i,"<code"+n[1]+">"+n[2]+"</code>")}),this)),e},restoreSelectionMarkers:function(t){return t=t.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker">​</span>')},saveFormTags:function(t){return t},restoreFormTags:function(t){return t.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")},encodeHtml:function(t){return t=(t=(t=(t=t.replace(/”/g,'"')).replace(/“/g,'"')).replace(/‘/g,"'")).replace(/’/g,"'"),t=this.clean.encodeEntities(t)},encodeEntities:function(t){return t=(t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},stripTags:function(t,e){if(void 0===e)return t.replace(/(<([^>]+)>)/gi,"");return t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(function(t,i){return-1===e.indexOf(i.toLowerCase())?t:""}))},removeMarkers:function(t){return t.replace(/<span(.*?[^>]?)class="redactor-selection-marker"(.*?[^>]?)>([\w\W]*?)<\/span>/gi,"")},removeSpaces:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=t.trim(e)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g," ")).replace(/[\s\n]*$/g," ")).replace(/>\s{2,}</g,"> <")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},removeSpacesHard:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=t.trim(e)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g,"")).replace(/[\s\n]*$/g,"")).replace(/>\s{2,}</g,"><")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},normalizeCurrentHeading:function(){var t=this.selection.block();this.utils.isCurrentOrParentHeader()&&t&&t.normalize()}}},code:function(){return{syncFire:!0,html:!1,start:function(e){e=(e=t.trim(e)).replace(/^(<span id="selection-marker-1" class="redactor-selection-marker">​<\/span>)/,""),e=(e=this.clean.onSet(e)).replace(/<p><span id="selection-marker-1" class="redactor-selection-marker">​<\/span><\/p>/,""),this.events.stopDetectChanges(),this.core.editor().html(e),this.observe.load(),this.events.startDetectChanges()},set:function(e,i){e=t.trim(e),(i=i||{}).start&&(this.start=i.start),"textarea"===this.opts.type?e=this.clean.onSet(e):"div"===this.opts.type&&""===e&&(e=this.opts.emptyHtml),this.core.editor().html(e),"textarea"===this.opts.type&&this.code.sync()},get:function(){if("textarea"===this.opts.type)return this.core.textarea().val();var t=this.core.editor().html();return t=this.clean.onGet(t)},sync:function(){var e,i;if(this.code.syncFire&&(e=this.core.editor().html(),i=this.code.cleaned(e),!this.code.isSync(i))){if(this.code.html=i,"textarea"!==this.opts.type)return this.core.callback("sync",e),void this.core.callback("change",e);"textarea"===this.opts.type&&setTimeout(t.proxy((function(){this.code.startSync(e)}),this),10)}},startSync:function(t){t=this.core.callback("syncBefore",t),t=this.clean.onSync(t),this.core.textarea().val(t),this.core.callback("sync",t),!1===this.start&&this.core.callback("change",t),this.start=!1},isSync:function(t){var e=!1!==this.code.html&&this.code.html;return!1!==e&&e===t},cleaned:function(t){return t=t.replace(/\u200B/g,""),this.clean.removeMarkers(t)}}},core:function(){return{id:function(){return this.$editor.attr("id")},element:function(){return this.$element},editor:function(){return void 0===this.$editor?t():this.$editor},textarea:function(){return this.$textarea},box:function(){return"textarea"===this.opts.type?this.$box:this.$element},toolbar:function(){return!!this.$toolbar&&this.$toolbar},air:function(){return!!this.$air&&this.$air},object:function(){return t.extend({},this)},structure:function(){this.core.editor().toggleClass("redactor-structure")},addEvent:function(t){this.core.event=t},getEvent:function(){return this.core.event},callback:function(e,i,n){var r,s,o,a,l,c="redactor",h=!1,d=t._data(this.core.element()[0],"events");if(void 0!==d&&void 0!==d[e])for(r=d[e].length,s=0;s<r;s++)d[e][s].namespace==="callback."+c&&(o=d[e][s].handler,h=void 0===(a=void 0===n?[i]:[i,n])?o.call(this,i):o.call(this,i,a));return h||(void 0===this.opts.callbacks[e]?void 0===n?i:n:(l=this.opts.callbacks[e],t.isFunction(l)?void 0===n?l.call(this,i):l.call(this,i,n):void 0===n?i:n))},destroy:function(){var e,i;this.opts.destroyed=!0,this.core.callback("destroy"),t("#redactor-voice-"+this.uuid).remove(),this.core.editor().removeClass("redactor-in redactor-styles redactor-structure redactor-layer-img-edit"),this.core.editor().off("keydown.redactor-remove-textnode"),this.core.editor().off(".redactor-observe."+this.uuid),this.$element.off(".redactor").removeData("redactor"),this.core.editor().off(".redactor"),t(document).off(".redactor-air."+this.uuid),t(document).off("mousedown.redactor-blur."+this.uuid),t(document).off("mousedown.redactor."+this.uuid),t(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),t(window).off(".redactor-toolbar."+this.uuid),t(window).off("touchmove.redactor."+this.uuid),t("body").off("scroll.redactor."+this.uuid),t(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),e=this,!1!==this.opts.plugins&&t.each(this.opts.plugins,(function(i,n){t(window).off(".redactor-plugin-"+n),t(document).off(".redactor-plugin-"+n),t("body").off(".redactor-plugin-"+n),e.core.editor().off(".redactor-plugin-"+n)})),this.$element.off("click.redactor-click-to-edit"),this.$element.removeClass("redactor-click-to-edit"),this.core.editor().removeClass("redactor-layer"),this.core.editor().removeAttr("contenteditable"),i=this.code.get(),this.opts.toolbar&&this.$toolbar&&this.$toolbar.find("a").each((function(){var e=t(this);e.data("dropdown")&&(e.data("dropdown").remove(),e.data("dropdown",{}))})),"textarea"===this.opts.type&&(this.$box.after(this.$element),this.$box.remove(),this.$element.val(i).show()),this.opts.toolbar&&this.$toolbar&&this.$toolbar.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),t(".redactor-link-tooltip").remove()}}},detect:function(){return{isWebkit:function(){return/webkit/.test(this.opts.userAgent)},isFirefox:function(){return this.opts.userAgent.indexOf("firefox")>-1},isIe:function(t){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":((e=RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent))||(e=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),e);var e},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}},dropdown:function(){return{active:!1,button:!1,key:!1,position:[],getDropdown:function(){return this.dropdown.active},build:function(e,i,n){var r,s,o,a,l,c,h=document.createDocumentFragment();for(s in n)n.hasOwnProperty(s)&&(r=n[s],o=this.dropdown.buildItem(s,r),this.observe.addDropdown(t(o),s,r),h.appendChild(o));for(a=!1,l=0,c=h.childNodes.length;l<c;l++)if(h.childNodes[l].nodeType===Node.ELEMENT_NODE){a=!0;break}a&&(i[0].rel=e,i[0].appendChild(h))},buildFormatting:function(){},buildItem:function(e,i){var n=elCreate("li");return void 0!==i.classname&&n.classList.add(i.classname),0===e.toLowerCase().indexOf("divider")?(n.classList.add("redactor-dropdown-divider"),n):(n.innerHTML='<a href="#" class="redactor-dropdown-'+e+'" role="button"><span>'+i.title+"</span></a>",t(n.children[0]).on("mousedown",function(t){t.preventDefault(),this.dropdown.buildClick(t,e,i)}.bind(this)),n)},buildClick:function(e,i,n){if(!t(e.target).hasClass("redactor-dropdown-link-inactive")){var r=this.dropdown.buildCommand(n);void 0!==n.args?this.button.toggle(e,i,r.type,r.callback,n.args):this.button.toggle(e,i,r.type,r.callback)}},buildCommand:function(t){var e={type:"func"};return e.callback=t.func,t.command?(e.type="command",e.callback=t.command):t.dropdown&&(e.type="dropdown",e.callback=t.dropdown),e},show:function(e,i){this.detect.isDesktop()&&this.core.editor().focus(),this.dropdown.hideAll(!1,i),this.dropdown.key=i,this.dropdown.button=this.button.get(this.dropdown.key),require(["Ui/SimpleDropdown"],function(e){var i=this.dropdown.button[0].id;e.toggleDropdown(i),e.isOpen(i)?(this.dropdown.active=t(e.getDropdownMenu(i)),this.core.callback("dropdownShow",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button}),this.button.setActive(this.dropdown.key),this.dropdown.button.addClass("dropact").attr("aria-expanded",!0),this.dropdown.enableCallback()):this.dropdown.hide()}.bind(this)),e.preventDefault()},showIsFixedToolbar:function(){},showIsUnFixedToolbar:function(){},enableEvents:function(){},enableCallback:function(){this.core.callback("dropdownShown",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button})},getButtonPosition:function(){},closeHandler:function(){},hideAll:function(t,e){this.dropdown.hideOut(e)},hide:function(){this.dropdown.hideOut()},hideOut:function(t){if(!1!==this.dropdown.active&&this.dropdown.button[0].rel!==t){this.core.callback("dropdownHide",this.dropdown.active);var e=this.dropdown.button[0].id;require(["Ui/SimpleDropdown"],(function(t){t.close(e)})),this.dropdown.button.removeClass("redactor-act dropact").attr("aria-expanded",!1),this.dropdown.button=!1,this.dropdown.key=!1,this.dropdown.active=!1}}}},events:function(){return{focused:!1,blured:!0,dropImage:!1,stopChanges:!1,stopDetectChanges:function(){this.events.stopChanges=!0},startDetectChanges:function(){var t=this;setTimeout((function(){t.events.stopChanges=!1}),1)},dragover:function(e){e.preventDefault(),"IMG"===e.target.tagName&&t(e.target).addClass("redactor-image-dragover")},dragleave:function(t){this.core.editor().find("img").removeClass("redactor-image-dragover")},drop:function(t){return t=t.originalEvent||t,this.core.editor().find("img").removeClass("redactor-image-dragover"),"inline"===this.opts.type||"pre"===this.opts.type?(t.preventDefault(),!1):void 0===window.FormData||!t.dataTransfer||(0===t.dataTransfer.files.length?this.events.onDrop(t):(this.events.onDropUpload(t),void this.core.callback("drop",t)))},click:function(t){var e=this.core.getEvent(),i="click"!==e&&"arrow"!==e&&"click";this.core.addEvent(i),this.utils.disableSelectAll(),this.core.callback("click",t)},focus:function(t){var e,i;this.rtePaste||(this.events.isCallback("focus")&&this.core.callback("focus",t),this.events.focused=!0,this.events.blured=!1,!1===this.selection.current()&&(e=this.selection.get(),(i=this.selection.range(e)).setStart(this.core.editor()[0],0),i.setEnd(this.core.editor()[0],0),this.selection.update(e,i)))},blur:function(e){this.start||this.rtePaste||0===t(e.target).closest("#"+this.core.id()+", .redactor-toolbar, .redactor-dropdown, #redactor-modal-box").length&&(!this.events.blured&&this.events.isCallback("blur")&&this.core.callback("blur",e),this.events.focused=!1,this.events.blured=!0)},touchImageEditing:function(){var e=-1;this.events.imageEditing=!1,t(window).on("touchmove.redactor."+this.uuid,t.proxy((function(){this.events.imageEditing=!0,-1!==e&&clearTimeout(e),e=setTimeout(t.proxy((function(){this.events.imageEditing=!1}),this),500)}),this))},init:function(){this.core.editor().on("dragover.redactor dragenter.redactor",t.proxy(this.events.dragover,this)),this.core.editor().on("dragleave.redactor",t.proxy(this.events.dragleave,this)),this.core.editor().on("drop.redactor",t.proxy(this.events.drop,this)),this.core.editor().on("click.redactor",t.proxy(this.events.click,this)),this.core.editor().on("paste.redactor",t.proxy(this.paste.init,this)),this.core.editor().on("keydown.redactor",t.proxy(this.keydown.init,this)),this.core.editor().on("keyup.redactor",t.proxy(this.keyup.init,this)),this.core.editor().on("focus.redactor",t.proxy(this.events.focus,this)),t(document).on("mousedown.redactor-blur."+this.uuid,t.proxy(this.events.blur,this)),this.events.touchImageEditing(),this.events.createObserver(),this.events.setupObserver()},createObserver:function(){var e=this;this.events.observer=new MutationObserver((function(i){i.forEach(t.proxy(e.events.iterateObserver,e))}))},iterateObserver:function(t){var e=!1;(("textarea"===this.opts.type||"div"===this.opts.type)&&!this.detect.isFirefox()&&t.target===this.core.editor()[0]||"class"===t.attributeName&&t.target===this.core.editor()[0]||"data-vivaldi-spatnav-clickable"==t.attributeName)&&(e=!0),e||(this.observe.load(),this.events.changeHandler())},setupObserver:function(){this.events.observer.observe(this.core.editor()[0],{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})},changeHandler:function(){this.events.stopChanges||this.code.sync()},onDropUpload:function(t){var e,i,n;if(t.preventDefault(),t.stopPropagation(),(this.opts.dragImageUpload||this.opts.dragFileUpload)&&(null!==this.opts.imageUpload||null!==this.opts.fileUpload))for("IMG"===t.target.tagName&&(this.events.dropImage=t.target),i=(e=t.dataTransfer.files).length,n=0;n<i;n++)this.upload.directUpload(e[n],t)},onDrop:function(t){this.core.callback("drop",t)},isCallback:function(e){return void 0!==this.opts.callbacks[e]&&t.isFunction(this.opts.callbacks[e])},stopDetect:function(){this.events.stopDetectChanges()},startDetect:function(){this.events.startDetectChanges()}}},file:function(){return{is:function(){},show:function(){},insert:function(){},release:function(){},text:function(t){}}},focus:function(){return{start:function(){if(this.core.editor().focus(),"inline"!==this.opts.type){var t=this.focus.first();!1!==t&&this.caret.start(t)}},end:function(){var t,e,i,n;this.core.editor().focus(),0!==(t=this.opts.inline?this.core.editor():this.focus.last()).length&&(e=this.focus.lastChild(t),this.detect.isWebkit()||!1===e?(i=this.selection.get(),null!==(n=this.selection.range(i))?(n.selectNodeContents(t[0]),n.collapse(!1),this.selection.update(i,n)):this.caret.end(t)):this.caret.end(e))},first:function(){var t=this.core.editor().children().first();return(0!==t.length||0!==t[0].length&&"BR"!==t[0].tagName&&"HR"!==t[0].tagName&&3!==t[0].nodeType)&&("UL"===t[0].tagName||"OL"===t[0].tagName?t.find("li").first():t)},last:function(){return this.core.editor().children().last()},lastChild:function(t){var e=t[0].lastChild;return!(null===e||!this.utils.isInlineTag(e.tagName))&&e},is:function(){return this.core.editor()[0]===document.activeElement}}},image:function(){return{is:function(){return!(!this.opts.imageUpload||!this.opts.imageUpload&&!this.opts.s3)},show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.modal.show()},insert:function(e,i,n){var r,s,o,a,l,c,h,d,u,p,f;return void 0!==e.error?(this.modal.close(),this.events.dropImage=!1,void this.core.callback("imageUploadError",e,n)):!1!==this.events.dropImage?(r=t(this.events.dropImage),this.core.callback("imageDelete",r[0].src,r),r.attr("src",e.url),this.events.dropImage=!1,void this.core.callback("imageUpload",r,e)):(s=t("<"+this.opts.imageTag+">"),(r=t("<img>")).attr("src",e.url),o=void 0===e.id?"":e.id,a=void 0===e.s3?"image":"s3",r.attr("data-"+a,o),s.append(r),l=this.utils.isTag(this.selection.current(),"pre"),i?(this.marker.remove(),c=this.insert.nodeToPoint(n,this.marker.get()),h=t(c).next(),this.selection.restore(),this.buffer.set(),void 0!==h&&0!==h.length&&"IMG"===h[0].tagName?(this.core.callback("imageDelete",h[0].src,h),h.closest("figure, p",this.core.editor()[0]).replaceWith(s),this.caret.after(s)):(l?t(l).after(s):this.insert.node(s),this.caret.after(s))):(this.modal.close(),this.buffer.set(),l?t(l).after(s):this.insert.node(s),this.caret.after(s)),this.events.dropImage=!1,d=r[0].nextSibling,u=s.next(),p=t(d).text().replace(/\u200B/g,""),f=u.text().replace(/\u200B/g,""),""===p&&t(d).remove(),1===u.length&&"FIGURE"===u[0].tagName&&""===f&&u.remove(),void(null!==i?this.core.callback("imageUpload",r,e):this.core.callback("imageInserted",r,e)))},setEditable:function(e){if(e.on("dragstart",(function(t){t.preventDefault()})),this.opts.imageResizable){var i=t.proxy((function(i){this.observe.image=e,this.image.resizer=this.image.loadEditableControls(e),t(document).on("mousedown.redactor-image-resize-hide."+this.uuid,t.proxy(this.image.hideResize,this)),this.image.resizer&&this.image.resizer.on("mousedown.redactor touchstart.redactor",t.proxy((function(t){this.image.setResizable(t,e)}),this))}),this);e.off("mousedown.redactor").on("mousedown.redactor",t.proxy(this.image.hideResize,this)),e.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",i)}else e.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",t.proxy((function(i){setTimeout(t.proxy((function(){this.image.showEdit(e)}),this),200)}),this))},setResizable:function(t,e){t.preventDefault(),this.image.resizeHandle={x:t.pageX,y:t.pageY,el:e,ratio:e.width()/e.height(),h:e.height()},(t=t.originalEvent||t).targetTouches&&(this.image.resizeHandle.x=t.targetTouches[0].pageX,this.image.resizeHandle.y=t.targetTouches[0].pageY),this.image.startResize()},startResize:function(){t(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",t.proxy(this.image.moveResize,this)),t(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",t.proxy(this.image.stopResize,this))},moveResize:function(t){var e,i;t.preventDefault(),t=t.originalEvent||t,e=this.image.resizeHandle.h,t.targetTouches?e+=t.targetTouches[0].pageY-this.image.resizeHandle.y:e+=t.pageY-this.image.resizeHandle.y,i=Math.round(e*this.image.resizeHandle.ratio),e<50||i<100||this.core.editor().width()<=i||(this.image.resizeHandle.el.attr({width:i,height:e}),this.image.resizeHandle.el.width(i),this.image.resizeHandle.el.height(e),this.code.sync())},stopResize:function(){this.handle=!1,t(document).off(".redactor-image-resize"),this.image.hideResize()},hideResize:function(e){var i;e&&0!==t(e.target).closest("#redactor-image-box",this.$editor[0]).length||(e&&"IMG"==e.target.tagName&&t(e.target),0!==(i=this.$editor.find("#redactor-image-box")).length&&(t("#redactor-image-editter").remove(),t("#redactor-image-resizer").remove(),i.find("img").css({marginTop:i[0].style.marginTop,marginBottom:i[0].style.marginBottom,marginLeft:i[0].style.marginLeft,marginRight:i[0].style.marginRight}),i.css("margin",""),i.find("img").css("opacity",""),i.replaceWith((function(){return t(this).contents()})),t(document).off("mousedown.redactor-image-resize-hide."+this.uuid),void 0!==this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style"))))},loadResizableControls:function(e,i){if(this.opts.imageResizable&&!this.detect.isMobile()){var n=t('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.detect.isDesktop()||n.css({width:"15px",height:"15px"}),n.attr("contenteditable",!1),i.append(n),i.append(e),n}return i.append(e),!1},loadEditableControls:function(e){var i,n;if(0===t("#redactor-image-box").length)return(i=t('<span id="redactor-image-box" data-redactor="verified">')).css("float",e.css("float")).attr("contenteditable",!1),"auto"!=e[0].style.margin?(i.css({marginTop:e[0].style.marginTop,marginBottom:e[0].style.marginBottom,marginLeft:e[0].style.marginLeft,marginRight:e[0].style.marginRight}),e.css("margin","")):i.css({display:"block",margin:"auto"}),e.css("opacity",".5").after(i),this.opts.imageEditable&&(this.image.editter=t('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",t.proxy((function(){this.image.showEdit(e)}),this)),i.append(this.image.editter),n=this.image.editter.innerWidth(),this.image.editter.css("margin-left","-"+n/2+"px")),this.image.loadResizableControls(e,i)},showEdit:function(e){var i,n,r,s,o;this.events.imageEditing||(this.observe.image=e,i=e.closest("a",this.$editor[0]),r=0!==(n=e.closest("figure",this.$editor[0])).length?n:e,this.modal.load("image-edit",this.lang.get("edit"),705),this.image.buttonDelete=this.modal.getDeleteButton().text(this.lang.get("delete")),this.image.buttonSave=this.modal.getActionButton().text(this.lang.get("save")),this.image.buttonDelete.on("click",t.proxy(this.image.remove,this)),this.image.buttonSave.on("click",t.proxy(this.image.update,this)),!1===this.opts.imageCaption?t("#redactor-image-caption").val("").hide().prev().hide():0!==(s=e.closest(this.opts.imageTag,this.$editor[0]).find("figcaption"))&&t("#redactor-image-caption").val(s.text()).show(),this.opts.imagePosition?(o=(0!==n.length?"center"===r.css("text-align"):"block"==r.css("display")&&"none"==r.css("float"))?"center":r.css("float"),t("#redactor-image-align").val(o)):t(".redactor-image-position-option").hide(),t("#redactor-image-preview").html(t('<img src="'+e.attr("src")+'" style="max-width: 100%;">')),t("#redactor-image-title").val(e.attr("alt")),0!==i.length&&(t("#redactor-image-link").val(i.attr("href")),"_blank"===i.attr("target")&&t("#redactor-image-link-blank").prop("checked",!0)),t(".redactor-link-tooltip").remove(),this.modal.show(),this.detect.isDesktop()&&t("#redactor-image-title").focus())},update:function(){var e,i,n,r,s,o,a=this.observe.image,l=a.closest("a",this.core.editor()[0]),c=t("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");a.attr("alt",c).attr("title",c),this.image.setFloating(a),""!==(e=t.trim(t("#redactor-image-link").val()).replace(/(<([^>]+)>)/gi,""))?(i="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",n=new RegExp("^(http|ftp|https)://"+i,"i"),r=new RegExp("^"+i,"i"),-1===e.search(n)&&0===e.search(r)&&this.opts.linkProtocol&&(e=this.opts.linkProtocol+"://"+e),s=!!t("#redactor-image-link-blank").prop("checked"),0===l.length?(o=t('<a href="'+e+'" id="redactor-img-tmp">'+this.utils.getOuterHtml(a)+"</a>"),s&&o.attr("target","_blank"),a=a.replaceWith(o),(l=this.core.editor().find("#redactor-img-tmp")).removeAttr("id")):(l.attr("href",e),s?l.attr("target","_blank"):l.removeAttr("target"))):0!==l.length&&l.replaceWith(this.utils.getOuterHtml(a)),this.image.addCaption(a,l),this.modal.close(),this.buffer.set()},setFloating:function(e){var i=e.closest("figure",this.$editor[0]),n=0!==i.length?i:e,r=t("#redactor-image-align").val(),s="",o="",a="",l="";switch(r){case"left":s="left",a="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":s="right",a="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":0!==i.length?l="center":(o="block",a="auto")}n.css({float:s,display:o,margin:a,"text-align":l}),n.attr("rel",e.attr("style"))},addCaption:function(e,i){var n=t("#redactor-image-caption").val(),r=0!==i.length?i:e,s=r.next();0!==s.length&&"FIGCAPTION"===s[0].tagName||(s=!1),""!==n?!1===s?(s=t("<figcaption />").text(n),r.after(s)):s.text(n):!1!==s&&s.remove()},remove:function(e,i,n){var r,s,o,a;if(i=void 0===i?t(this.observe.image):i,"boolean"!=typeof e&&this.buffer.set(),this.events.stopDetectChanges(),r=i.closest("a",this.core.editor()[0]),s=i.closest(this.opts.imageTag,this.core.editor()[0]),i.parent(),!1===this.core.callback("imageDelete",e,i[0]))return e&&e.preventDefault(),!1;0!==t("#redactor-image-box").length&&t("#redactor-image-box").parent(),0!==s.length?(a=s.prev(),o=s.next(),s.remove()):0!==r.length?(r.parent(),r.remove()):i.remove(),t("#redactor-image-box").remove(),!1!==e&&(o&&0!==o.length?this.caret.start(o):a&&0!==a.length&&this.caret.end(a)),"boolean"!=typeof e&&this.modal.close(),this.utils.restoreScroll(),this.observe.image=!1,this.events.startDetectChanges(),this.code.sync()}}},indent:function(){return{increase:function(){var e,i,n,r,s,o;this.list.get()&&(i=(e=t(this.selection.current()).closest("li")).closest("ul, ol",this.core.editor()[0]),0!==(n=e.closest("li").prev()).length&&"LI"===n[0].tagName&&(this.buffer.set(),this.utils.isCollapsed()?(r=i[0].tagName,s=t("<"+r+" />"),this.selection.save(),1===(o=n.find("ol").first()).length?o.append(e):(r=i[0].tagName,(s=t("<"+r+" />")).append(e),n.append(s)),this.selection.restore()):(document.execCommand("indent"),this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore())))},decrease:function(){var e,i,n,r,s;if(this.list.get()){if(t(this.selection.current()).closest("li").closest("ul, ol",this.core.editor()[0]),this.buffer.set(),document.execCommand("outdent"),e=t(this.selection.current()).closest("li",this.core.editor()[0]),this.utils.isCollapsed()&&this.indent.repositionItem(e),i=null,0===e.length){if((n=this.selection.block())&&-1!==n.nodeName.indexOf("-")){for(this.selection.save(),i=elCreate("div");n.childNodes.length;)i.appendChild(n.childNodes[0]);n.appendChild(i),this.selection.restore()}document.execCommand("formatblock",!1,"p"),0!==(r=(e=t(this.selection.current())).next()).length&&"BR"===r[0].tagName&&r.remove()}if(this.selection.save(),null!==i){for(s=i.parentNode;i.childNodes.length;)s.insertBefore(i.childNodes[0],i);s.removeChild(i)}this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},repositionItem:function(t){var e,i=t.next();0===i.length||"UL"===i[0].tagName&&"OL"===i[0].tagName||t.append(i),0!==(e=t.prev()).length&&"LI"!==e[0].tagName&&(this.selection.save(),t.parents("li",this.core.editor()[0]).after(t),this.selection.restore())},normalize:function(){this.core.editor().find("li").each(t.proxy((function(e,i){var n,r,s=t(i),o="";0!==this.opts.keepStyleAttr.length&&(o=","+this.opts.keepStyleAttr.join(",")),s.find(this.opts.inlineTags.join(",")).not("img"+o).removeAttr("style"),0===(n=s.parent()).length||"LI"!==n[0].tagName?0===(r=s.next()).length||"UL"!==r[0].tagName&&"OL"!==r[0].tagName||s.append(r):n.after(s)}),this))},removeEmpty:function(e){var i=this.core.editor().find("ul, ol"),n=this.core.editor().find("li");n.each(t.proxy((function(t,e){this.indent.removeItemEmpty(e)}),this)),i.each(t.proxy((function(t,e){this.indent.removeItemEmpty(e)}),this)),n.each(t.proxy((function(t,e){this.indent.removeItemEmpty(e)}),this))},removeItemEmpty:function(e){var i=e.innerHTML.replace(/[\t\s\n]/g,"");""===(i=i.replace(/<span><\/span>/g,""))&&t(e).remove()}}},inline:function(){return{format:function(t,e,i,n){if(!this.utils.isCurrentOrParent(["PRE","CODE"])){var r=this.inline.getParams(e,i,n);t=this.inline.arrangeTag(t),this.buffer.set(),this.utils.isCollapsed()?this.inline.formatCollapsed(t,r):this.inline.formatUncollapsed(t,r)}},formatCollapsed:function(e,i){var n,r,s,o=this.selection.inline();o?(r=o.tagName.toLowerCase())===e?this.utils.isEmpty(o.innerHTML)?(this.caret.after(o),t(o).remove()):(s=this.inline.insertBreakpoint(o,r),this.caret.after(s)):0===t(o).closest(e).length?(n=this.inline.insertInline(e),n=this.inline.setParams(n,i)):(s=this.inline.insertBreakpoint(o,r),this.caret.after(s)):(n=this.inline.insertInline(e),n=this.inline.setParams(n,i))},formatUncollapsed:function(e,i){var n,r,s,o,a,l,c,h,d,u,p,f,g,m;if(this.selection.save(),null===(r=window.getSelection().getRangeAt(0)).cloneContents().querySelector(e)&&((n=r.startContainer).nodeType===Node.TEXT_NODE&&(n=n.parentElement),null!==(s=n.closest(e))&&this.core.editor()[0].contains(s))){o=document.createElement(e),s.insertAdjacentElement("beforebegin",o),(a=document.createRange()).selectNodeContents(s),a.setEnd(r.startContainer,r.startOffset),o.appendChild(a.extractContents());const t=o.querySelector(".redactor-selection-marker");t&&s.prepend(t),l=document.createElement(e),s.insertAdjacentElement("afterend",l),(c=document.createRange()).selectNodeContents(s),c.setStart(r.endContainer,r.endOffset),l.appendChild(c.extractContents());const i=l.querySelector(".redactor-selection-marker");for(i&&s.append(i),h=s.parentElement;s.childNodes.length;)h.insertBefore(s.childNodes[0],s);return s.remove(),[o,l].forEach((t=>{if(0===t.childNodes.length)return void t.remove();if(0!==t.textContent.length)return;if(null!==t.querySelector("img, br"))return;const e=t.querySelector("span");e&&e.className.length||t.remove()})),void this.selection.restore()}for(d=this.inline.getClearedNodes(),this.inline.setNodesStriked(d,e,i),this.selection.restore(),document.execCommand("strikethrough"),this.selection.saveInstant(),f=0,g=(u=this.core.editor()[0].querySelectorAll('[style*="line-through"]')).length;f<g;f++)n=u[0],p=document.createElement("strike"),n.parentNode.insertBefore(p,n),p.appendChild(n),n.style.removeProperty("text-decoration");m=this,this.core.editor().find("strike").each((function(){var n,r,s,o=m.utils.replaceToTag(this,e);if(m.inline.setParams(o[0],i),n=o.find(e),0!==(s=(r=o.parent()).parent()).length&&s[0].tagName.toLowerCase()===e&&s.html()==r[0].outerHTML)return o.replaceWith((function(){return t(this).contents()})),void s.replaceWith((function(){return t(this).contents()}));0!==n.length&&m.inline.cleanInsideOrParent(n,i),r.html()==o[0].outerHTML&&m.inline.cleanInsideOrParent(r,i),m.detect.isFirefox()&&m.core.editor().find(e+":empty").remove()})),this.selection.restoreInstant()},cleanInsideOrParent:function(t,e){if(e)for(var i in e.data)this.inline.removeSpecificAttr(t,i,e.data[i])},getClearedNodes:function(){var e,i=this.selection.nodes(),n=[],r=i.length,s=0;for(e=0;e<r;e++)if(t(i[e]).hasClass("redactor-selection-marker")){s=e+2;break}for(e=0;e<r;e++)e>=s&&!this.utils.isBlockTag(i[e].tagName)&&n.push(i[e]);return n},isConvertableAttr:function(e,i,n){var r,s,o,a,l,c,h,d=t(e).attr(i);if(d)if("style"===i){for(r=(n=t.trim(n).replace(/;$/,"")).split(";"),s=0,o=0;o<r.length;o++)a=r[o].split(":"),l=t.trim(a[0]),c=t.trim(a[1]),-1!==l.search(/color/)?!(h=t(e).css(l))||h!==c&&this.utils.rgb2hex(h)!==c||s++:t(e).css(l)===c&&s++;if(s===r.length)return 1}else if(d===n)return 1;return 0},isConvertable:function(t,e,i,n){var r,s;if(e===i){if(!n)return!0;for(s in r=0,n.data)r+=this.inline.isConvertableAttr(t,s,n.data[s]);if(r===Object.keys(n.data).length)return!0}return!1},setNodesStriked:function(e,i,n){var r,s,o,a;for(r=0;r<e.length;r++)s=e[r].tagName?e[r].tagName.toLowerCase():void 0,a=(o=e[r].parentNode)&&o.tagName?o.tagName.toLowerCase():void 0,this.inline.isConvertable(o,a,i,n)&&t(o).replaceWith((function(){return t("<strike>").append(t(this).contents())})).attr("data-redactor-inline-converted"),this.inline.isConvertable(e[r],s,i,n)&&t(e[r]).replaceWith((function(){return t("<strike>").append(t(this).contents())}))},insertBreakpoint:function(e,i){var n,r,s,o=document.createElement("span");return o.id="redactor-inline-breakpoint",o=this.insert.node(o),r=this.utils.isEndOfElement(e)?"":"<"+i+">",n=(n=this.utils.getOuterHtml(e)).replace(/<span id="redactor-inline-breakpoint"><\/span>/i,"</"+i+">"+r),s=t(n),t(e).replaceWith(s),""!==r&&this.utils.cloneAttributes(e,s.last()),s.first()},insertInline:function(t){var e=document.createElement(t);return this.insert.node(e),this.caret.start(e),e},arrangeTag:function(t){var e,i=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],n=["strong","strong","em","em","u","del","del","sup","sub"];for(t=t.toLowerCase(),e=0;e<i.length;e++)t===i[e]&&(t=n[e]);return t},getStyleParams:function(t){var e,i,n={},r=t.trim().replace(/;$/,"").split(";");for(e=0;e<r.length;e++)(i=r[e].split(":"))&&(n[i[0].trim()]=i[1].trim());return n},getParams:function(t,e,i){var n=!1,r="toggle";return"object"==typeof t?(n=t,r=void 0!==e?e:r):void 0!==t&&void 0!==e&&((n={})[t]=e,r=void 0!==i?i:r),!!n&&{func:r,data:n}},setParams:function(e,i){var n,r;if(i)for(n in i.data)r=t(e),"style"===n?(e=this.inline[i.func+"Style"](i.data[n],e),r.attr("data-redactor-style-cache",r.attr("style"))):e="class"===n?this.inline[i.func+"Class"](i.data[n],e):"remove"===i.func?this.inline[i.func+"Attr"](n,e):this.inline[i.func+"Attr"](n,i.data[n],e),"style"===n&&"SPAN"===e.tagName&&r.attr("data-redactor-span",!0);return e},eachInline:function(t,e){var i,n,r=void 0===t?this.selection.inlines():[t];if(r)for(n=0;n<r.length;n++)i=e(r[n])[0];return i},replaceClass:function(e,i){return this.inline.eachInline(i,(function(i){return t(i).removeAttr("class").addClass(e)}))},toggleClass:function(e,i){return this.inline.eachInline(i,(function(i){return t(i).toggleClass(e)}))},addClass:function(e,i){return this.inline.eachInline(i,(function(i){return t(i).addClass(e)}))},removeClass:function(e,i){return this.inline.eachInline(i,(function(i){return t(i).removeClass(e)}))},removeAllClass:function(e){return this.inline.eachInline(e,(function(e){return t(e).removeAttr("class")}))},replaceAttr:function(e,i,n){return this.inline.eachInline(n,(function(i){return t(i).removeAttr(e).attr(e.value)}))},toggleAttr:function(e,i,n){return this.inline.eachInline(n,(function(i){return t(i).attr(e)?t(i).removeAttr(e):t(i).attr(e.value)}))},addAttr:function(e,i,n){return this.inline.eachInline(n,(function(n){return t(n).attr(e,i)}))},removeAttr:function(e,i){return this.inline.eachInline(i,(function(i){var n=t(i);return n.removeAttr(e),"style"===e&&n.removeAttr("data-redactor-style-cache"),n}))},removeAllAttr:function(e){return this.inline.eachInline(e,(function(e){var i,n=t(e),r=e.attributes.length;for(i=0;i<r;i++)n.removeAttr(e.attributes[i].name);return n}))},removeSpecificAttr:function(e,i,n){var r,s=t(e);"style"===i?(r=n.split(":")[0].trim(),s.css(r,""),this.utils.removeEmptyAttr(e,"style")&&s.removeAttr("data-redactor-style-cache")):s.removeAttr(i)[0]},hasParentStyle:function(t){var e=t.parent();return 1===e.length&&e[0].tagName===t[0].tagName&&e.html()===t[0].outerHTML&&e},addParentStyle:function(e){var i,n=this.inline.hasParentStyle(e);return n?(i=this.inline.getStyleParams(e.attr("style")),n.css(i),n.attr("data-redactor-style-cache",n.attr("style")),e.replaceWith((function(){return t(this).contents()}))):e.attr("data-redactor-style-cache",e.attr("style")),e},replaceStyle:function(e,i){e=this.inline.getStyleParams(e);var n=this;return this.inline.eachInline(i,(function(i){var r,s=t(i);return s.removeAttr("style").css(e),(r=s.attr("style"))&&s.attr("style",r.replace(/"/g,"'")),s=n.inline.addParentStyle(s)}))},toggleStyle:function(e,i){e=this.inline.getStyleParams(e);var n=this;return this.inline.eachInline(i,(function(i){var r,s,o,a,l=t(i);for(r in e)s=e[r],o=l.css(r),(o=n.utils.isRgb(o)?n.utils.rgb2hex(o):o.replace(/"/g,""))===(s=n.utils.isRgb(s)?n.utils.rgb2hex(s):s.replace(/"/g,""))?l.css(r,""):l.css(r,s);return(a=l.attr("style"))&&l.attr("style",a.replace(/"/g,"'")),n.utils.removeEmptyAttr(i,"style")?l.removeAttr("data-redactor-style-cache"):l=n.inline.addParentStyle(l),l}))},addStyle:function(e,i){e=this.inline.getStyleParams(e);var n=this;return this.inline.eachInline(i,(function(i){var r,s=t(i);return s.css(e),(r=s.attr("style"))&&s.attr("style",r.replace(/"/g,"'")),s=n.inline.addParentStyle(s)}))},removeStyle:function(e,i){e=this.inline.getStyleParams(e);var n=this;return this.inline.eachInline(i,(function(i){var r,s=t(i);for(r in e)s.css(r,"");return n.utils.removeEmptyAttr(i,"style")?s.removeAttr("data-redactor-style-cache"):s.attr("data-redactor-style-cache",s.attr("style")),s}))},removeAllStyle:function(e){return this.inline.eachInline(e,(function(e){return t(e).removeAttr("style").removeAttr("data-redactor-style-cache")}))},removeStyleRule:function(e){var i,n,r,s=this.selection.parent(),o=this.selection.inlines();for(this.buffer.set(),s&&"SPAN"===s.tagName&&this.inline.removeStyleRuleAttr(t(s),e),i=0;i<o.length;i++)n=o[i],r=t(n),-1==t.inArray(n.tagName.toLowerCase(),this.opts.inlineTags)||r.hasClass("redactor-selection-marker")||this.inline.removeStyleRuleAttr(r,e)},removeStyleRuleAttr:function(t,e){t.css(e,""),this.utils.removeEmptyAttr(t,"style")?t.removeAttr("data-redactor-style-cache"):t.attr("data-redactor-style-cache",t.attr("style"))},update:function(t,e,i,n){var r,s,o,a,l;if(t=this.inline.arrangeTag(t),r=this.inline.getParams(e,i,n),o=[],s=this.selection.inlines())for(a=0;a<s.length;a++)l=s[a],"*"!==t&&l.tagName.toLowerCase()!==t||o.push(this.inline.setParams(l,r));return o},removeFormat:function(){var e,i;for(this.selection.save(),e=this.inline.getClearedNodes(),i=0;i<e.length;i++)1===e[i].nodeType&&t(e[i]).replaceWith((function(){return t(this).contents()}));this.selection.restore()}}},insert:function(){return{set:function(t){this.code.set(t),this.focus.end()},html:function(e,i){var n,r,s,o,a,l,c,h,d;this.core.editor().focus(),n=this.selection.block(),r=this.selection.inline(),void 0===i&&(i=this.clean.getCurrentType(e,!0),e=this.clean.onPaste(e,i,!0)),e=t.parseHTML(e),s=t(e).last(),o=this.selection.get(),(a=this.selection.range(o)).deleteContents(),this.selection.update(o,a),!i.lists||0===(l=t(e)).length||"UL"!==l[0].tagName&&"OL"!==l[0].tagName?(i.blocks&&n?this.utils.isSelectAll()?(this.core.editor().html(e),this.focus.end()):!1===(c=this.utils.breakBlockTag())?this.insert.placeHtml(e):(t(e).children().last().append(this.marker.get()),"start"===c.type?c.$block.before(e):c.$block.after(e),this.selection.restore(),this.core.editor().find("p").each((function(){""===t.trim(this.innerHTML)&&t(this).remove()}))):(r&&((h=t("<div/>").html(e)).find(r.tagName.toLowerCase()).each((function(){t(this).contents().unwrap()})),e=h.html(),e=t.parseHTML(e),s=t(e).last()),this.utils.isSelectAll()?(d=t(this.opts.emptyHtml),this.core.editor().html("").append(d),d.html(e),this.caret.end(d)):this.insert.placeHtml(e)),this.utils.disableSelectAll(),i.pre&&this.clean.cleanPre(),this.caret.end(s)):this.insert.appendLists(n,l)},text:function(e){var i,n,r,s,o,a;e=e.toString(),e=t.trim(e),(i=document.createElement("div")).innerHTML=e,void 0!==(e=i.textContent||i.innerText)&&(this.core.editor().focus(),n=this.selection.blocks(),e=e.replace(/\n/g," "),this.utils.isSelectAll()?(r=t(this.opts.emptyHtml),this.core.editor().html("").append(r),r.html(e),this.caret.end(r)):(s=this.selection.get(),o=document.createTextNode(e),s.getRangeAt&&s.rangeCount&&((a=s.getRangeAt(0)).deleteContents(),a.insertNode(o),a.setStartAfter(o),a.collapse(!0),this.selection.update(s,a)),n.length>1&&(t(o).wrap("<p>"),this.caret.after(o))),this.utils.disableSelectAll(),this.clean.normalizeCurrentHeading())},raw:function(t){var e,i,n,r,s,o;for(this.core.editor().focus(),e=this.selection.get(),(i=this.selection.range(e)).deleteContents(),(n=document.createElement("div")).innerHTML=t,r=document.createDocumentFragment();s=n.firstChild;)o=r.appendChild(s);i.insertNode(r),o&&((i=i.cloneRange()).setStartAfter(o),i.collapse(!0),e.removeAllRanges(),e.addRange(i))},node:function(e,i){var n,r,s,o;return void 0!==this.start&&this.core.editor().focus(),e=e[0]||e,n=this.selection.block(),r=this.utils.isBlockTag(e.tagName),s=!0,this.utils.isSelectAll()?(r?this.core.editor().html(e):this.core.editor().html(t("<p>").html(e)),this.code.sync()):r&&n?!1===(o=this.utils.breakBlockTag())?this.insert.placeNode(e,i):("start"===o.type?o.$block.before(e):o.$block.after(e),this.core.editor().find("p:empty").remove()):s=this.insert.placeNode(e,i),this.utils.disableSelectAll(),s&&this.caret.end(e),e},appendLists:function(e,i){var n,r,s=t(e),o=this.utils.isEmpty(e.innerHTML);o||this.utils.isEndOfElement(e)?(n=s,i.find("li").each((function(){n.after(this),n=t(this)})),o&&s.remove()):this.utils.isStartOfElement(e)?i.find("li").each((function(){s.before(this),n=t(this)})):(r=this.selection.extractEndOfNode(e),s.after(t("<li>").append(r)),s.append(i),n=i),this.marker.remove(),n&&this.caret.end(n)},placeHtml:function(e){var i=document.createElement("span");i.id="redactor-insert-marker",i=this.insert.node(i),t(i).before(e),this.selection.restore(),this.caret.after(i),t(i).remove()},placeNode:function(t,e){var i=this.selection.get(),n=this.selection.range(i);if(null==n)return!1;!1!==e&&n.deleteContents(),n.insertNode(t),n.collapse(!1),this.selection.update(i,n)},nodeToPoint:function(e,i){var n,r,s,o,a;return i=i[0]||i,this.utils.isEmpty()?(i=this.utils.isBlock(i)?i:t("<p />").append(i),this.core.editor().html(i),i):(r=e.clientX,s=e.clientY,document.caretPositionFromPoint?(o=document.caretPositionFromPoint(r,s),(n=document.getSelection().getRangeAt(0)).setStart(o.offsetNode,o.offset),n.collapse(!0),n.insertNode(i)):document.caretRangeFromPoint?(n=document.caretRangeFromPoint(r,s)).insertNode(i):void 0!==document.body.createTextRange&&((n=document.body.createTextRange()).moveToPoint(r,s),(a=n.duplicate()).moveToPoint(r,s),n.setEndPoint("EndToEnd",a),n.select()),i)},nodeToCaretPositionFromPoint:function(t,e){this.insert.nodeToPoint(t,e)},marker:function(){this.marker.insert()}}},keydown:function(){return{init:function(e){var i,r,s,o,a,l,c,h,d;if(!this.rtePaste){if(r=(i=e.which)>=37&&i<=40,this.keydown.ctrl=e.ctrlKey||e.metaKey,this.keydown.parent=this.selection.parent(),this.keydown.current=this.selection.current(),this.keydown.block=this.selection.block(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.keydown.figure=this.utils.isTag(this.keydown.current,"figure"),!1===this.core.callback("keydown",e))return e.preventDefault(),!1;if(this.shortcuts.init(e,i),this.keydown.checkEvents(r,i),this.keydown.setupBuffer(e,i),this.utils.isSelectAll()&&(i===this.keyCode.ENTER||i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE))return e.preventDefault(),this.code.set(this.opts.emptyHtml),void this.events.changeHandler();if(this.keydown.addArrowsEvent(r),this.keydown.setupSelectAll(e,i),!this.opts.enterKey&&i===this.keyCode.ENTER)return e.preventDefault(),s=this.selection.get(),void((o=this.selection.range(s)).collapsed||o.deleteContents());if(this.opts.enterKey&&i===this.keyCode.DOWN&&this.keydown.onArrowDown(),this.opts.enterKey&&i===this.keyCode.UP&&this.keydown.onArrowUp(),("textarea"===this.opts.type||"div"===this.opts.type)&&this.keydown.current&&3===this.keydown.current.nodeType&&t(this.keydown.parent).hasClass("redactor-in")&&this.keydown.wrapToParagraph(),!this.keyup.lastShiftKey&&i===this.keyCode.SPACE&&(e.ctrlKey||e.shiftKey))return e.preventDefault(),this.keydown.onShiftSpace();if(i===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey)&&(null===n||"ios"!==n.platform()))return e.preventDefault(),this.keydown.onShiftEnter(e);if(i===this.keyCode.ENTER&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey)return this.keydown.onEnter(e);if(i===this.keyCode.TAB||e.metaKey&&221===i||e.metaKey&&219===i)return this.keydown.onTab(e,i);if(this.detect.isFirefox()&&i===this.keyCode.BACKSPACE&&this.keydown.block&&"P"===this.keydown.block.tagName&&this.utils.isStartOfElement(this.keydown.block)&&0!==(a=t(this.keydown.block).prev()).length)return e.preventDefault(),a.append(this.marker.get()),a.append(t(this.keydown.block).html()),t(this.keydown.block).remove(),void this.selection.restore();if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){if(this.observe.image&&void 0!==this.observe.image&&0!==t("#redactor-image-box").length)return e.preventDefault(),a=this.observe.image.closest("figure, p").prev(),this.image.remove(!1),this.observe.image=!1,void(a&&0!==a.length?this.caret.end(a):this.core.editor().focus());this.keydown.onBackspaceAndDeleteBefore()}if(i===this.keyCode.DELETE){if(l=t(this.keydown.block).next(),this.utils.isEndOfElement(this.keydown.block)&&0!==l.length&&"FIGURE"===l[0].tagName)return l.remove(),!1;if(!(!this.keydown.block||"LI"!==this.keydown.block.tagName)&&this.keydown.block&&(h=(c=t(this.keydown.block).parents("ul, ol").last()).next(),this.utils.isRedactorParent(c)&&this.utils.isEndOfElement(c)&&0!==h.length&&("UL"===h[0].tagName||"OL"===h[0].tagName)))return e.preventDefault(),c.append(h.contents()),h.remove(),!1;if(this.utils.isEndOfElement(this.keydown.block)&&0!==l.length&&"PRE"===l[0].tagName)return t(this.keydown.block).append(l.text()),l.remove(),!1}if(i===this.keyCode.DELETE&&0!==t("#redactor-image-box").length&&this.image.remove(),i===this.keyCode.BACKSPACE){if(this.detect.isFirefox()&&this.line.removeOnBackspace(e),this.list.combineAfterAndBefore(this.keydown.block))return void e.preventDefault();if((d=this.selection.block())&&"LI"===d.tagName&&this.utils.isCollapsed()&&this.utils.isStartOfElement())return this.indent.decrease(),void e.preventDefault();this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(e)}i!==this.keyCode.BACKSPACE&&i!==this.keyCode.DELETE||this.keydown.onBackspaceAndDeleteAfter(e)}},onShiftSpace:function(){return this.buffer.set(),this.insert.raw("&nbsp;"),!1},onShiftEnter:function(t){return this.buffer.set(),this.keydown.pre?this.keydown.insertNewLine(t):this.insert.raw("<br>")},onBackspaceAndDeleteBefore:function(){this.utils.saveScroll()},onBackspaceAndDeleteAfter:function(e){setTimeout(t.proxy((function(){var t;this.code.syncFire=!1,this.keydown.removeEmptyLists(),t="",0!==this.opts.keepStyleAttr.length&&(t=","+this.opts.keepStyleAttr.join(",")),this.core.editor().find("*[style]").not("img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]"+t).removeAttr("style"),this.keydown.formatEmpty(e),this.code.syncFire=!0}),this),1)},onEnter:function(e){var i,n,r,s,o=this.core.callback("enter",e);if(!1===o)return e.preventDefault(),!1;if(this.keydown.blockquote&&!0===this.keydown.exitFromBlockquote(e))return!1;if(this.keydown.pre)return this.keydown.insertNewLine(e);if(this.keydown.blockquote||this.keydown.figcaption)return this.keydown.insertBreakLine(e);if(this.keydown.figure)setTimeout(t.proxy((function(){this.keydown.replaceToParagraph("FIGURE")}),this),1);else if(this.keydown.block){if(setTimeout(t.proxy((function(){this.keydown.replaceToParagraph("DIV")}),this),1),"LI"===this.keydown.block.tagName&&(i=this.selection.current(),r=(n=t(i).closest("li",this.$editor[0])).parents("ul,ol",this.$editor[0]).last(),0!==n.length&&this.utils.isEmpty(n.html())&&0===r.next().length&&this.utils.isEmpty(r.find("li").last().html())))return r.find("li").last().remove(),s=t(this.opts.emptyHtml),r.after(s),this.caret.start(s),!1}else if(!this.keydown.block)return this.keydown.insertParagraph(e);this.detect.isFirefox()&&this.utils.isInline(this.keydown.parent)?this.keydown.insertBreakLine(e):this.opts.keepInlineOnEnter||setTimeout(t.proxy((function(){var e,i,n,r,s=this.selection.inline();s&&this.utils.isEmpty(s.innerHTML)&&(e=this.selection.block(),t(s).remove(),(i=document.createRange()).setStart(e,0),n=document.createTextNode("​"),i.insertNode(n),i.setStartAfter(n),i.collapse(!0),(r=window.getSelection()).removeAllRanges(),r.addRange(i))}),this),1)},checkEvents:function(t,e){t||"click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(e)&&this.buffer.set())},checkKeyEvents:function(e){var i=this.keyCode,n=[i.BACKSPACE,i.DELETE,i.ENTER,i.ESC,i.TAB,i.CTRL,i.META,i.ALT,i.SHIFT];return-1===t.inArray(e,n)},addArrowsEvent:function(t){t&&("click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()?this.core.addEvent("arrow"):this.core.addEvent(!1))},setupBuffer:function(t,e){return this.keydown.ctrl&&90===e&&!t.shiftKey&&!t.altKey&&this.sBuffer.length?(t.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===e&&t.shiftKey&&!t.altKey&&0!==this.sRebuffer.length?(t.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||e!==this.keyCode.SPACE&&e!==this.keyCode.BACKSPACE&&e!==this.keyCode.DELETE&&(e!==this.keyCode.ENTER||t.ctrlKey||t.shiftKey)||this.buffer.set())},exitFromBlockquote:function(e){var i;if(this.utils.isEndOfElement(this.keydown.blockquote))return-1!==this.clean.removeSpacesHard(t(this.keydown.blockquote).html()).search(/(<br\s?\/?>){1}$/i)?(e.preventDefault(),t(this.keydown.blockquote).children().last().filter("br").remove(),t(this.keydown.blockquote).children().last().filter("span").remove(),i=t(this.opts.emptyHtml),t(this.keydown.blockquote).after(i),this.caret.start(i),!0):void 0},onArrowDown:function(){var t,e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption];for(t=0;t<e.length;t++)if(e[t])return this.keydown.insertAfterLastElement(e[t]),!1},onArrowUp:function(){var t,e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption];for(t=0;t<e.length;t++)if(e[t])return this.keydown.insertBeforeFirstElement(e[t]),!1},insertAfterLastElement:function(e){var i,n;this.utils.isEndOfElement(e)&&(i=this.core.editor().contents().last(),0===("FIGCAPTION"===e.tagName?t(this.keydown.block).parent().next():t(this.keydown.block).next()).length&&(0!==i.length||i[0]===e?(n=t(this.opts.emptyHtml),"FIGCAPTION"===e.tagName?t(e).parent().after(n):t(e).after(n),this.caret.start(n)):this.caret.start(i)))},insertBeforeFirstElement:function(e){if(this.utils.isStartOfElement()&&!(this.core.editor().contents().length>1&&this.core.editor().contents().first()[0]!==e)){var i=t(this.opts.emptyHtml);t(e).before(i),this.caret.start(i)}},onTab:function(t,e){var i,n,r;return!this.opts.tabKey||(i=this.keydown.block&&"LI"===this.keydown.block.tagName,!(!this.utils.isEmpty(this.code.get())&&(i||this.keydown.pre||!1!==this.opts.tabAsSpaces))||(t.preventDefault(),this.buffer.set(),n=i&&this.utils.isStartOfElement(this.keydown.block),this.keydown.pre&&!t.shiftKey?(r=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("\t"),this.insert.node(r)):!1===this.opts.tabAsSpaces||n?t.metaKey&&219===e?this.indent.decrease():t.metaKey&&221===e?this.indent.increase():t.shiftKey?this.indent.decrease():this.indent.increase():(r=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(r)),!1))},setupSelectAll:function(t,e){this.keydown.ctrl&&65===e?this.utils.enableSelectAll():e===this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},insertNewLine:function(t){var e,i,n;return t.preventDefault(),e=document.createTextNode("\n"),i=this.selection.get(),(n=this.selection.range(i)).deleteContents(),n.insertNode(e),this.caret.after(e),!1},insertParagraph:function(t){var e,i,n;return t.preventDefault(),(e=document.createElement("p")).innerHTML="<br>",i=this.selection.get(),(n=this.selection.range(i)).deleteContents(),n.insertNode(e),this.caret.start(e),!1},insertBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t)},insertDblBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t,!0)},insertBreakLineProcessing:function(t,e){var i,n;return t.stopPropagation(),i=document.createElement("br"),this.insert.node(i),!0===e?(n=document.createElement("br"),this.insert.node(n),this.caret.after(n)):this.caret.after(i),!1},wrapToParagraph:function(){var e,i=t(this.keydown.current),n=t("<p>").append(i.clone());i.replaceWith(n),void 0!==(e=t(n).next())[0]&&"BR"===e[0].tagName&&e.remove(),this.caret.end(n)},replaceToParagraph:function(e){var i,n=this.selection.block(),r=t(n).prev(),s=n.innerHTML.replace(/<br\s?\/?>/gi,"");return n.tagName===e&&this.utils.isEmpty(s)&&!t(n).hasClass("redactor-in")?(i=document.createElement("p"),t(n).replaceWith(i),this.keydown.setCaretToParagraph(i),!1):"P"===n.tagName?(t(n).removeAttr("class").removeAttr("style"),this.detect.isIe()&&this.utils.isEmpty(s)&&this.utils.isInline(this.keydown.parent)&&t(n).on("input",t.proxy((function(){var e,i=this.selection.parent();this.utils.isInline(i)&&(e=t(i).html(),t(n).html(e),this.caret.end(n)),t(n).off("keyup")}),this)),!1):r.hasClass(this.opts.videoContainerClass)?(r.removeAttr("class"),i=document.createElement("p"),r.replaceWith(i),this.keydown.setCaretToParagraph(i),!1):void 0},setCaretToParagraph:function(t){var e,i,n=document.createRange();n.setStart(t,0),e=document.createTextNode("​"),n.insertNode(e),n.setStartAfter(e),n.collapse(!0),(i=window.getSelection()).removeAllRanges(),i.addRange(n)},removeInvisibleSpace:function(){var e=t(this.keydown.current);0===e.text().search(/^\u200B$/g)&&e.remove()},removeEmptyListInTable:function(e){var i=t(this.keydown.current),n=t(this.keydown.parent),r=i.closest("td",this.$editor[0]);if(0!==r.length&&i.closest("li",this.$editor[0])&&1===n.children("li").length){if(!this.utils.isEmpty(i.text()))return;e.preventDefault(),i.remove(),n.remove(),this.caret.start(r)}},removeEmptyLists:function(){var e=function(){""===t.trim(this.innerHTML).replace(/\/t\/n/g,"")&&t(this).remove()};this.core.editor().find("li").each(e),this.core.editor().find("ul, ol").each(e)},formatEmpty:function(e){var i,r=t.trim(this.core.editor().html());if(this.utils.isEmpty(r))return e.preventDefault(),"inline"===this.opts.type||"pre"===this.opts.type?(this.core.editor().html(this.marker.html()),this.selection.restore()):(i=function(){this.core.editor().html(this.opts.emptyHtml),this.focus.start()}.bind(this),null!==n&&"ios"===n.platform()?setTimeout(i,50):i()),!1}}},keyup:function(){return{init:function(e){var i,n,r,s,o;if(!this.rtePaste){if(i=e.which,this.keyup.block=this.selection.block(),this.keyup.current=this.selection.current(),this.keyup.parent=this.selection.parent(),this.keyup.lastShiftKey=e.shiftKey,!1===this.core.callback("keyup",e))return e.preventDefault(),!1;if(i===this.keyCode.ENTER&&this.keyup.block&&"FIGURE"===this.keyup.block.tagName&&0!==(n=t(this.keyup.block).prev()).length&&"FIGURE"===n[0].tagName)return r=this.utils.replaceToTag(n,"p"),void this.caret.start(r);if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){if(this.utils.isSelectAll())return void this.focus.start();if(this.keyup.block&&this.keydown.block&&"FIGURE"===this.keyup.block.tagName&&this.utils.isStartOfElement(this.keydown.block))return e.preventDefault(),this.selection.save(),t(this.keyup.block).find("figcaption").remove(),t(this.keyup.block).find("img").first().remove(),this.utils.replaceToTag(this.keyup.block,"p"),s=this.marker.find(),t("html, body").animate({scrollTop:s.position().top+20},500),void this.selection.restore();this.keyup.block&&"P"===this.keyup.block.tagName&&(o=t(this.keyup.block).find("img").length,""===t(this.keyup.block).text().replace(/\u200B/g,"")&&0!==o&&this.utils.replaceToTag(this.keyup.block,"figure")),this.keyup.block&&"FIGURE"===this.keyup.block.tagName&&0===t(this.keyup.block).find("img").length&&(this.selection.save(),this.utils.replaceToTag(this.keyup.block,"p"),this.selection.restore())}}}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(t){return void 0!==this.opts.curLang[t]?this.opts.curLang[t]:""}}},line:function(){return{insert:function(){this.buffer.set(),this.insert.html(this.line.getLineHtml());var t=this.core.editor().find("#redactor-hr-tmp-id");return t.removeAttr("id"),this.core.callback("insertedLine",t),t},getLineHtml:function(){var t='<hr id="redactor-hr-tmp-id" />';return!this.detect.isFirefox()&&this.utils.isEmpty()&&(t+="<p>"+this.opts.emptyHtml+"</p>"),t},removeOnBackspace:function(e){var i,n;this.utils.isCollapsed()&&0!==(i=t(this.selection.block())).length&&this.utils.isStartOfElement(i)&&(n=i.prev())&&0!==n.length&&"HR"===n[0].tagName&&(e.preventDefault(),n.remove())}}},link:function(){return{get:function(){return t(this.selection.inlines("a"))},is:function(){var e=this.selection.nodes(),i=t(this.selection.current()).closest("a",this.core.editor()[0]);return!(0===i.length||e.length>1)&&i},unlink:function(t,e){var i,n;void 0!==t&&t.preventDefault&&t.preventDefault(),this.buffer.set(),0!==(i=e?[e]:this.selection.inlines("a")).length&&(n=this.link.replaceLinksToText(i),this.observe.closeAllTooltip(),this.core.callback("deletedLink",n))},insert:function(e,i){var n,r=this.link.is();return(!0===i||!1!==(e=this.link.buildLinkFromObject(r,e)))&&(this.buffer.set(),e=this.core.callback("beforeInsertingLink",e),!1===r?(r=t("<a />"),r=this.link.update(r,e),n=(r=t(this.insert.node(r))).parent(),!1===this.utils.isRedactorParent(n)&&r.wrap("<p>"),n.hasClass("redactor-unlink")&&n.replaceWith((function(){return t(this).contents()})),this.caret.after(r),this.core.callback("insertedLink",r)):(r=this.link.update(r,e),this.caret.after(r)),r)},update:function(t,e){return t.text(e.text),t.attr("href",e.url),this.link.target(t,e.target),t},target:function(t,e){return e?t.attr("target","_blank"):t.removeAttr("target")},show:function(e){var i,n;void 0!==e&&e.preventDefault&&e.preventDefault(),this.observe.closeAllTooltip(),i=this.link.is(),this.link.buildModal(i),(n=this.link.buildLinkFromElement(i)).url=this.link.removeSelfHostFromUrl(n.url),this.opts.linkNewTab&&!i&&(n.target=!0),this.link.setModalValues(n),this.modal.show(),this.detect.isDesktop()&&t("#redactor-link-url").focus()},setModalValues:function(e){t("#redactor-link-blank").prop("checked",e.target),t("#redactor-link-url").val(e.url),t("#redactor-link-url-text").val(e.text)},buildModal:function(e){this.modal.load("link",this.lang.get(!1===e?"link-insert":"link-edit"),600),this.modal.getActionButton().text(this.lang.get(!1===e?"insert":"save")).on("click",t.proxy(this.link.callback,this))},callback:function(){var t=this.link.buildLinkFromModal();if(!1===t)return!1;this.modal.close(),this.link.insert(t,!0)},cleanUrl:function(e){return void 0===e?"":t.trim(e.replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,""))},cleanText:function(e){return void 0===e?"":t.trim(e.replace(/(<([^>]+)>)/gi,""))},getText:function(t){return""===t.text&&""!==t.url?this.link.truncateUrl(t.url.replace(/<|>/g,"")):t.text},isUrl:function(t){return!!new RegExp("^((https?|ftp):\\/\\/)?(([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)&&t},isMailto:function(t){return-1!==t.search("@")&&!1===/(http|ftp|https):\/\//i.test(t)},isEmpty:function(t){return""===t.url||""===t.text&&""===t.url},truncateUrl:function(t){return t.length>this.opts.linkSize?t.substring(0,this.opts.linkSize)+"...":t},parse:function(t){return this.link.isMailto(t.url)?t.url="mailto:"+t.url.replace("mailto:",""):0!==t.url.search("#")&&this.opts.linkValidation&&(t.url=this.link.isUrl(t.url)?"http://"+t.url.replace(/(ftp|https?):\/\//gi,""):t.url),!this.link.isEmpty(t)&&!1!==t.url&&t},buildLinkFromModal:function(){var e={};return e.url=this.link.cleanUrl(t("#redactor-link-url").val()),e.text=this.link.cleanText(t("#redactor-link-url-text").val()),e.text=this.link.getText(e),e.target=!!t("#redactor-link-blank").prop("checked"),this.link.parse(e)},buildLinkFromObject:function(t,e){return e.url=this.link.cleanUrl(e.url),e.text=void 0===e.text&&this.selection.is()?this.selection.text():this.link.cleanText(e.text),e.text=this.link.getText(e),e.target=!1===t?e.target:this.link.buildTarget(t),this.link.parse(e)},buildLinkFromElement:function(t){var e={url:"",text:this.selection.is()?this.selection.text():"",target:!1};return!1!==t&&(e.url=t.attr("href"),e.text=t.text(),e.target=this.link.buildTarget(t)),e},buildTarget:function(t){return void 0!==t.attr("target")&&"_blank"===t.attr("target")},removeSelfHostFromUrl:function(t){var e=self.location.href.replace("#","").replace(/\/$/i,"");return t.replace(/^\/\#/,"#").replace(e,"").replace("mailto:","")},replaceLinksToText:function(e){var i,n=t.each(e,(function(e,n){var r=t(n),s=t('<span class="redactor-unlink" />').append(r.contents());return r.replaceWith(s),0===e&&(i=s),r}));return 1===e.length&&this.selection.isCollapsed()&&this.caret.after(i),n}}},linkify:function(){return{isKey:function(){},isLink:function(){},isFiltered:function(){},handler:function(){},format:function(){},convertVideoLinks:function(){},convertImages:function(){},convertLinks:function(){}}},list:function(){return{toggle:function(e){var i,n,r;if(!this.utils.inBlocks(["table","td","th","tr"]))return e=(e="unorderedlist"===(e="orderedlist"===e?"ol":e)?"ul":e).toLowerCase(),this.buffer.set(),this.selection.save(),i=this.list._getBlocks(),n=this.selection.block(),r=t(n).parents("ul, ol").last(),0===i.length&&0!==r.length&&(i=[r.get(0)]),i=this.list._isUnformat(e,i)?this.list._unformat(e,i):this.list._format(e,i),this.selection.restore(),i},get:function(){var e=this.selection.current(),i=t(e).closest("ul, ol",this.core.editor()[0]);return 0!==i.length&&i},combineAfterAndBefore:function(e){var i=t(e).prev(),n=t(e).next(),r=e&&"P"===e.tagName&&("<br>"===e.innerHTML||""===e.innerHTML),s=1===i.closest("ol, ul",this.core.editor()[0]).length&&1===n.closest("ol, ul",this.core.editor()[0]).length;return!(!r||!s)&&(i.children("li").last().append(this.marker.get()),i.append(n.contents()),this.selection.restore(),!0)},_getBlocks:function(){var e,i=[],n=this.selection.blocks();for(e=0;e<n.length;e++)t(n[e]).parent().hasClass("redactor-in")&&i.push(n[e]);return i},_isUnformat:function(t,e){var i,n,r=0;for(i=0;i<e.length;i++)3!==e[i].nodeType&&((n=e[i].tagName.toLowerCase())!==t&&"figure"!==n||r++);return r===e.length},_uniteBlocks:function(e,i){var n,r,s=0,o={0:[]},a=!1;for(n=0;n<e.length;n++)0!==(r=t(e[n]).closest("th, td")).length?(r.get(0)!==a&&(o[++s]=[]),this.list._isUniteBlock(e[n],i)&&o[s].push(e[n])):this.list._isUniteBlock(e[n],i)?o[s].push(e[n]):o[++s]=[],a=r.get();return o},_isUniteBlock:function(t,e){return 3===t.nodeType||-1!==e.indexOf(t.tagName.toLowerCase())},_createList:function(e,i,n){var r=i[i.length-1],s=t(r),o=t("<"+e+">");return s.after(o),o},_createListItem:function(e){var i,n=t("<li>");return 3===e.nodeType?n.append(e):(i=t(e),n.append(i.contents()),i.remove()),n},_format:function(e,i){var n,r,s,o,a,l=["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6","ul","ol"],c=this.list._uniteBlocks(i,l),h=[];for(n in c){for(r=c[n],s=this.list._createList(e,c[n]),o=0;o<r.length;o++)3===r[o].nodeType||"UL"!==r[o].tagName&&"OL"!==r[o].tagName?(a=this.list._createListItem(r[o]),s.append(a)):(a=t(r[o]).contents(),s.append(a));h.push(s.get(0))}return h},_unformat:function(e,i){var n,r,s,o,a,l,c,h,d,u,p,f,g;if(1===i.length){if(r=(n=t(i[0])).find("li"),s=this.selection.blocks(["li"]),o=this.selection.block(),a=t(o).closest("li"),0===s.length&&0!==a.length&&(s=[a.get(0)]),s.length===r.length)return this.list._unformatEntire(i[0]);if("Top"===(l=this.list._getItemsPosition(r,s)))return this.list._unformatAtSide("before",s,n);if("Bottom"===l)return s.reverse(),this.list._unformatAtSide("after",s,n);if("Middle"===l){for(c=t(s[s.length-1]),h=!1,d=!1,u=t("<"+n.get(0).tagName.toLowerCase()+">"),r.each((function(e,i){var n;h&&(0!==(n=t(i)).children("ul, ol").length,0!==n.closest(".redactor-split-item").length||!1!==d&&0!==n.closest(d).length||n.addClass("redactor-split-item"),d=n),i===c.get(0)&&(h=!0)})),r.filter(".redactor-split-item").each((function(e,i){t(i).removeClass("redactor-split-item"),u.append(i)})),n.after(u),s.reverse(),p=0;p<s.length;p++)f=t(s[p]),g=this.list._createUnformatContainer(f),n.after(g),g.find("ul, ol").remove(),f.remove();return}}else for(p=0;p<i.length;p++)3!==i[p].nodeType&&i[p].tagName.toLowerCase()===e&&this.list._unformatEntire(i[p])},_unformatEntire:function(e){var i=t(e),n=i.find("li");n.each(function(e,n){var r=t(n),s=this.list._createUnformatContainer(r);r.remove(),i.before(s)}.bind(this)),i.remove()},_unformatAtSide:function(e,i,n){var r,s,o,a;for(r=0;r<i.length;r++)s=t(i[r]),o=this.list._createUnformatContainer(s),n[e](o),a=o.find("ul, ol").first(),s.append(a),a.each((function(e,n){var r=t(n),s=r.closest("li");s.get(0)===i[e]&&(r.unwrap(),s.addClass("r-unwrapped"))})),this.utils.isEmpty(s.html())&&s.remove();n.find(".r-unwrapped").each((function(e){var i=t(e);""===i.html().trim()?i.remove():i.removeClass("r-unwrapped")}))},_getItemsPosition:function(t,e){var i="Middle",n=e[0],r=e[e.length-1],s=t.first().get(0),o=t.last().get(0);return s===n&&o!==r?i="Top":s!==n&&o===r&&(i="Bottom"),i},_createUnformatContainer:function(e){var i=t("<p>");return i.append(e.contents()),i}}},marker:function(){return{get:function(t){t=void 0===t?1:t;var e=document.createElement("span");return e.id="selection-marker-"+t,e.className="redactor-selection-marker",e.innerHTML=this.opts.invisibleSpace,e},html:function(t){return this.utils.getOuterHtml(this.marker.get(t))},find:function(t){return t=void 0===t?1:t,this.core.editor().find("span#selection-marker-"+t)},insert:function(){var t=this.selection.get(),e=this.selection.range(t);this.marker.insertNode(e,this.marker.get(1),!0),e&&!1===e.collapsed&&this.marker.insertNode(e,this.marker.get(2),!1)},remove:function(){this.core.editor().find(".redactor-selection-marker").each(this.marker.iterateRemove)},insertNode:function(e,i,n){var r=this.selection.parent();if(null!==e&&0!==t(r).closest(".redactor-in").length){e=e.cloneRange();try{e.collapse(n),e.insertNode(i)}catch(t){this.focus.start()}}},iterateRemove:function(e,i){var n=t(i),r=n.text().replace(/\u200B/g,"");n.parent()[0];""===r?n.remove():n.replaceWith((function(){return t(this).contents()}))}}},modal:function(){return{callbacks:{},templates:function(){this.opts.modal={"image-edit":"",image:"",file:"",link:String()+'<div class="redactor-modal-tab" data-title="General"><section><label>URL</label><input type="url" id="redactor-link-url" aria-label="URL" /></section><section><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" /></section><section><label class="checkbox"><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},t.extend(this.opts,this.opts.modal)},addCallback:function(t,e){this.modal.callbacks[t]=e},addTemplate:function(t,e){this.opts.modal[t]=e},getTemplate:function(t){return this.opts.modal[t]},getModal:function(){return this.$modalBody},getActionButton:function(){return this.$modalBody.find("#redactor-modal-button-action")},getCancelButton:function(){return this.$modalBody.find("#redactor-modal-button-cancel")},getDeleteButton:function(){return this.$modalBody.find("#redactor-modal-button-delete")},load:function(){},show:function(){},buildWidth:function(){},buildTabber:function(){},showTab:function(){},setTitle:function(){},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName)),this.modal.getCancelButton().on("mousedown",t.proxy(this.modal.close,this))},setDraggable:function(){},setEnter:function(){},build:function(){this.modal.buildOverlay(),this.$modalBox=t('<div id="redactor-modal-box"/>').hide(),this.$modal=t('<div id="redactor-modal" role="dialog" />'),this.$modalHeader=t('<div id="redactor-modal-header" />'),this.$modalClose=t('<button type="button" id="redactor-modal-close" aria-label="'+this.lang.get("close")+'" />').html("&times;"),this.$modalBody=t('<div id="redactor-modal-body" />'),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalClose),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=t('<div id="redactor-modal-overlay">').hide(),t("body").prepend(this.$modalOverlay)},enableEvents:function(){},disableEvents:function(){},closeHandler:function(){},close:function(){}}},observe:function(){return{load:function(){void 0===this.opts.destroyed&&(this.observe.links(),this.observe.images())},isCurrent:function(e,i){return void 0===i&&(i=t(this.selection.current())),i.is(e)||i.parents(e).length>0},toolbar:function(){this.observe.buttons(),this.observe.dropdowns()},buttons:function(e,i){var n=this.selection.current(),r=this.selection.parent();!1!==e?this.button.setInactiveAll():this.button.setInactiveAll(i),!1!==e||"html"===i?this.utils.isRedactorParent(n)&&("none"!==this.core.editor().css("display")&&(this.utils.isCurrentOrParentHeader()||this.utils.isCurrentOrParent(["table","pre","blockquote","li"])?this.button.disable("horizontalrule"):this.button.enable("horizontalrule")),t.each(this.opts.activeButtonsStates,t.proxy((function(e,i){var s=t(r).closest(e,this.$editor[0]),o=t(n).closest(e,this.$editor[0]);(0===s.length||this.utils.isRedactorParent(s))&&this.utils.isRedactorParent(o)&&(0===s.length&&0===o.closest(e,this.$editor[0]).length||this.button.setActive(i))}),this))):-1!==t.inArray(i,this.opts.activeButtons)&&this.button.toggleActive(i)},dropdowns:function(){var e=t("<div />").html(this.selection.html()).find("a").length,i=t(this.selection.current()),n=this.utils.isRedactorParent(i);t.each(this.opts.observe.dropdowns,t.proxy((function(t,r){var s=r.observe,o=s.element,a=r.item,l=void 0!==s.in&&s.in,c=void 0!==s.out&&s.out;i.closest(o).length>0&&n||"a"===o&&0!==e?this.observe.setDropdownProperties(a,l,c):this.observe.setDropdownProperties(a,c,l)}),this))},setDropdownProperties:function(t,e,i){i&&void 0!==i.attr&&this.observe.setDropdownAttr(t,i.attr,!0),void 0!==e.attr&&this.observe.setDropdownAttr(t,e.attr),void 0!==e.title&&t.find("span").text(e.title)},setDropdownAttr:function(e,i,n){t.each(i,(function(t,i){"class"===t?n?e.removeClass(i):e.addClass(i):n?e.removeAttr(t):e.attr(t,i)}))},addDropdown:function(t,e,i){void 0!==i.observe&&(i.item=t,this.opts.observe.dropdowns.push(i))},images:function(){this.opts.imageEditable&&(this.core.editor().addClass("redactor-layer-img-edit"),this.core.editor().find("img").each(t.proxy((function(e,i){var n=t(i);n.closest("a",this.$editor[0]).on("click",(function(t){t.preventDefault()})),this.image.setEditable(n)}),this)))},links:function(){this.opts.linkTooltip&&this.core.editor().find("a").each(t.proxy((function(e,i){var n=t(i);!0!==n.data("cached")&&(n.data("cached",!0),n.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.showTooltip,this)))}),this))},getTooltipPosition:function(t){return t.offset()},showTooltip:function(e){var i,n,r,s,o,a,l,c,h,d,u,p,f=t(e.target);if("IMG"===f[0].tagName)return;if("A"!==f[0].tagName&&(f=f.closest("a",this.$editor[0])),"A"!==f[0].tagName)return;i=f,n=this.observe.getTooltipPosition(i),r=t('<span class="redactor-link-tooltip"></span>'),void 0===(s=i.attr("href"))&&(s=""),s.length>24&&(s=s.substring(0,24)+"..."),o=t('<a href="'+i.attr("href")+'" target="_blank" />').html(s).addClass("redactor-link-tooltip-action"),a=t('<a href="#" />').html(this.lang.get("edit")).addClass("redactor-link-tooltip-action").on("click",(t=>this.link.show(t,i))),l=t('<a href="#" />').html(this.lang.get("unlink")).addClass("redactor-link-tooltip-action").on("click",(t=>this.link.unlink(t,i))),r.append(o).append(" | ").append(a).append(" | ").append(l),c=parseInt(i.css("line-height"),10),h=Math.ceil((e.pageY-n.top)/c),d=n.top+h*c,document.body.appendChild(r[0]);const g=Math.trunc(r[0].clientWidth);r[0].remove(),u=`${n.left}px`,p="auto";if(document.body.clientWidth-(n.left+g)<0){const t=i[0].getBoundingClientRect(),e=Math.trunc(t.right);if(e-g>0)u="auto",p=document.body.clientWidth-e+"px";else{let t=Math.trunc((document.body.clientWidth-g)/2);t<0?(u="0px",p="0px"):u=`${t}px`}}r.css({top:d+"px",left:u,right:p}),t(".redactor-link-tooltip").remove(),t("body").append(r),this.core.editor().on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this)),t(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this))},closeAllTooltip:function(){t(".redactor-link-tooltip").remove()},closeTooltip:function(e){var i,n;i=(e=e.originalEvent||e).target,0!==(n=t(i).closest("a",this.$editor[0])).length&&"A"===n[0].tagName&&"A"!==i.tagName||"A"===i.tagName&&this.utils.isRedactorParent(i)||t(i).hasClass("redactor-link-tooltip-action")||(this.observe.closeAllTooltip(),this.core.editor().off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this)),t(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this)))}}},offset:function(){return{get:function(e){var i,n=this.offset.clone(e);return!1===n?0:((i=document.createElement("div")).appendChild(n.cloneContents()),i.innerHTML=i.innerHTML.replace(/<img(.*?[^>])>$/gi,"i"),t.trim(t(i).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"").length)},clone:function(t){var e,i=this.selection.get(),n=this.selection.range(i);return(null!==n||void 0!==t)&&(!1!==(t=void 0===t?this.$editor:t)&&(t=t[0]||t,(e=n.cloneRange()).selectNodeContents(t),e.setEnd(n.endContainer,n.endOffset),e))},set:function(t,e){var i,n,r,s,o;for(e=void 0===e?t:e,this.focus.is()||this.focus.start(),i=this.selection.get(),n=this.selection.range(i),s=0,o=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);null!==(r=o.nextNode());)if((s+=r.nodeValue.length)>t&&(n.setStart(r,r.nodeValue.length+t-s),t=1/0),s>=e){n.setEnd(r,r.nodeValue.length+e-s);break}n.collapse(!1),this.selection.update(i,n)}}},paragraphize:function(){return{load:function(e){return!1===this.opts.paragraphize||"inline"===this.opts.type||"pre"===this.opts.type?e:""===e||"<p></p>"===e?this.opts.emptyHtml:(e+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,e=(e=(e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")).replace(/<\/pre>/gi,"</pre>\n\n")).replace(/<p>\s<br><\/p>/gi,"<p></p>"),e=(e=this.paragraphize.getSafes(e)).replace("<br>","\n"),e=this.paragraphize.convert(e),e=this.paragraphize.clear(e),e=(e=this.paragraphize.restoreSafes(e)).replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),t.trim(e))},getSafes:function(e){var i=t("<div />").append(e);return i.find("blockquote p").replaceWith((function(){return t(this).append("<br />").contents()})),i.find(this.opts.paragraphizeBlocks.join(", ")).each(t.proxy((function(e,i){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,t(i).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")}),this)),i.find("span.redactor-selection-marker").each(t.proxy((function(e,i){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,t(i).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")}),this)),i.html()},restoreSafes:function(e){return t.each(this.paragraphize.safes,(function(t,i){i=void 0!==i?i.replace(/\$/g,"&#36;"):i,e=e.replace("#####replace"+t+"#####",i)})),e},convert:function(e){var i,n,r;return i=/\s+/g,e=(e=(e=(e=e.replace(/\r\n/g,"xparagraphmarkerz")).replace(/\n/g,"xparagraphmarkerz")).replace(/\r/g,"xparagraphmarkerz")).replace(i," "),n=/xparagraphmarkerzxparagraphmarkerz/gi,r=/xparagraphmarkerz/gi,e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e="<p>"+(e=(e=(e=t.trim(e)).replace(n,"</p><p>")).replace(r,"<br>"))+"</p>").replace("<p></p>","")).replace("\r\n\r\n","")).replace(/<\/p><p>/g,"</p>\r\n\r\n<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(/<p>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>/gi,"<p>")},clear:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<p>(.*?)#####replace(.*?)#####\s?<\/p>/gi,"<p>$1</p>#####replace$2#####")).replace(/(<br\s?\/?>){2,}<\/p>/gi,"</p>")).replace(new RegExp("</blockquote></p>","gi"),"</blockquote>")).replace(new RegExp("<p></blockquote>","gi"),"</blockquote>")).replace(new RegExp("<p><blockquote>","gi"),"<blockquote>")).replace(new RegExp("<blockquote></p>","gi"),"<blockquote>")).replace(new RegExp("<p><p ","gi"),"<p ")).replace(new RegExp("<p><p>","gi"),"<p>")).replace(new RegExp("</p></p>","gi"),"</p>")).replace(new RegExp("<p>\\s?</p>","gi"),"")).replace(new RegExp("\n</p>","gi"),"</p>")).replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>")).replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(e){this.rtePaste=!0;var i=!("pre"!==this.opts.type&&!this.utils.isCurrentOrParent("pre"));this.detect.isDesktop()&&!this.paste.pre&&this.opts.clipboardImageUpload&&this.opts.imageUpload&&this.paste.detectClipboardUpload(e)?this.detect.isIe()&&setTimeout(t.proxy(this.paste.clipboardUpload,this),100):(this.utils.saveScroll(),this.selection.save(),this.paste.createPasteBox(i),t(window).on("scroll.redactor-freeze",t.proxy((function(){t(window).scrollTop(this.saveBodyScroll)}),this)),setTimeout(t.proxy((function(){var e,n,r=this.paste.getPasteBoxCode(i);this.buffer.set(),this.selection.restore(),this.utils.restoreScroll(),e=this.clean.getCurrentType(r),r=this.clean.onPaste(r,e),r=void 0===(n=this.core.callback("paste",r))?r:n,this.paste.insert(r,e),this.rtePaste=!1,i&&this.clean.cleanPre(),t(window).off("scroll.redactor-freeze")}),this),1))},getPasteBoxCode:function(t){var e=t?this.$pasteBox.val():this.$pasteBox.html();return this.$pasteBox.remove(),e},createPasteBox:function(e){var i={position:"fixed",width:"1px",top:0,left:"-9999px"};this.$pasteBox=e?t("<textarea>").css(i):t("<div>").attr("contenteditable","true").css(i),this.paste.appendPasteBox(),this.$pasteBox.focus()},appendPasteBox:function(){if(this.detect.isIe())this.core.box().append(this.$pasteBox);else{var e=t(".modal-body:visible");e.length>0?e.append(this.$pasteBox):t("body").prepend(this.$pasteBox)}},detectClipboardUpload:function(e){var i,n,r;return i=(e=e.originalEvent||e).clipboardData,!this.detect.isIe()&&!this.detect.isFirefox()&&(-1!==i.types.indexOf("public.tiff")?(e.preventDefault(),!1):i.items&&i.items.length?null!==(n=i.items[0].getAsFile())&&((r=new FileReader).readAsDataURL(n),r.onload=t.proxy(this.paste.insertFromClipboard,this),!0):void 0)},clipboardUpload:function(){var e=this.$editor.find("img");t.each(e,t.proxy((function(e,i){var n,r;-1!==i.src.search(/^data\:image/i)&&(n=window.FormData?new FormData:null,window.FormData&&(this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=t.proxy((function(e){if(this.detect.isIe())t(i).wrap(t("<figure />"));else{var n=t(i).parent();this.utils.replaceToTag(n,"figure")}i.src=e.url,this.core.callback("imageUpload",t(i),e)}),this),r=this.utils.dataURItoBlob(i.src),n.append("clipboard",1),n.append(this.opts.imageUploadParam,r),this.upload.send(n,!1),this.code.sync(),this.rtePaste=!1))}),this))},insertFromClipboard:function(t){var e,i=window.FormData?new FormData:null;window.FormData&&(this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=this.image.insert,e=this.utils.dataURItoBlob(t.target.result),i.append("clipboard",1),i.append(this.opts.imageUploadParam,e),this.upload.send(i,t),this.rtePaste=!1)},insert:function(e,i){i.pre?this.insert.raw(e):i.text?this.insert.text(e):this.insert.html(e,i),this.detect.isFirefox()&&this.opts.imageUpload&&this.opts.clipboardImageUpload&&setTimeout(t.proxy(this.paste.clipboardUpload,this),100)}}},placeholder:function(){return{enable:function(){},show:function(){},update:function(){},hide:function(){},is:function(){},init:function(){},enabled:function(){},enableEvents:function(){},disableEvents:function(){},build:function(){},buildPosition:function(){},getPosition:function(){},isEditorEmpty:function(){},isAttr:function(){},destroy:function(){}}},progress:function(){return{$box:null,$bar:null,target:document.body,show:function(){},hide:function(){},update:function(){},is:function(){},build:function(){},destroy:function(){}}},selection:function(){return{get:function(){return window.getSelection?window.getSelection():document.selection&&"Control"!==document.selection.type?document.selection:null},range:function(t){return void 0===t&&(t=this.selection.get()),t.getRangeAt&&t.rangeCount?t.getRangeAt(0):null},is:function(){return!this.selection.isCollapsed()},isRedactor:function(){var e,i=this.selection.range();return!(null===i||(e=i.startContainer.parentNode,!t(e).hasClass("redactor-in")&&0===t(e).parents(".redactor-in").length))},isCollapsed:function(){var t=this.selection.get();return null!==t&&t.isCollapsed},update:function(t,e){null!==e&&(t.removeAllRanges(),t.addRange(e))},current:function(){var t=this.selection.get();return null!==t&&t.anchorNode},parent:function(){var t=this.selection.current();return null!==t&&t.parentNode},block:function(e){for(e=e||this.selection.current();e;){if(this.utils.isBlockTag(e.tagName))return!t(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},inline:function(e){for(e=e||this.selection.current();e;){if(this.utils.isInlineTag(e.tagName))return!t(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},element:function(e){for(e||(e=this.selection.current());e;){if(1===e.nodeType)return!t(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},prev:function(){return null!==this.selection.current()&&this.selection.current().previousSibling},next:function(){return null!==this.selection.current()&&this.selection.current().nextSibling},blocks:function(e){var i,n=[],r=this.selection.nodes(e);return t.each(r,t.proxy((function(t,e){this.utils.isBlock(e)&&n.push(e)}),this)),i=this.selection.block(),0===n.length&&!1===i?[]:0===n.length&&!1!==i?[i]:n},inlines:function(e){var i,n=[],r=this.selection.nodes(e);return t.each(r,t.proxy((function(t,e){this.utils.isInline(e)&&n.push(e)}),this)),i=this.selection.inline(),0===n.length&&!1===i?[]:0===n.length&&!1!==i?[i]:n},nodes:function(e){var i,n,r=void 0===e?[]:t.isArray(e)?e:[e],s=this.selection.get(),o=this.selection.range(s),a=[],l=[];if(this.utils.isCollapsed())a=[this.selection.current()];else{if((i=o.startContainer)===(n=o.endContainer))return[i];for(;i&&i!==n;)a.push(i=this.selection.nextNode(i));for(i=o.startContainer;i&&i!==o.commonAncestorContainer;)a.unshift(i),i=i.parentNode}return t.each(a,(function(e,i){if(i){var n=1===i.nodeType&&i.tagName.toLowerCase();if(t(i).hasClass("redactor-script-tag")||t(i).hasClass("redactor-selection-marker"))return;if(n&&0!==r.length&&-1===t.inArray(n,r))return;l.push(i)}})),0===l.length?[]:l},nextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},save:function(){this.marker.insert(),this.savedSel=this.core.editor().html()},restore:function(t){var e=this.marker.find(1),i=this.marker.find(2);this.detect.isFirefox()&&this.core.editor().focus(),0!==e.length&&0!==i.length?this.caret.set(e,i):0!==e.length?this.caret.start(e):this.core.editor().focus(),!1!==t&&(this.marker.remove(),this.savedSel=!1)},saveInstant:function(){var t,e,i,n=this.core.editor()[0],r=n.ownerDocument,s=r.defaultView,o=s.getSelection();if(o.getRangeAt&&o.rangeCount)return(e=(t=o.getRangeAt(0)).cloneRange()).selectNodeContents(n),e.setEnd(t.startContainer,t.startOffset),i=e.toString().length,this.saved={start:i,end:i+t.toString().length,node:t.startContainer},this.saved},restoreInstant:function(t){var e,i,n,r,s,o,a,l,c,h,d,u,p;if(void 0!==t||this.saved)if(this.saved=void 0!==t?t:this.saved,0===(e=this.core.editor().find(this.saved.node)).length||0!==e.text().trim().replace(/\u200B/g,"").length){for(o=(s=(r=this.core.editor()[0]).ownerDocument).defaultView,a=0,(i=s.createRange()).setStart(r,0),i.collapse(!0),l=[r],h=!1,d=!1;!d&&(c=l.pop());)if(3==c.nodeType)u=a+c.length,!h&&this.saved.start>=a&&this.saved.start<=u&&(i.setStart(c,this.saved.start-a),h=!0),h&&this.saved.end>=a&&this.saved.end<=u&&(i.setEnd(c,this.saved.end-a),d=!0),a=u;else for(p=c.childNodes.length;p--;)l.push(c.childNodes[p]);(n=o.getSelection()).removeAllRanges(),n.addRange(i)}else try{(i=document.createRange()).setStart(e[0],0),(n=window.getSelection()).removeAllRanges(),n.addRange(i)}catch(t){}},node:function(e){t(e).prepend(this.marker.get(1)),t(e).append(this.marker.get(2)),this.selection.restore()},all:function(){var t,e;this.core.editor().focus(),t=this.selection.get(),(e=this.selection.range(t)).selectNodeContents(this.core.editor()[0]),this.selection.update(t,e)},remove:function(){this.selection.get().removeAllRanges()},replace:function(t){this.insert.html(t)},text:function(){return this.selection.get().toString()},html:function(){var t,e,i,n="",r=this.selection.get();if(r.rangeCount){for(t=document.createElement("div"),e=r.rangeCount,i=0;i<e;++i)t.appendChild(r.getRangeAt(i).cloneContents());n=this.clean.onGet(t.innerHTML)}return n},extractEndOfNode:function(t){var e=this.selection.get(),i=this.selection.range(e),n=i.cloneRange();return n.selectNodeContents(t),n.setStart(i.endContainer,i.endOffset),n.extractContents()},removeMarkers:function(){this.marker.remove()},marker:function(t){return this.marker.get(t)},markerHtml:function(t){return this.marker.html(t)}}},shortcuts:function(){return{hotkeysSpecialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},hotkeysShiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},init:function(e,i){if(!1===this.opts.shortcuts)return!e.ctrlKey&&!e.metaKey||66!==i&&73!==i||e.preventDefault(),!1;t.each(this.opts.shortcuts,t.proxy((function(t,i){this.shortcuts.build(e,t,i)}),this))},build:function(e,i,n){var r,s=t.proxy((function(){this.shortcuts.buildHandler(n)}),this),o=i.split(","),a=o.length;for(r=0;r<a;r++)"string"==typeof o[r]&&this.shortcuts.handler(e,t.trim(o[r]),s)},buildHandler:function(t){var e;"-1"!==t.func.search(/\./)?void 0!==this[(e=t.func.split("."))[0]]&&this[e[0]][e[1]].apply(this,t.params):this[t.func].apply(this,t.params)},handler:function(e,i,n){var r,s,o,a,l,c;for(i=i.toLowerCase().split(" "),r=this.shortcuts.hotkeysSpecialKeys[e.keyCode],s=String.fromCharCode(e.which).toLowerCase(),o="",a={},t.each(["alt","ctrl","meta","shift"],(function(t,i){e[i+"Key"]&&r!==i&&(o+=i+"+")})),r&&(a[o+r]=!0),s&&(a[o+s]=!0,a[o+this.shortcuts.hotkeysShiftNums[s]]=!0,"shift+"===o&&(a[this.shortcuts.hotkeysShiftNums[s]]=!0)),l=i.length,c=0;c<l;c++)if(a[i[c]])return e.preventDefault(),n.apply(this,arguments)}}},storage:function(){return{data:[],add:function(){},status:function(){},observe:function(){},changes:function(){}}},toolbar:function(){return{build:function(){this.button.hideButtons(),this.button.hideButtonsOnMobile(),this.$toolbarBox=t('<div class="redactor-toolbar-box" />'),this.$toolbarBox[0].innerHTML='<ul class="redactor-toolbar" id="redactor-toolbar-'+this.uuid+'" role="toolbar"></ul>',this.$toolbar=t(this.$toolbarBox[0].children[0]),this.$box[0].insertBefore(this.$toolbarBox[0],this.$box[0].firstChild),this.button.$toolbar=this.$toolbar,this.button.setFormatting(),this.button.load(this.$toolbar),require(["Core"],function(t){this.$toolbar[0].addEventListener("keydown",this.toolbar.keydown.bind(this,t))}.bind(this))},createContainer:function(){},append:function(){},setOverflow:function(){},setFixed:function(){},setUnfixed:function(){},getBoxTop:function(){},observeScroll:function(){},observeScrollResize:function(){},observeScrollEnable:function(){},observeScrollDisable:function(){},setDropdownsFixed:function(){},unsetDropdownsFixed:function(){},setDropdownPosition:function(){},keydown:function(e,i){var n,r,s,o,a,l=document.activeElement;if(l.classList.contains("re-button")&&-1!==[13,32,35,36,37,39,40].indexOf(i.which)){if(13===i.which||32===i.which)return i.preventDefault(),void require(["Core"],(function(t){t.triggerEvent(l,"mousedown")}));if(40===i.which){if("true"!==elAttr(l,"aria-haspopup"))return;return i.preventDefault(),e.triggerEvent(l,"mousedown"),n=t(l).data("dropdown"),void((r=elBySel("li",n[0]))&&r.focus())}i.preventDefault(),s=Array.prototype.slice.call(elBySelAll(".re-button",this.$toolbar[0])),o=null,35===i.which?o=s[s.length-1]:36===i.which?o=s[0]:(a=s.indexOf(l),37===i.which?-1===--a&&(a=s.length-1):39===i.which&&++a===s.length&&(a=0),o=s[a]),null!==o&&o.focus()}}}},upload:function(){return{init:function(){},directUpload:function(){},onDrop:function(){},traverseFile:function(){},setConfig:function(){},getType:function(){},getHiddenFields:function(){},send:function(){},onDrag:function(){},onDragLeave:function(){},clearImageFields:function(){},addImageFields:function(){},removeImageFields:function(){},clearFileFields:function(){},addFileFields:function(){},removeFileFields:function(){}}},uploads3:function(){return{send:function(){},executeOnSignedUrl:function(){},createCORSRequest:function(){},sendToS3:function(){}}},utils:function(){return{isEmpty:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=void 0===e?this.core.editor().html():e).replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),""===(e=t.trim(e))},isElement:function(t){try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}},strpos:function(t,e,i){var n=t.indexOf(e,i);return n>=0&&n},dataURItoBlob:function(t){var e,i,n,r;for(e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return new Blob([n],{type:i})},getOuterHtml:function(e){return t("<div>").append(t(e).eq(0).clone()).html()},cloneAttributes:function(e,i){var n,r,s;for(e=e[0]||e,i=t(i),r=(n=e.attributes).length;r--;)s=n[r],i.attr(s.name,s.value);return i},breakBlockTag:function(){var e,i,n,r,s=this.selection.block();return!!s&&(e=this.utils.isEmpty(s.innerHTML),"pre"!==(i=s.tagName.toLowerCase())&&"li"!==i&&"td"!==i&&"th"!==i&&(!e&&this.utils.isStartOfElement(s)?{$block:t(s),$next:t(s).next(),type:"start"}:!e&&this.utils.isEndOfElement(s)?{$block:t(s),$next:t(s).next(),type:"end"}:(n=this.selection.extractEndOfNode(s),r=t("<"+i+" />").append(n),r=this.utils.cloneAttributes(s,r),t(s).after(r),{$block:t(s),$next:r,type:"break"})))},inBlocks:function(e){var i,n,r,s,o;for(e=t.isArray(e)?e:[e],n=(i=this.selection.blocks()).length,r=!1,s=0;s<n;s++)!1!==i[s]&&(o=i[s].tagName.toLowerCase(),-1!==t.inArray(o,e)&&(r=!0));return r},inInlines:function(e){var i,n,r,s,o;for(e=t.isArray(e)?e:[e],n=(i=this.selection.inlines()).length,r=!1,s=0;s<n;s++)o=i[s].tagName.toLowerCase(),-1!==t.inArray(o,e)&&(r=!0);return r},isTag:function(e,i){var n=t(e).closest(i,this.core.editor()[0]);return 1===n.length&&n[0]},isBlock:function(t){return null!==t&&((t=t[0]||t)&&this.utils.isBlockTag(t.tagName))},isBlockTag:function(t){return void 0!==t&&this.reIsBlock.test(t)},isInline:function(t){return(t=t[0]||t)&&this.utils.isInlineTag(t.tagName)},isInlineTag:function(t){return void 0!==t&&this.reIsInline.test(t)},isRedactorParent:function(e){return!!e&&(0!==t(e).parents(".redactor-in").length&&!t(e).hasClass("redactor-in")&&e)},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(e){var i,n=this.selection.parent(),r=this.selection.current();return t.isArray(e)?(i=0,t.each(e,t.proxy((function(t,e){this.utils.isCurrentOrParentOne(r,n,e)&&i++}),this)),0!==i):this.utils.isCurrentOrParentOne(r,n,e)},isCurrentOrParentOne:function(t,e,i){return i=i.toUpperCase(),e&&e.tagName===i?e:!(!t||t.tagName!==i)&&t},isEditorRelative:function(){var e=this.core.editor().css("position"),i=["absolute","fixed","relative"];return-1!==t.inArray(i,e)},setEditorRelative:function(){this.core.editor().addClass("redactor-relative")},getScrollTarget:function(){var e=t(this.opts.scrollTarget);return 0!==e.length?e:t(document)},freezeScroll:function(){this.freezeScrollTop=this.utils.getScrollTarget().scrollTop(),this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},unfreezeScroll:function(){void 0!==this.freezeScrollTop&&this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},saveScroll:function(){this.tmpScrollTop=this.utils.getScrollTarget().scrollTop()},restoreScroll:function(){void 0!==this.tmpScrollTop&&this.utils.getScrollTarget().scrollTop(this.tmpScrollTop)},isStartOfElement:function(t){return!(void 0===t&&!(t=this.selection.block()))&&0===this.offset.get(t)},isEndOfElement:function(e){var i;return!(void 0===e&&!(e=this.selection.block()))&&(i=t.trim(t(e).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,""),this.offset.get(e)===i.length)},removeEmptyAttr:function(e,i){var n=t(e);return void 0===n.attr(i)||""===n.attr(i)&&(n.removeAttr(i),!0)},replaceToTag:function(e,i){var n;return t(e).replaceWith((function(){n=t("<"+i+" />").append(t(this).contents());for(var e=0;e<this.attributes.length;e++)n.attr(this.attributes[e].name,this.attributes[e].value);return n})),n},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},disableBodyScroll:function(){},measureScrollbar:function(){var e,i=t("body"),n=document.createElement("div");return n.className="redactor-scrollbar-measure",i.append(n),e=n.offsetWidth-n.clientWidth,i[0].removeChild(n),e},enableBodyScroll:function(){},appendFields:function(e,i){var n;return e?"object"==typeof e?(t.each(e,(function(e,n){null!==n&&0===n.toString().indexOf("#")&&(n=t(n).val()),i.append(e,n)})),i):(0===(n=t(e)).length||("",n.each((function(){i.append(t(this).attr("name"),t(this).val())}))),i):i},appendForms:function(e,i){var n,r;return e?(0===(n=t(e)).length||(r=n.serializeArray(),t.each(r,(function(t,e){i.append(e.name,e.value)}))),i):i},isRgb:function(t){return 0===t.search(/^rgb/i)},rgb2hex:function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""},isCollapsed:function(){return this.selection.isCollapsed()},isMobile:function(){return this.detect.isMobile()},isDesktop:function(){return this.detect.isDesktop()},isPad:function(){return this.detect.isIpad()}}},browser:function(){return{webkit:function(){return this.detect.isWebkit()},ff:function(){return this.detect.isFirefox()},ie:function(){return this.detect.isIe()}}}},t(window).on("load.tools.redactor",(function(){t('[data-tools="redactor"]').redactor()})),e.prototype.init.prototype=e.prototype}(jQuery),function(t){function e(e,i,n,r){var s={duration:.5,iterate:1,delay:0,prefix:"redactor-",timing:"linear"};this.animation=i,this.slide="slideDown"===this.animation||"slideUp"===this.animation,this.$element=t(e),this.prefixes=["","-moz-","-o-animation-","-webkit-"],this.queue=[],"function"==typeof n?(r=n,this.opts=s):this.opts=t.extend(s,n),this.slide&&this.$element.height(this.$element.height()),this.init(r)}t.fn.redactorAnimation=function(t,i,n){return this.each((function(){new e(this,t,i,n)}))},e.prototype={init:function(t){this.queue.push(this.animation),this.clean(),"show"===this.animation?(this.opts.timing="linear",this.$element.removeClass("hide").show(),"function"==typeof t&&t(this)):"hide"===this.animation?(this.opts.timing="linear",this.$element.hide(),"function"==typeof t&&t(this)):this.animate(t)},animate:function(e){this.$element.addClass("redactor-animated").css("display","").removeClass("hide"),this.$element.addClass(this.opts.prefix+this.queue[0]),this.set(this.opts.duration+"s",this.opts.delay+"s",this.opts.iterate,this.opts.timing);var i=this.queue.length>1?null:e;this.complete("AnimationEnd",t.proxy((function(){this.$element.hasClass(this.opts.prefix+this.queue[0])&&(this.clean(),this.queue.shift(),this.queue.length&&this.animate(e))}),this),i)},set:function(t,e,i,n){for(var r=this.prefixes.length;r--;)this.$element.css(this.prefixes[r]+"animation-duration",t),this.$element.css(this.prefixes[r]+"animation-delay",e),this.$element.css(this.prefixes[r]+"animation-iteration-count",i),this.$element.css(this.prefixes[r]+"animation-timing-function",n)},clean:function(){this.$element.removeClass("redactor-animated"),this.$element.removeClass(this.opts.prefix+this.queue[0]),this.set("","","","")},complete:function(e,i,n){this.$element.one(e.toLowerCase()+" webkit"+e+" o"+e+" MS"+e,t.proxy((function(){"function"==typeof i&&i(),"function"==typeof n&&n(this);-1!==t.inArray(this.animation,["fadeOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"])&&this.$element.css("display","none"),this.slide&&this.$element.css("height","")}),this))}}}(jQuery); })(this);

// plugins/WoltLabArticle.js
(function (window, undefined) { $.Redactor.prototype.WoltLabArticle=function(){"use strict";return{init:function(){var t=this.button.add("woltlabArticle","");require(["WoltLabSuite/Core/Ui/Redactor/Article"],function(i){new i(this,t[0])}.bind(this))}}}; })(this);

// plugins/WoltLabAttachment.js
(function (window, undefined) { $.Redactor.prototype.WoltLabAttachment=function(){"use strict";return{init:function(){this.opts.woltlab.attachments&&require(["EventHandler"],function(t){t.add("com.woltlab.wcf.redactor2","insertAttachment_"+this.$element[0].id,this.WoltLabAttachment._insert.bind(this)),t.add("com.woltlab.wcf.redactor2","deleteAttachment_"+this.$element[0].id,this.WoltLabAttachment._delete.bind(this)),t.add("com.woltlab.wcf.redactor2","replaceAttachment_"+this.$element[0].id,this.WoltLabAttachment._replaceAttachment.bind(this))}.bind(this))},_insert:function(t){var e,a,n,i,c;if(!this.WoltLabSource.isActive()){if(e=t.attachmentId,this.buffer.set(),t.url){for(a="wcfImgAttachment"+this.uuid,(n=elById(a))&&n.removeAttribute("id"),this.insert.html('<img src="'+t.url+'" class="woltlabAttachment" data-attachment-id="'+e+'" id="'+a+'">'),i=!0,c=n=elById(a);c=c.nextSibling;)if(c.nodeType!==Node.TEXT_NODE||""!==c.textContent.replace(/\u200B/g,"").trim()){i=!1;break}i?this.caret.after(n.parentNode):window.setTimeout(function(){var t,e,n,i=elById(a);i&&(i.removeAttribute("id"),(t=i.nextSibling)&&t.nodeType===Node.TEXT_NODE&&"​"===t.textContent||(t=document.createTextNode("​"),i.parentNode.insertBefore(t,i.nextSibling)),(e=document.createRange()).selectNode(t),e.collapse(!1),(n=window.getSelection()).removeAllRanges(),n.addRange(e))}.bind(this),10)}else this.insert.text("[attach="+e+"][/attach]");this.buffer.set()}},_replaceAttachment:function(t){var e=elCreate("img");e.className="woltlabAttachment",e.src=t.src,elData(e,"attachment-id",t.attachmentId),t.img.parentNode.insertBefore(e,t.img),elRemove(t.img)},_delete:function(t){var e,a,n,i,c,o,r=t.attachmentId,l=this.core.editor()[0];if(elBySelAll('.woltlabAttachment[data-attachment-id="'+r+'"]',l,(function(t){elRemove(t)})),e="[attach="+r+"][/attach]",!1!==l.textContent.indexOf(e)){for(a=document.createTreeWalker(l,NodeFilter.SHOW_TEXT,null,!1),i=[];n=a.nextNode();)-1!==n.textContent.indexOf(e)&&i.push(n);for(c=0,o=i.length;c<o;c++)i[c].textContent=i[c].textContent.replace(new RegExp("\\[attach="+r+"\\]\\[\\/attach\\]","g"),"")}}}}; })(this);

// plugins/WoltLabAutosave.js
(function (window, undefined) { $.Redactor.prototype.WoltLabAutosave=function(){"use strict";return{init:function(){this.opts.woltlab.autosave&&(this.opts.woltlab.autosave.watch(this),this.opts.woltlab.autosave.createOverlay(),WCF.System.Event.addListener("com.woltlab.wcf.redactor2","autosaveDestroy_"+this.$element[0].id,this.WoltLabAutosave.destroy.bind(this)),WCF.System.Event.addListener("com.woltlab.wcf.redactor2","autosaveReset_"+this.$element[0].id,this.WoltLabAutosave.reset.bind(this)))},destroy:function(){this.opts.woltlab.autosave&&this.opts.woltlab.autosave.destroy()},reset:function(){this.opts.woltlab.autosave&&this.opts.woltlab.autosave.clear()}}}; })(this);

// plugins/WoltLabBlock.js
(function (window, undefined) { $.Redactor.prototype.WoltLabBlock=function(){"use strict";return{preserveBlocks:["pre","woltlab-quote","woltlab-spoiler"],init:function(){var e,t;this.block.tags=["p","blockquote","pre","h1","h2","h3","h4","h5","h6","div","figure"],this.block.format=function(e,t,o,i){if(e="quote"===e?"blockquote":e,-1!==$.inArray(e,this.block.tags))return"p"===e&&void 0===t&&(t="class"),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.block.formatCollapsed(e,t,o,i):this.block.formatUncollapsed(e,t,o,i)}.bind(this),e=function(e,t){return!(document.activeElement!==e||!1===t||!this.utils.isRedactorParent(t))}.bind(this),t=this.block.formatCollapsed,this.block.formatCollapsed=function(o,i,s,r){var l,n,a,h,c,d=this.selection.block();if(!d||"LI"!==d.nodeName&&"TD"!==d.nodeName){if(l=this.core.editor()[0],e(l,d)||(this.selection.restore(),document.activeElement!==l&&l.focus()),e(l,d)||(this.focus.end(),this.selection.save()),1===(a=(n=t.call(this,o,i,s,r)).length)&&n[0].nodeName.match(/^H[1-6]$/))1===(h=n[0]).childElementCount&&"BR"===h.children[0].nodeName&&this.utils.isEmpty(h.innerHTML)&&(h.innerHTML="​");else for(c=0;c<a;c++)this.WoltLabBlock._paragraphize(n[c]);return this.caret.end(n),n}}.bind(this),this.block.formatUncollapsed=function(e,t,o,i){var s,r,l,n,a,h,c,d,p,f;for(this.selection.save(),this.selection.blocks().forEach((function(e){if("OL"===e.nodeName||"UL"===e.nodeName){e.parentNode.nodeName.toLowerCase();var t=elCreate("div");e.parentNode.insertBefore(t,e),t.appendChild(e)}})),this.selection.restore(),this.selection.save(),l=[],(n=this.selection.blocks())[0]&&($(n[0]).hasClass("redactor-in")||$(n[0]).hasClass("redactor-box"))&&(n=this.core.editor().find(this.opts.blockTags.join(", "))),a=n.length,r=0;r<a;r++)if(h=n[r].tagName.toLowerCase(),-1!==$.inArray(h,this.block.tags)&&"figure"!==h){if("pre"!==e&&-1!==this.WoltLabBlock.preserveBlocks.indexOf(n[r].nodeName.toLowerCase())?(s=elCreate(e),n[r].parentNode.insertBefore(s,n[r]),s.appendChild(n[r]),s=$(s)):s=this.utils.replaceToTag(n[r],e),"object"==typeof t)for(c in i=o,t)s=this.block.setAttr(s,c,t[c],i);else s=this.block.setAttr(s,t,o,i);l.push(s),this.block.removeInlineTags(s)}for(this.selection.restore(),"pre"===e&&0!==l.length&&(d=l[0],$.each(l,(function(e,t){0!==e&&($(d).append("\n"+$.trim(t.html())),$(t).remove())})),(l=[]).push(d)),f=null,r=0,p=l.length;r<p;r++)if(s=l[r][0]||l[r],this.WoltLabBlock._paragraphize(s),0===r)f=s;else{for(;s.childNodes.length;)f.appendChild(s.childNodes[0]);elRemove(s)}return f&&elBySelAll("br",f,(function(e){e.parentNode.insertBefore(document.createTextNode("\n"),e),elRemove(e)})),$(f)}.bind(this),this.block.removeAllAttr=function(e){e=this.block.getBlocks(e);var t=[];return $.each(e,(function(e,o){for(void 0===o.attributes&&t.push(o);o.attributes.length;)o.removeAttribute(o.attributes[0].name);t.push(o)})),t}.bind(this),this.block.getBlocks=function(e){var t,o;return e=void 0===e?this.selection.blocks():e,$(e).hasClass("redactor-box")||$(e).hasClass("redactor-layer")?(t=[],o=this.core.editor().children(),$.each(o,$.proxy((function(e,o){this.utils.isBlock(o)&&t.push(o)}),this)),t):e}.bind(this)},register:function(e,t){-1===this.block.tags.indexOf(e)&&(this.block.tags.push(e),this.opts.paragraphizeBlocks.push(e),-1===this.opts.blockTags.indexOf(e)&&(this.opts.blockTags.push(e),this.reIsBlock=new RegExp("^("+this.opts.blockTags.join("|").toUpperCase()+")$","i")),t&&this.WoltLabKeydown.register(e))},_paragraphize:function(e){var t,o,i,s,r,l,n;if(-1===["p","pre","h1","h2","h3","h4","h5","h6","div","figure"].indexOf(e.nodeName.toLowerCase())){for(o=!1,i=0,s=e.childNodes.length;i<s;i++){if((t=e.childNodes[i]).nodeType===Node.TEXT_NODE){o=!0;break}if(t.nodeType===Node.ELEMENT_NODE&&-1===this.block.tags.indexOf(t.nodeName.toLowerCase())){o=!0;break}}if(o)for(r=e.childNodes[0],n=null;r;)l=r.nextSibling,r.nodeType!==Node.ELEMENT_NODE||-1===this.block.tags.indexOf(r.nodeName.toLowerCase())?(null===n&&(n=elCreate("p"),e.insertBefore(n,r)),n.appendChild(r)):null!==n&&(n=null),r=l}}}}; })(this);

// plugins/WoltLabButton.js
(function (window, undefined) { $.Redactor.prototype.WoltLabButton=function(){"use strict";var t;return{init:function(){var t,e,o,n,s,i,a,r,l,d,c,u,h,b;for(o=0,n=this.opts.woltlab.customButtons.length;o<n;o++)e=this.opts.woltlab.customButtons[o],t=this.button.add(e,""),this.button.addCallback(t,this.WoltLabButton._handleCustomButton);for(s=this.core.toolbar()[0],o=0,n=this.opts.buttons.length;o<n;o++)if("wcfSeparator"!==(e=this.opts.buttons[o])){if(!this.opts.woltlab.buttons.hasOwnProperty(e))throw new Error("Missing button definition for '"+e+"'.");switch(i=this.opts.woltlab.buttons[e],"underline"===e&&(this.opts.activeButtonsStates.u="underline"),e){case"subscript":case"superscript":t=this.button.addAfter(this.opts.buttons[o-1],e,""),this.button.setEvent(t,e,{func:"inline.format"}),this.opts.activeButtonsStates["subscript"===e?"sub":"sup"]=e;break;case"redo":case"undo":t=this.button.addAfter(this.opts.buttons[o-1],e,""),this.button.addCallback(t,this.buffer[e]);break;default:t=this.button.get(e)}if(r=!(a=i.icon).match(/^fa-/)&&a.match(/\.(gif|jpe?g|png|svg)$/),this.button.setIcon(t,'<span class="icon icon16 '+(r?"redactorButtonImage":a)+'"'+(r?" style=\"background-image: url('"+WCF_PATH+"icon/"+a+"')\"":"")+"></span>"),!t[0])throw new Error("Missing button element for '"+e+"'.");t[0].title=i.title,t[0].classList.add("jsTooltip"),"lists"===e&&(l=t.data("dropdown"),elBySel(".redactor-dropdown-outdent span",l[0]).textContent=WCF.Language.get("wcf.editor.list.outdent"),elBySel(".redactor-dropdown-indent span",l[0]).textContent=WCF.Language.get("wcf.editor.list.indent"))}for(d=this.opts.buttons.indexOf("tt"),-1!==this.opts.buttons.indexOf("code")&&-1!==d&&(this.opts.buttons.splice(d,1),this.opts.buttons.splice(this.opts.buttons.indexOf("code")+1,0,"tt")),u={},h=[];s.childElementCount;)c=s.removeChild(s.children[0]),e=elAttr(c.children[0],"rel"),u[e]=c,h.push(e);for(b=!1,o=0,n=this.opts.buttons.length;o<n;o++)"wcfSeparator"!==(e=this.opts.buttons[o])?(c=u[e],s.appendChild(c),h.splice(h.indexOf(e),1),b&&(c.classList.add("redactor-toolbar-separator"),b=!1)):b=!0;for(o=0,n=s.childElementCount;o<n;o++)t=(c=s.children[o]).children[0],elData(c,"show-on-mobile",-1!==this.opts.woltlab.buttonMobile.indexOf(t.rel));h.forEach((function(t){s.appendChild(u[t])})),WCF.DOMNodeInsertedHandler.execute(),require(["Ui/Screen"],function(t){t.on("screen-xs",{match:this.WoltLabButton._enableToggleButton.bind(this),unmatch:this.WoltLabButton._disableToggleButton.bind(this),setup:this.WoltLabButton._setupToggleButton.bind(this)})}.bind(this)),s.addEventListener("dragstart",(function(t){t.preventDefault()})),elAttr(elBySel(".re-html",s),"tabindex",0)},_handleCustomButton:function(t){var e,o,n={cancel:!1};if(WCF.System.Event.fireEvent("com.woltlab.wcf.redactor2","bbcode_"+t+"_"+this.$element[0].id,n),!0!==n.cancel){const n=this.selection.block();if(n&&"PRE"===n.nodeName)return;this.buffer.set(),(e=this.marker.get()).classList.add("woltlab-bbcode-marker"),o="["+t+"]"+this.selection.html()+e.outerHTML+"[/"+t+"]",this.insert.html(o),this.selection.restore()}window.setTimeout(function(){document.activeElement!==this.$editor[0]&&this.$editor[0].focus()}.bind(this),10)},_enableToggleButton:function(){null===t.parentNode&&this.$toolbar[0].appendChild(t)},_disableToggleButton:function(){t&&null!==t.parentNode&&this.$toolbar[0].removeChild(t)},_setupToggleButton:function(){var e,o;(t=elCreate("li")).className="redactorToolbarToggle",t.innerHTML='<a href="#"><span class="icon icon16 fa-caret-down"></span></a>',elData(t,"show-on-mobile",!0),e=t.children[0].children[0],o=function(t){t instanceof Event&&t.preventDefault(),this.$toolbar[0].classList.toggle("redactorToolbarOverride")&&document.activeElement&&document.activeElement!==this.$editor[0]&&document.activeElement.blur(),e.classList.toggle("fa-caret-down"),e.classList.toggle("fa-caret-up")}.bind(this),t.children[0].addEventListener("mousedown",o),this.$toolbar[0].appendChild(t),WCF.System.Event.addListener("com.woltlab.wcf.redactor2","reset_"+this.$element[0].id,function(){this.$toolbar[0].classList.contains("redactorToolbarOverride")&&o()}.bind(this))}}}; })(this);

// plugins/WoltLabCaret.js
(function (window, undefined) { $.Redactor.prototype.WoltLabCaret=function(){"use strict";var e,t=!1,n=!1;return{init:function(){var i,o,r,a,s,l,d=this.caret.after;this.caret.after=function(e){e=this.caret.prepare(e),this.utils.isBlockTag(e.tagName)&&this.WoltLabCaret._addParagraphAfterBlock(e),d.call(this,e)}.bind(this),i=this.caret.start,this.caret.start=function(e){if(n){if(!(e=this.caret.prepare(e)))return;"P"===e.nodeName&&"​"===e.innerHTML&&(e.innerHTML="<br>")}i.call(this,e)}.bind(this),o=this.core.editor()[0],require(["Environment"],function(i){var r,a;t="ios"===i.platform(),(n="safari"===i.browser())&&o.classList.add("jsSafariMarginClickTarget"),r=this.WoltLabCaret._handleEditorClick.bind(this),a=this.WoltLabCaret._handleEditorMouseUp.bind(this),n&&t?(o.addEventListener("touchstart",(function(t){e=t.target}),{passive:!0}),o.addEventListener("touchend",function(e){r(e),a(e)}.bind(this))):(o.addEventListener("click",function(e){this.WoltLabCaret._detectTripleClick(e),r(e)}.bind(this)),o.addEventListener("mouseup",a))}.bind(this)),r=this.caret.end,this.caret.end=function(e){var n,i,o,a;return"OL"!==(e=this.caret.prepare(e)).nodeName&&"UL"!==e.nodeName||null===(e=e.lastElementChild)&&(e=e.parentNode),n=!1,e.nodeType===Node.ELEMENT_NODE&&e.lastChild&&"P"===e.lastChild.nodeName?n=!0:t?(i=this.core.editor()[0],e.parentNode===i&&"<p><br></p>"===i.innerHTML&&(n=!0)):"P"===e.nodeName&&0===e.childNodes.length&&(e.innerHTML="​",n=!0),n?(o=window.getSelection(),(a=document.createRange()).selectNodeContents(e.lastChild),a.collapse(!1),o.removeAllRanges(),void o.addRange(a)):"P"===e.nodeName&&1===e.childNodes.length&&"BR"===e.childNodes[0].nodeName?this.caret.before(e.childNodes[0]):r.call(this,e)}.bind(this),a=this.selection.nodes,this.selection.nodes=function(e){var t,n=a.call(this,e);return 1===n.length&&n[0]===this.$editor[0]&&(t=this.selection.range(this.selection.get())).startContainer===t.endContainer?[t.startContainer]:n}.bind(this),this.WoltLabCaret._initInternalRange(),s=this.selection.saveInstant,this.selection.saveInstant=function(){var e,t,n=s.call(this);return n&&(n.isAtNodeStart=!1,(e=window.getSelection()).rangeCount&&!e.isCollapsed&&(t=e.getRangeAt(0)).startContainer.nodeType===Node.TEXT_NODE&&0===t.startOffset&&(n.isAtNodeStart=!0)),n}.bind(this),l=this.selection.restoreInstant,this.selection.restoreInstant=function(e){var t,n,i,o,r,a,s,d;if((void 0!==e||this.saved)&&(t=void 0!==e?e:this.saved,l.call(this,e),(n=window.getSelection()).rangeCount))if(!0===t.isAtNodeStart){if(!n.isCollapsed){if(o=(i=n.getRangeAt(0)).startContainer,t.node===o)return;for(;null!==o&&"P"!==o.nodeName;)o=o.parentNode;if(null!==o&&null!==(o=o.nextElementSibling)&&"P"===o.nodeName&&0===o.textContent.replace(/\u200B/g,"").length){for(o=o.nextElementSibling,r=t.node;null!==r&&r!==o;)r=r.parentNode;r===o&&((i=i.cloneRange()).setStart(t.node,0),n.removeAllRanges(),n.addRange(i))}}}else n.isCollapsed&&(a=n.anchorNode,s=this.core.editor()[0],a.nodeType===Node.TEXT_NODE&&a.parentNode===s&&n.anchorOffset===a.textContent.length&&(d=a.nextElementSibling)&&"P"===d.nodeName&&this.caret.start(d))}.bind(this),this.selection.nodes=function(e){var t,n,i,o=void 0===e?[]:$.isArray(e)?e:[e],r=this.selection.get(),a=this.selection.range(r),s=[],l=[];if(this.utils.isCollapsed())s=[this.selection.current()];else{if((t=a.startContainer)===(n=a.endContainer))return[t];for(i=a.commonAncestorContainer;t&&t!==n;)s.push(t=this.selection.nextNode(t,i));for(t=a.startContainer;t&&t!==i;)s.unshift(t),t=t.parentNode}return $.each(s,(function(e,t){if(t){var n=1===t.nodeType&&t.tagName.toLowerCase();if($(t).hasClass("redactor-script-tag")||$(t).hasClass("redactor-selection-marker"))return;if(n&&0!==o.length&&-1===$.inArray(n,o))return;l.push(t)}})),0===l.length?[]:l}.bind(this),this.selection.nextNode=function(e,t){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)if(e=e.parentNode,t&&e===t)return null;return e?e.nextSibling:null}},paragraphAfterBlock:function(e){var t=e.nextElementSibling;t&&"P"!==t.nodeName&&(t=elCreate("p"),"<p><br></p>"===this.opts.emptyHtml?t.innerHTML="<br>":t.textContent="​",e.parentNode.insertBefore(t,e.nextSibling)),this.caret.after(e)},endOfEditor:function(){var e,t=this.core.editor()[0];document.activeElement!==t&&t.focus(),"P"===(e=t.lastElementChild).nodeName?this.caret.end(e):this.caret.after(e)},_initInternalRange:function(){var e,t,n,i,o,r=this.core.editor()[0],a=null,s=window.getSelection(),l=function(){a=s.rangeCount?s.getRangeAt(0).cloneRange():null};this.WoltLabCaret.forceSelectionSave=l,e=function(){var e,t,n,i;if(null!==a){if(document.activeElement===r){if(0!==(e=s.getRangeAt(0)).startOffset)return;for(t=e.startContainer;t;){if(t.parentNode===r){if(t.previousSibling)return;break}if(t.previousSibling)return;t=t.parentNode}if(!t)return}n=r.scrollLeft,i=r.scrollTop,r.focus(),r.scrollLeft=n,r.scrollTop=i,s.removeAllRanges(),s.addRange(a),a=null}},r.addEventListener("keyup",l),r.addEventListener("mouseup",(function(){s.rangeCount&&l()})),t=this.selection.save,this.selection.save=function(){a=null,t.call(this)}.bind(this),n=this.selection.restore,this.selection.restore=function(){a&&null===elBySel(".redactor-selection-marker",this.$editor[0])&&(e(),s.rangeCount&&this.utils.isRedactorParent(s.getRangeAt(0).commonAncestorContainer))||n.call(this)}.bind(this),i=this.buffer.set,this.buffer.set=function(t){if(document.activeElement!==r){var n=window.getSelection();n.rangeCount&&!1!==this.utils.isRedactorParent(n.anchorNode)?r.focus():e()}i.call(this,t),l()}.bind(this),o=this.insert.html,this.insert.html=function(e,t){var n=elBySel(".redactor-selection-marker",this.$editor[0]);o.call(this,e,t),(n||null===elBySel(".redactor-selection-marker",this.$editor[0]))&&l()}.bind(this),require(["Environment"],function(e){"ios"===e.platform()&&(r.addEventListener("focus",(function(){document.addEventListener("selectionchange",l)})),r.addEventListener("blur",(function(){document.removeEventListener("selectionchange",l)})))}.bind(this))},_detectTripleClick:function(e){var t,n,i;e.detail<3||(t=window.getSelection()).isCollapsed||"TR"===(n=t.getRangeAt(0)).commonAncestorContainer.nodeName&&(i=elClosest(n.startContainer,"td"),(n=document.createRange()).selectNodeContents(i),t.removeAllRanges(),t.addRange(n))},_handleEditorClick:function(i){var o,r,a,s,l,d,c,h,u,f,g,N=this.selection.get();if((!N.anchorNode||this.core.editor()[0].contains(N.anchorNode))&&(o=i.clientY,r=t&&e===i.target&&this.utils.isBlockTag(e.nodeName),void 0===o&&r&&(o=i.changedTouches[0].clientY),(this.selection.get().isCollapsed||r&&void 0!==o)&&(!1!==(a=this.selection.block())||(this.selection.current()===this.$editor[0]&&(s=this.$editor[0].childNodes[this.selection.get().anchorOffset])&&s.nodeType===Node.ELEMENT_NODE&&"TABLE"===s.nodeName&&(a=s),!1!==a)))){for(l=!1,n&&this.utils.isBlockTag(i.target.nodeName)&&o>i.target.getBoundingClientRect().bottom&&(a=i.target,l=!0),d=i.target;d&&!this.utils.isBlockTag(d.nodeName);)d=d.parentNode;if(d&&(l||d!==a)&&("P"!==a.nodeName||(a=a.parentNode)!==this.$editor[0]&&this.utils.isBlockTag(a.nodeName))){if("TD"===a.nodeName)for(;"TABLE"!==a.nodeName;)a=a.parentNode;if(!a.nodeName.match(/^H\d$/)&&!$(a).closest("ol, ul",this.$editor[0]).length){for(u=a;u;){if(o<(h=u.getBoundingClientRect()).top)c=!0,a=u;else{if(!(o>h.bottom))break;c=!1,a=u}if(!u.parentNode||u.parentNode===this.$editor[0])break;u=u.parentNode}void 0!==c&&((f=a[(c?"previous":"next")+"ElementSibling"])&&"P"===f.nodeName?this.caret.end(f):(this.buffer.set(),(g=elCreate("p")).textContent="​",a.parentNode.insertBefore(g,c?a:a.nextSibling),this.caret.end(g)))}}}},_handleEditorMouseUp:function(i){var o,r,a,s,l,d=window.getSelection();if(d.rangeCount&&(d.isCollapsed||n&&t&&e===i.target&&this.utils.isBlockTag(e.nodeName)))if(i.target===this.$editor[0])(o=d.anchorNode).nodeType===Node.TEXT_NODE&&(o=o.parentNode),"KBD"===o.nodeName&&(null!==(r=o.previousSibling)&&"​"===r.textContent||(r=document.createTextNode("​"),o.parentNode.insertBefore(r,o)),this.caret.before(r));else if("KBD"===i.target.nodeName&&(a=i.target,(o=d.anchorNode).nodeType===Node.TEXT_NODE)){for(r=o;(r=r.nextSibling)&&r.nodeType===Node.TEXT_NODE&&(""===r.textContent||"​"===r.textContent););r===a&&(0!==a.childNodes.length&&"​"===a.childNodes[0].textContent||(s=document.createTextNode("​"),a.insertBefore(s,a.firstChild)),(l=document.createRange()).setStartAfter(a.childNodes[0]),l.setEndAfter(a.childNodes[0]),d.removeAllRanges(),d.addRange(l))}},_addParagraphAfterBlock:function(e){var t=e.nextElementSibling;t&&("P"===t.nodeName||this.utils.isBlockTag(t.nodeName))||((t=elCreate("p")).textContent="​",e.parentNode.insertBefore(t,e.nextSibling))}}}; })(this);

// plugins/WoltLabClean.js
(function (window, undefined) { $.Redactor.prototype.WoltLabClean=function(){"use strict";return{init:function(){var e,t,n,l,r,i,o,a,s=this.clean.onSet;this.clean.onSet=function(e){e=(e=(e=e.replace(/\u200B/g,"")).replace(/&amp;amp;/g,"@@@WCF_LITERAL_AMP@@@")).replace(/&amp;/g,"&amp;WCF_AMPERSAND&amp;"),e=(e=(e=s.call(this,e)).replace(/&amp;WCF_AMPERSAND&(amp;)?/g,"&amp;")).replace(/@@@WCF_LITERAL_AMP@@@/g,"&amp;amp;");var t=elCreate("div");return t.innerHTML=e,elBySelAll("*",t,(function(e){var t,n,l,r=[];for(n=0,l=e.attributes.length;n<l;n++)0===(t=e.attributes[n]).name.indexOf("on")&&r.push(t.name);r.forEach(e.removeAttribute.bind(e))})),elBySelAll("iframe",t,elRemove),elBySelAll("pre",t,(function(e){e.classList.contains("redactor-script-tag")&&elRemove(e)})),elBySelAll("td",t,(function(e){0===e.childNodes.length&&(e.innerHTML="​")})),elBySelAll("pre, woltlab-quote, woltlab-spoiler",t,(function(e){0!==e.childElementCount||0!==e.textContent.length&&!e.textContent.match(/^\r?\n$/)||(e.textContent="​")})),e=t.innerHTML}.bind(this),e=this.clean.onSync,this.clean.onSync=function(t){var n,l=elCreate("div");return l.innerHTML=t,n={},elBySelAll("pre",l,(function(e){var t=WCF.getUUID();n[t]=e.textContent,e.textContent=t})),elBySelAll("p",l,(function(e){var t,n=e.lastElementChild;n&&"BR"===n.nodeName&&(n.nextSibling?n.nextSibling.textContent.replace(/[\r\n\t]/g,"").match(/^\u200B+$/)&&((t=elCreate("p")).innerHTML="<br>",e.parentNode.insertBefore(t,e.nextSibling),e.removeChild(n.nextSibling),e.removeChild(n)):(n.previousElementSibling||n.previousSibling&&""!==n.previousSibling.textContent.replace(/\u200B/g,"").trim())&&e.removeChild(n))})),elBySelAll("span",l,(function(e){if(e.childNodes.length>0){var t=e.childNodes[e.childNodes.length-1];t.nodeType===Node.TEXT_NODE&&t.textContent.match(/\n$/)&&(t.textContent=t.textContent.replace(/\n+$/,e.parentNode.lastChild===e?"":" "))}})),t=(t=(t=l.innerHTML).replace(/<p>\u200B<\/p>/g,"<p><br></p>")).replace(/&amp;/g,"&amp;WCF_AMPERSAND&amp;"),t=(t=e.call(this,t)).replace(/&WCF_AMPERSAND&/g,"&amp;"),l.innerHTML=t,elBySelAll("pre",l,(function(e){n.hasOwnProperty(e.textContent)&&(e.textContent=n[e.textContent])})),t=l.innerHTML}.bind(this),t=this.clean.savePreFormatting,this.clean.savePreFormatting=function(e){var n=this.clean.encodeEntities;return this.clean.encodeEntities=function(e){return WCF.String.escapeHTML(e)},e=t.call(this,e),this.clean.encodeEntities=n,e}.bind(this),n=this.clean.onPaste,this.clean.onPaste=function(e,t,l){var r,i,o,a,s,c,h,d,p,u,f,m,g,y,v,b;if(t.pre||this.utils.isCurrentOrParent("kbd"))return t.pre&&this.opts.preSpaces&&(e=e.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),WCF.String.escapeHTML(e);for(this.clean.isHtmlMsWord(e)&&(e=this.clean.cleanMsWord(e)),(r=elCreate("div")).innerHTML=e.replace(/@@@WOLTLAB-P-ALIGN-(?:left|right|center|justify)@@@/g,""),s=!0,o=0,a=r.childElementCount;o<a;o++){if("DIV"!==(i=r.children[o]).nodeName||0===i.childNodes.length){s=!1;break}if(1===i.childNodes.length&&1===i.childElementCount&&0===(c=i.children[0]).childNodes.length&&"BR"!==c.nodeName){s=!1;break}}if(s){for(h=[],o=0,a=r.childElementCount;o<a;o++)h.push(r.children[o]);h.forEach((function(e){var t=elCreate("p");for(r.insertBefore(t,e);e.childNodes.length>0;)t.appendChild(e.childNodes[0]);r.removeChild(e)}))}for(d=null!==elBySel(".MsoNormal",r),o=0,a=(p=elBySelAll("[style]",r)).length;o<a;o++){for(f=[],y=0,v=(i=p[o]).style.length;y<v;y++)u=i.style[y],-1===this.opts.woltlab.allowedInlineStyles.indexOf(u)&&("font-weight"===u&&"STRONG"!==i.nodeName?("bold"!==(g=i.style.getPropertyValue(u))&&"bolder"!==g||(g=600),(g=~~g)>500&&(m=elCreate("strong"),i.parentNode.insertBefore(m,i),m.appendChild(i))):d&&"margin-bottom"===u&&"P"===i.nodeName&&(g=i.style.getPropertyValue(u)).match(/^12(?:\.0)?pt$/)&&((b=elCreate("p")).innerHTML="<br>",i.parentNode.insertBefore(b,i.nextSibling)),f.push(u));f.forEach((function(e){i.style.removeProperty(e)}))}return elBySelAll("span",r,function(e){var t,n,l,r,i;if(!e.classList.contains("redactor-selection-marker"))if(e.hasAttribute("style")&&e.style.length)for(r=((t=e.style.getPropertyValue("color"))?1:0)+((n=e.style.getPropertyValue("font-family"))?1:0)+((l=e.style.getPropertyValue("font-size"))?1:0);r>0;){if(this.opts.pastePlainText)return e.style.removeProperty("color"),e.style.removeProperty("font-family"),void e.style.removeProperty("font-size");i=elCreate("span"),t?(i.style.setProperty("color",t,""),e.style.removeProperty("color"),t="",r--):n?(i.style.setProperty("font-family",n,""),e.style.removeProperty("font-family"),n="",r--):l&&(i.style.setProperty("font-size",l,""),e.style.removeProperty("font-size"),l="",r--),e.parentNode.insertBefore(i,e),i.appendChild(e)}else{for(;e.childNodes.length;)e.parentNode.insertBefore(e.childNodes[0],e);elRemove(e)}}.bind(this)),elBySelAll("p",r,(function(e){e.classList.contains("MsoNormal")?1===e.childElementCount&&"O:P"===e.children[0].nodeName&&" "===e.textContent&&(e.innerHTML="<br>"):e.className.match(/\btext-(left|right|center|justify)\b/)&&e.insertBefore(document.createTextNode("@@@WOLTLAB-P-ALIGN-"+RegExp.$1+"@@@"),e.firstChild),e.removeAttribute("class"),e.removeAttribute("style")})),elBySelAll("img",r,(function(e){e.removeAttribute("style")})),elBySelAll("br",r,(function(e){e.parentNode.insertBefore(document.createTextNode("@@@WOLTLAB-BR-MARKER@@@"),e.nextSibling)})),elBySelAll("kbd",r,(function(e){for(e.insertBefore(document.createTextNode("[tt]"),e.firstChild),e.appendChild(document.createTextNode("[/tt]"));e.childNodes.length;)e.parentNode.insertBefore(e.childNodes[0],e);elRemove(e)})),e=(e=(e=n.call(this,r.innerHTML,t,l)).replace(/\n*@@@WOLTLAB-BR-MARKER@@@\n*/g,"<woltlab-br-marker></woltlab-br-marker>")).replace(/(<p>)?\s*@@@WOLTLAB-P-ALIGN-(left|right|center|justify)@@@/g,(function(e,t,n){return t?'<p class="text-'+n+'">':""})),r.innerHTML=e.replace(/&amp;quot;/g,"&quot;"),elBySelAll("woltlab-br-marker",r,(function(e){var t,n,l,r,i,o,a,s=e.parentNode;if(null!==s){for(t=!1,n=s;null!==n;)"P"===n.nodeName&&(t=!0),n=n.parentNode;if(t){for((l=elCreate("p")).innerHTML="<br>",r=!1,(i=e.nextSibling)&&"WOLTLAB-BR-MARKER"===i.nodeName&&(r=!0),o=!r;e.nextSibling;)o&&0!==e.nextSibling.textContent.replace(/\u200B/g,"").trim().length&&(o=!1),l.appendChild(e.nextSibling);o||elRemove(l.firstElementChild),(a=e.previousSibling)&&"BR"===a.nodeName&&elRemove(a),s.parentNode.insertBefore(l,s.nextSibling),r&&((l=elCreate("p")).innerHTML="<br>",s.parentNode.insertBefore(l,s.nextSibling))}else s.insertBefore(elCreate("br"),e);elRemove(e)}})),elBySelAll("p",r,(function(e){var t=!1;0===e.childNodes.length?t=!0:""===e.textContent?(t=!0,elBySelAll("*",e,(function(e){"SPAN"!==e.nodeName&&(t=!1)}))):0===e.textContent.trim().length&&(elBySelAll("span",e,(function(e){if(!e.hasAttribute("style")||!e.style.length){for(;e.childNodes.length;)e.parentNode.insertBefore(e.childNodes[0],e);elRemove(e)}})),0===e.children.length&&(e.innerHTML="<br>")),t&&elRemove(e)})),r.innerHTML}.bind(this),l=[],r=function(e,t){var n,r,i,o,a={};for(i=0,o=t.length;i<o;i++)n=t[i],r=elAttr(e,n),"style"===n&&0===e.style.length&&0===r.indexOf("font-family")&&(r=r.replace(/&quot;/g,"")),a[n]=r;l.push({element:e,attributes:a})},i=this.clean.convertTags,this.clean.convertTags=function(e,t){var n,o,a=elCreate("div");return a.innerHTML=e,l=[],WCF.System.Event.fireEvent("com.woltlab.wcf.redactor2","convertTags_"+this.$element[0].id,{addToStorage:r,div:a}),elBySelAll("span",a,(function(e){r(e,["style"])})),l.forEach((function(e,t){var n=e.element,l=n.parentNode;for(l.insertBefore(document.createTextNode("###custom"+t+"###"),n),l.insertBefore(document.createTextNode("###/custom"+t+"###"),n.nextSibling);n.childNodes.length;)l.insertBefore(n.childNodes[0],n);l.removeChild(n)})),n=!1,t.links&&this.opts.pasteLinks&&(elBySelAll("a",a,(function(e){e.href&&(e.outerHTML='#@###[a href="'+e.href+'"]###@#'+e.innerHTML+"#@###[/a]###@#")})),n=!0,t.links=!1),o=!1,t.images&&this.opts.pasteImages&&(elBySelAll("img",a,(function(e){var t,n,l,r;if(e.src){for(t='#####[img src="'+e.src+'"',l=0,r=e.attributes.length;l<r;l++)"src"!==(n=e.attributes.item(l)).name&&(t+=" "+n.name+'="'+n.value+'"');e.outerHTML=t+"]#####"}})),o=!0,t.images=!1),e=i.call(this,a.innerHTML,t),o&&(t.images=!0),n&&(t.links=!0),e}.bind(this),o=this.clean.reconvertTags,this.clean.reconvertTags=function(e,t){if(l.length){e=e.replace(/###(\/?)custom(\d+)###/g,'<$1woltlab-custom-tag data-index="$2">');var n=elCreate("div");n.innerHTML=e,elBySelAll("woltlab-custom-tag",n,(function(e){var t,n,r,i=~~elData(e,"index");if(l[i]){for(r in t=l[i],n=elCreate(t.element.nodeName),t.attributes)t.attributes.hasOwnProperty(r)&&elAttr(n,r,t.attributes[r]);for(e.parentNode.insertBefore(n,e);e.childNodes.length;)n.appendChild(e.childNodes[0])}elRemove(e)})),e=n.innerHTML}return(t.links&&this.opts.pasteLinks||t.images&&this.opts.pasteImages)&&(e=(e=e.replace(new RegExp("#@###\\[","gi"),"<")).replace(new RegExp("\\]###@#","gi"),">")),o.call(this,e,t)}.bind(this),this.clean.removeSpans=function(e){return e},a=this.clean.getCurrentType,this.clean.getCurrentType=function(e,t){var n=a.call(this,e,t);return this.utils.isCurrentOrParent(["kbd"])&&(n.inline=!1,n.block=!1,n.encode=!0,n.pre=!0,n.paragraphize=!1,n.images=!1,n.links=!1),n}.bind(this),this.clean.removeEmptyInlineTags,this.clean.removeEmptyInlineTags=function(e){var t=this.opts.inlineTags,n=$("<div/>").html($.parseHTML(e,document,!0)),l=this,r=n.find("span"),i=n.find(t.join(","));return i.filter(":not(span)").removeAttr("style"),i.each((function(){var e=$(this).html();0===this.attributes.length&&l.utils.isEmpty(e)&&$(this).replaceWith((function(){return $(this).contents()}))})),r.each((function(){$(this).html();0===this.attributes.length&&$(this).replaceWith((function(){return $(this).contents()}))})),e=(e=(e=(e=n.html()).replace("\x3c!--?php","<?php")).replace("\x3c!--?","<?")).replace("?--\x3e","?>"),n.remove(),e}.bind(this)},removeRedundantStyles:function(){var e,t=[],n=["del","em","strong","sub","sup","u"];elBySelAll(n.join(","),this.$editor[0],(function(e){elBySelAll(e.nodeName,e,(function(e){t.push(e)}))})),this.opts.pastePlainText||(elBySelAll("span[style]",this.$editor[0],(function(e){["color","font-family","font-size"].forEach((function(n){var l=e.style.getPropertyValue(n);l&&window.getComputedStyle(e.parentNode).getPropertyValue(n)===l&&t.push(e)}))})),t.forEach((function(t){for(e=t.parentNode;t.childNodes.length;)e.insertBefore(t.childNodes[0],t);e.removeChild(t)})))}}}; })(this);

// plugins/WoltLabCode.js
(function (window, undefined) { $.Redactor.prototype.WoltLabCode=function(){"use strict";return{init:function(){var t,e,i;require(["WoltLabSuite/Core/Ui/Redactor/Code"],function(t){new t(this)}.bind(this)),t=this.code.start,this.code.start=function(e){t.call(this,e),WCF.System.Event.fireEvent("com.woltlab.wcf.redactor2","codeStart_"+this.$element[0].id),elBySelAll("kbd",this.$editor[0],(function(t){var e,i=t.nextSibling;i&&i.nodeType===Node.TEXT_NODE&&"​"===i.textContent.substr(0,1)||(e=document.createTextNode("​"),t.parentNode.insertBefore(e,i))}))}.bind(this),e=this.code.set,this.code.set=function(t,i){e.call(this,t,i),this.utils.isEmpty()&&this.observe.toolbar()}.bind(this),i=this.code.get,this.code.get=function(){return this.code.html=!1,this.code.startSync(this.core.editor().html()),i.call(this)}.bind(this)}}}; })(this);

// plugins/WoltLabColor.js
(function (window, undefined) { $.Redactor.prototype.WoltLabColor=function(){"use strict";var o=["000000","800000","8B4513","2F4F4F","008080","000080","4B0082","696969","B22222","A52A2A","DAA520","006400","40E0D0","0000CD","800080","808080","FF0000","FF8C00","FFD700","008000","00FFFF","0000FF","EE82EE","A9A9A9","FFA07A","FFA500","FFFF00","00FF00","AFEEEE","ADD8E6","DDA0DD","D3D3D3","FFF0F5","FAEBD7","FFFFE0","F0FFF0","F0FFFF","F0F8FF","E6E6FA","FFFFFF"];return{init:function(){var t,e,r,F,i,s=this.WoltLabColor.setColor.bind(this),l={};for(e=0,r=o.length;e<r;e++)l["color_"+(t=o[e])]={title:"#"+t,func:s};l.removeColor={title:this.lang.get("remove-color"),func:this.WoltLabColor.removeColor.bind(this)},F=this.button.add("woltlabColor",""),this.button.addDropdown(F,l),(i=F.data("dropdown")).find("a").each((function(o,t){t.className.match(/redactor-dropdown-color_([A-F0-9]{6})/)&&(t.style.setProperty("color","#"+RegExp.$1,""),t.parentNode.classList.add("woltlab-color-selection"))})),$('<li class="dropdownDivider"></li>').insertBefore(i.children("li").last())},setColor:function(o){o=o.replace(/^color_/,""),this.selection.save(),require(["WoltLabSuite/Core/Ui/Redactor/Format"],function(t){this.buffer.set(),t.format(this.$editor[0],"color","#"+o),this.buffer.set()}.bind(this)),this.selection.restore()},removeColor:function(){this.selection.save(),require(["WoltLabSuite/Core/Ui/Redactor/Format"],function(o){this.buffer.set(),o.removeFormat(this.$editor[0],"color"),this.buffer.set()}.bind(this)),this.selection.restore()}}}; })(this);

// plugins/WoltLabDragAndDrop.js
(function (window, undefined) { $.Redactor.prototype.WoltLabDragAndDrop=function(){"use strict";return{init:function(){(this.opts.woltlab.attachments||this.opts.woltlab.media)&&require(["WoltLabSuite/Core/Ui/Redactor/DragAndDrop"],function(t){t.init(this)}.bind(this))}}}; })(this);

// plugins/WoltLabEvent.js
(function (window, undefined) { $.Redactor.prototype.WoltLabEvent=function(){"use strict";return{init:function(){this._callbacks=[],this._elementId=this.$element[0].id,elData(this.$editor[0],"element-id",this._elementId),require(["EventHandler"],function(t){this.WoltLabEvent._setEvents(t),t.add("com.woltlab.wcf.redactor2","destroy_"+this._elementId,function(){t.removeAllBySuffix("com.woltlab.wcf.redactor2",this._elementId)}.bind(this))}.bind(this));var t=window.navigator.userAgent.toLowerCase();-1===t.indexOf("windows phone")&&-1===t.indexOf("edge/")&&(this.$editor[0].addEventListener("focus",(function(){document.documentElement.classList.add("redactorActive")})),this.$editor[0].addEventListener("focusout",(function(){window.setTimeout((function(){document.activeElement&&document.activeElement.classList.contains("redactor-layer")||document.documentElement.classList.remove("redactorActive")}),100)}))),this.events.iterateObserver=function(t){var e=!1;(("textarea"===this.opts.type||"div"===this.opts.type)&&!this.detect.isFirefox()&&t.target===this.core.editor()[0]&&"childList"===t.type&&!t.addedNodes.length&&!t.removedNodes.length||"class"===t.attributeName&&t.target===this.core.editor()[0]||"data-vivaldi-spatnav-clickable"===t.attributeName||"attributes"===t.type&&null===t.attributeName||"data-focus-visible-added"===t.attributeName)&&(e=!0),e||(this.observe.load(),this.events.changeHandler())}.bind(this),this.events.observer.disconnect(),this.events.createObserver(),this.events.setupObserver()},_setEvents:function(t){var e=this.$element[0].id,i=this.observe.load;this.observe.load=function(){i.call(this),t.fire("com.woltlab.wcf.redactor2","observe_load_"+e,{editor:this.$editor[0]})}.bind(this),this.opts.callbacks.keyup=function(i){var n={cancel:!1,event:i};return t.fire("com.woltlab.wcf.redactor","keyup_"+e,n),!1===n.cancel},t.add("com.woltlab.wcf.redactor2","getText_"+e,function(t){t.message=this.code.get()}.bind(this)),t.add("com.woltlab.wcf.redactor2","reset_"+e,function(){this.code.set("")}.bind(this))},register:function(t,e){require(["EventHandler"],function(i){var n=this.uuid;-1===this._callbacks.indexOf(t)&&(this.opts.callbacks[t]=function(e){var s={cancel:!1,event:e,redactor:this};return i.fire("com.woltlab.wcf.redactor2",t+"_"+n+"_"+this.WoltLabEvent._elementId,s),!1===s.cancel}.bind(this),this._callbacks.push(t)),require(["EventHandler"],function(i){i.add("com.woltlab.wcf.redactor2",t+"_"+n+"_"+this.WoltLabEvent._elementId,e)}.bind(this))}.bind(this))}}}; })(this);

// plugins/WoltLabFont.js
(function (window, undefined) { $.Redactor.prototype.WoltLabFont=function(){"use strict";return{_fonts:["Arial, Helvetica, sans-serif","Comic Sans MS, Marker Felt, cursive","Consolas, Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif",'Trebuchet MS", Helvetica, sans-serif',"Verdana, Geneva, sans-serif"],init:function(){var t,e,o=this.WoltLabFont.setFont.bind(this),i={};this.WoltLabFont._fonts.forEach((function(t,e){i["fontFamily_"+e]={title:t.split(",")[0].replace(/['"]/g,""),func:o}})),i.removeFont={title:this.lang.get("remove-font"),func:this.WoltLabFont.removeFont.bind(this)},t=this.button.add("woltlabFont",""),this.button.addDropdown(t,i),(e=t.data("dropdown")).find("a").each(function(t,e){e.className.match(/^redactor-dropdown-fontFamily_(\d+)$/)&&e.style.setProperty("font-family",this.WoltLabFont._fonts[RegExp.$1],"")}.bind(this)),$('<li class="dropdownDivider"></li>').insertBefore(e.children("li").last())},setFont:function(t){t=t.replace(/^fontFamily_/,""),this.selection.save(),require(["WoltLabSuite/Core/Ui/Redactor/Format"],function(e){this.buffer.set(),e.format(this.$editor[0],"font-family",this.WoltLabFont._fonts[t]),this.buffer.set()}.bind(this)),this.selection.restore()},removeFont:function(){this.selection.save(),require(["WoltLabSuite/Core/Ui/Redactor/Format"],function(t){this.buffer.set(),t.removeFormat(this.$editor[0],"font-family"),this.buffer.set()}.bind(this)),this.selection.restore()}}}; })(this);

// plugins/WoltLabFullscreen.js
(function (window, undefined) { $.Redactor.prototype.WoltLabFullscreen=function(){"use strict";var e,t=!1;return{init:function(){var l=this.button.add("woltlabFullscreen","");this.button.addCallback(l,this.WoltLabFullscreen._toggle.bind(this)),e=l[0],elHide(e.parentNode),require(["Ui/Screen"],function(l){l.on("screen-sm-up",{match:function(){elShow(e.parentNode)},unmatch:function(){elHide(e.parentNode),t&&this.WoltLabFullscreen._toggle()}.bind(this),setup:function(){elShow(e.parentNode)}})}.bind(this))},_toggle:function(){e.children[0].classList.toggle("fa-compress"),e.children[0].classList.toggle("fa-expand");var l=elClosest(this.core.box()[0],".anchorFixedHeader");l&&l.classList.toggle("disableAnchorFixedHeader"),this.core.box()[0].classList.toggle("redactorBoxFullscreen")?(WCF.System.DisableScrolling.disable(),t=!0):(WCF.System.DisableScrolling.enable(),t=!1)}}}; })(this);

// plugins/WoltLabHtml.js
(function (window, undefined) { $.Redactor.prototype.WoltLabHtml=function(){"use strict";return{init:function(){require(["WoltLabSuite/Core/Ui/Redactor/Html"],function(t){new t(this)}.bind(this))}}}; })(this);

// plugins/WoltLabImage.js
(function (window, undefined) { $.Redactor.prototype.WoltLabImage=function(){"use strict";return{init:function(){var t,e,a;this.opts.woltlab.allowImages&&(t=this.button.add("woltlabImage",""),this.button.addCallback(t,this.WoltLabImage.add)),e=this.image.showEdit,this.image.showEdit=function(t){var a,i=t[0];i.classList.contains("smiley")||(e(t),this.modal.setTitle(WCF.Language.get("wcf.editor.image.edit")),this.modal.getActionButton().text(WCF.Language.get("wcf.global.button.save")),this.modal.getDeleteButton().text(WCF.Language.get("wcf.global.button.delete")),elById("redactor-image-source").value=i.src,a=elById("redactor-image-float"),i.classList.contains("messageFloatObjectLeft")?a.value="left":i.classList.contains("messageFloatObjectRight")&&(a.value="right"),i.classList.contains("woltlabAttachment")&&elRemove(elById("redactor-image-source-container")))}.bind(this),a=this.image.update,this.image.update=function(){var t,e,i=this.observe.image[0],o=elById("redactor-image-source"),r=function(t,e){$('<small class="innerError" />').text(e).insertAfter(t)};if(!i.classList.contains("woltlabAttachment")){if(""===(t=o.value.trim()))return r(o,WCF.Language.get("wcf.global.form.error.empty"));if(!t.match(this.opts.regexps.url))return r(o,WCF.Language.get("wcf.editor.image.source.error.invalid"));if(this.opts.woltlab.forceSecureImages&&0===t.indexOf("http://"))return r(o,WCF.Language.get("wcf.editor.image.source.error.insecure"));if(!this.WoltLabImage.isValidSource(t))return r(o,WCF.Language.get("wcf.editor.image.source.error.blocked"));i.src=t}i.classList.remove("messageFloatObjectLeft"),i.classList.remove("messageFloatObjectRight"),"left"!==(e=elById("redactor-image-float").value)&&"right"!==e||i.classList.add("messageFloatObject"+WCF.String.ucfirst(e)),a.call(this),i.removeAttribute("alt"),i.removeAttribute("title"),this.caret.after(i)}.bind(this),this.opts.modal["image-edit"]='<div class="section"><dl id="redactor-image-source-container"><dt><label for="redactor-image-source">'+WCF.Language.get("wcf.editor.image.source")+'</label></dt><dd><input type="text" id="redactor-image-source" class="long"></dd></dl><dl><dt><label for="redactor-image-link">'+WCF.Language.get("wcf.editor.image.link")+'</label></dt><dd><input type="text" id="redactor-image-link" class="long"></dd></dl><dl><dt><label for="redactor-image-float">'+WCF.Language.get("wcf.editor.image.float")+'</label></dt><dd><select id="redactor-image-float"><option value="none">'+WCF.Language.get("wcf.global.noSelection")+'</option><option value="left">'+WCF.Language.get("wcf.editor.image.float.left")+'</option><option value="right">'+WCF.Language.get("wcf.editor.image.float.right")+'</option></select></dd></dl><input id="redactor-image-title" style="display: none"><input id="redactor-image-caption" style="display: none"><div class="formSubmit"><button id="redactor-modal-button-action" class="buttonPrimary">Insert</button><button id="redactor-modal-button-delete" class="redactor-modal-button-offset">Delete</button></div></div>'},add:function(){this.modal.load("image-edit",WCF.Language.get("wcf.editor.image.insert")),this.modal.show(),this.modal.getDeleteButton().hide();var t=this.modal.getActionButton()[0];t.addEventListener("click",this.WoltLabImage.insert),t.textContent=WCF.Language.get("wcf.global.button.insert"),this.WoltLabModal.rebuild()},insert:function(t){var e,a,i,o,r,l,s,n,d;return t.preventDefault(),this.modal.getModal().find(".innerError").remove(),a=function(t,e){$('<small class="innerError" />').text(e).insertAfter(t)},""===(i=(e=elById("redactor-image-source")).value.trim())?a(e,WCF.Language.get("wcf.global.form.error.empty")):i.match(this.opts.regexps.url)?this.opts.woltlab.forceSecureImages&&0===i.indexOf("http://")?a(e,WCF.Language.get("wcf.editor.image.source.error.insecure")):this.WoltLabImage.isValidSource(i)?""===(r=(o=elById("redactor-image-link")).value.trim())||r.match(this.opts.regexps.url)?(s="","left"!==(l=elById("redactor-image-float").value)&&"right"!==l||(s="messageFloatObject"+WCF.String.ucfirst(l)),n='<img src="'+WCF.String.escapeHTML(i)+'"'+(s?' class="'+s+'"':"")+">",r&&(d=WCF.getUUID(),n='<a href="'+WCF.String.escapeHTML(r)+'" data-uuid="'+d+'">'+n+"</a>"),this.modal.close(),this.buffer.set(),this.insert.html(n),void(d&&window.setTimeout(function(){var t=elBySel('a[data-uuid="'+d+'"]',this.core.editor()[0]);t&&(t.removeAttribute("data-uuid"),this.caret.after(t))}.bind(this),1))):a(o,WCF.Language.get("wcf.editor.image.link.error.invalid")):a(e,WCF.Language.get("wcf.editor.image.source.error.blocked")):a(e,WCF.Language.get("wcf.editor.image.source.error.invalid"))},isValidSource:function(t){var e,a,i=elCreate("a");return i.href=t,""===i.hostname||(!this.opts.woltlab.images.secureOnly||"https:"===i.protocol)&&!(!this.opts.woltlab.images.external&&(e=!1,a=[],this.opts.woltlab.images.whitelist.forEach((function(t){0===t.indexOf("*.")?a.push(t.replace(/^\*\./,"")):i.hostname===t&&(e=!0)})),e||a.forEach((function(t){i.hostname.substr(-1*t.length)===t&&(e=!0)})),!e))},validateImages:function(){elBySelAll("img:not(.smiley):not(.woltlabAttachment)",this.core.editor()[0],function(t){this.WoltLabImage.isValidSource(t.src)||t.classList.add("editorImageBlocked")}.bind(this))}}}; })(this);

// plugins/WoltLabIndent.js
(function (window, undefined) { $.Redactor.prototype.WoltLabIndent=function(){"use strict";return{init:function(){var e,t,i,n;this.detect.isFirefox()&&(i=this.indent.decrease,this.indent.decrease=function(){var n,l,o,r,s,a,d;if(this.list.get()){if(0===(n=$(this.selection.current()).closest("li",this.core.editor()[0])).closest("ul, ol",this.core.editor()[0]).parent().closest("ul, ol",this.core.editor()[0]).length){if(l=n[0],null!==elBySel("ul, ol",l)){if(this.buffer.set(),this.selection.save(),null!==(o=l.previousElementSibling)){for(r=elCreate(l.parentNode.nodeName.toLowerCase());o.nextSibling;)r.appendChild(o.nextSibling);(s=o.parentNode).parentNode.insertBefore(r,s.nextSibling)}if(null!==l.nextElementSibling){for(r=elCreate(l.parentNode.nodeName.toLowerCase());l.nextSibling;)r.appendChild(l.nextSibling);(s=l.parentNode).parentNode.insertBefore(r,s.nextSibling)}for(s=l.parentNode;l.childNodes.length;)s.parentNode.insertBefore(l.childNodes[0],s);return elRemove(s),void this.selection.restore()}}else{if(elBySelAll("woltlab-list-marker",this.core.editor()[0],elRemove),this.selection.save(),e=elCreate("woltlab-list-marker"),n[0].insertBefore(e,n[0].firstChild),"BR"===(a=n[0].lastElementChild).nodeName){for(d="",o=a;o=o.nextSibling;)d+=o.textContent;""===d.replace(/\u200B/g,"").trim()&&elRemove(a)}t=elCreate("woltlab-list-marker"),n[0].appendChild(t),this.selection.restore()}i.call(this)}}.bind(this),n=this.indent.removeEmpty,this.indent.removeEmpty=function(){if(e&&e.parentNode){for(var i,l=elCreate("li");(i=e.nextSibling)&&i!==t;)l.appendChild(i);e.parentNode.insertBefore(l,e),elBySelAll("woltlab-list-marker",this.core.editor()[0],elRemove),e=void 0,t=void 0}n.call(this)}.bind(this)),this.indent.repositionItem=function(e){var t,i=e.next();0===i.length||"UL"===i[0].tagName&&"OL"===i[0].tagName||e.append(i),0!==(t=e.prev()).length&&"LI"!==t[0].tagName&&(this.selection.save(),e.closest("li",this.core.editor()[0]).after(e),this.selection.restore())}.bind(this),this.indent.normalize=function(){var e,t;this.detect.isFirefox()&&(e=this.selection.block())&&"P"===e.nodeName&&(t=e.previousElementSibling)&&"BR"===t.nodeName&&elRemove(t),this.core.editor().find("li").each($.proxy((function(e,t){var i,n,l=$(t),o="";if(0!==this.opts.keepStyleAttr.length&&(o=","+this.opts.keepStyleAttr.join(",")),l.find(this.opts.inlineTags.join(",")).not("img"+o).not("span").removeAttr("style"),0===(i=l.parent()).length||"LI"!==i[0].tagName)0===(n=l.next()).length||"UL"!==n[0].tagName&&"OL"!==n[0].tagName||l.append(n);else{for(;t.nextSibling;)t.appendChild(t.nextSibling);i.after(l)}}),this))}.bind(this)}}}; })(this);

// plugins/WoltLabInlineCode.js
(function (window, undefined) { $.Redactor.prototype.WoltLabInlineCode=function(){"use strict";var e;return{init:function(){this.opts.activeButtonsStates.kbd="tt",require(["Environment","EventHandler"],function(t,o){e=t,o.add("com.woltlab.wcf.redactor2","bbcode_tt_"+this.$element[0].id,this.WoltLabInlineCode._toggle.bind(this))}.bind(this))},_toggle:function(t){var o,n,d,i,r,a,l,c,N,f,s;if(t.cancel=!0,(n=window.getSelection()).isCollapsed){if(o=null,(d=n.anchorNode).nodeType===Node.TEXT_NODE&&(d=d.parentNode),i=!1,"KBD"===d.nodeName&&""!==d.textContent.replace(/\u200b/g,"")&&(r=n.anchorNode,a=n.anchorOffset,r.nodeType===Node.TEXT_NODE&&0===a?o=r:r===d&&(0===a?i=!0:o=d.childNodes[a-1])),!1===i&&null!==o)for(c=0,N=d.childNodes.length;c<N;c++){if((l=d.childNodes[c])===o){i=!0;break}if(l.nodeType!==Node.TEXT_NODE||""!==l.textContent.replace(/\u200b/g,""))break}if(i)return null!==(f=d.previousSibling)&&f.nodeType===Node.TEXT_NODE&&"​"===f.textContent||(f=document.createTextNode("​"),d.parentNode.insertBefore(f,d)),void this.caret.before(d)}if(this.button.toggle({},"kbd","func","inline.format"),(o=n.anchorNode).nodeType===Node.TEXT_NODE&&(o=o.parentNode),"KBD"===o.nodeName){if(s=o.nextSibling,"ios"===e.platform()&&"safari"===e.browser())return void(s&&"BR"===s.nodeName&&o.parentNode.insertBefore(document.createTextNode("​"),s));for(;s;){if(s.nodeType!==Node.TEXT_NODE||s.textContent.length)return;s=s.nextSibling}s?s.textContent="​":o.parentNode.appendChild(document.createTextNode("​"))}}}}; })(this);

// plugins/WoltLabInsert.js
(function (window, undefined) { $.Redactor.prototype.WoltLabInsert=function(){"use strict";return{init:function(){function e(t){var o,r,i=t.querySelector("p > p");if(null!==i){for(r=(o=i.parentElement).parentElement;o.childNodes.length;)r.insertBefore(o.childNodes[0],o);o.remove(),e(t)}}var t,o=this.opts.woltlab.placeholderCallback,r=this.insert.html;this.insert.html=function(t,i){var n,s,c,a;o&&(o=o()),(n=window.getSelection()).rangeCount&&"IMG"===n.anchorNode.nodeName&&this.caret.after(n.anchorNode),this.placeholder.hide(),this.core.editor().focus(),this.detect.isFirefox()&&null===(n.anchorNode.nodeType===Node.TEXT_NODE?n.anchorNode.parentNode:n.anchorNode).closest(".redactor-layer")&&(this.selection.restore(),null===(n.anchorNode.nodeType===Node.TEXT_NODE?n.anchorNode.parentNode:n.anchorNode).closest(".redactor-layer")&&(this.WoltLabCaret.endOfEditor(),this.selection.save())),s=this.selection.block(),c=""===this.$editor[0].innerHTML.replace(/<\/?p>/g,"").replace(/<br>/g,"").replace(/\u200B/g,"").trim(),r.call(this,t,i),c&&(s=this.$editor[0].firstElementChild),s&&"P"===s.nodeName&&s.nextElementSibling&&(a=!1,(0===s.childElementCount&&""===s.textContent.replace(/\u200B/g,"").trim()||1===s.childElementCount&&"<br>"===s.innerHTML)&&(a=!0),a&&elRemove(s)),this.detect.isFirefox()&&(this.selection.save(),e(this.$editor[0]),this.selection.restore()),n.rangeCount&&"IMG"===n.anchorNode.nodeName&&this.caret.after(n.anchorNode)}.bind(this),t=this.insert.text,this.insert.text=function(e){o&&(o=o()),this.core.editor().focus(),this.selection.restore(),elClosest(window.getSelection().anchorNode,".redactor-layer")!==this.core.editor()[0]&&this.WoltLabCaret.endOfEditor(),t.call(this,e),this.selection.saveInstant()}.bind(this),this.insert.placeHtml=function(e){var t,o=!1;e.forEach((function(e){e instanceof Element&&e.classList.contains("woltlab-bbcode-marker")&&(o=!0)})),(t=document.createElement("span")).id="redactor-insert-marker",t=this.insert.node(t),$(t).before(e),o||(this.selection.restore(),this.caret.after(t)),$(t).remove()}.bind(this)}}}; })(this);

// plugins/WoltLabKeydown.js
(function (window, undefined) { $.Redactor.prototype.WoltLabKeydown=function(){"use strict";var e=!1,t=[];return{init:function(){var t,i,n,o,l,r,s=window.getSelection();require(["Environment"],(function(t){e="safari"===t.browser()})),t=this.keydown.init,this.keydown.init=function(e){var i,n,o,l,r,d,a,h,c,f,u,m,p,g,b,N,v,y;if(this.detect.isFirefox()&&s.isCollapsed&&e.which===this.keyCode.BACKSPACE&&((i=s.anchorNode).nodeType===Node.ELEMENT_NODE&&s.anchorOffset>0&&(i=i.childNodes[s.anchorOffset-1]),i.nodeType===Node.TEXT_NODE&&"​"===i.textContent)){for(n=[],o=i;o=o.previousSibling;){if(o.nodeType===Node.ELEMENT_NODE){"IMG"!==o.nodeName&&(n=[]);break}if(o.nodeType===Node.TEXT_NODE){if(""!==(l=o.textContent)&&"​"!==l){n=[];break}n.push(o)}}n.length&&n.forEach(elRemove)}if((e.originalEvent.which===this.keyCode.BACKSPACE||e.originalEvent.which===this.keyCode.DELETE)&&s.isCollapsed)if("P"===(r=this.selection.block()).nodeName){if(this.list.combineAfterAndBefore(r))return void e.originalEvent.preventDefault();if(this.utils.isEmpty(r.innerHTML)&&r.previousElementSibling!==r.nextElementSibling)return d=null,a=null,e.originalEvent.which===this.keyCode.BACKSPACE?null===r.previousElementSibling?a=r.nextElementSibling:d=r.previousElementSibling:null===r.nextElementSibling?d=r.previousElementSibling:a=r.nextElementSibling,elRemove(r),null===a?("OL"!==d.nodeName&&"UL"!==d.nodeName||(d=d.lastElementChild),this.caret.end(d)):("OL"!==a.nodeName&&"UL"!==a.nodeName||(a=a.firstElementChild),this.caret.start(a)),void e.originalEvent.preventDefault()}else{if(e.originalEvent.which===this.keyCode.DELETE&&-1!==["H1","H2","H3","H4","H5","H6"].indexOf(r.nodeName)&&this.utils.isEmpty(r.innerHTML))return(h=r.nextElementSibling)?h=r.nextElementSibling:((h=elCreate("p")).innerHTML=this.opts.invisibleSpace,r.parentNode.appendChild(h)),r.parentNode.removeChild(r),this.caret.start(h),void e.originalEvent.preventDefault();if(this.detect.isWebkit()&&"LI"===r.nodeName&&e.which===this.keyCode.DELETE&&(c=s.anchorNode).nodeType===Node.TEXT_NODE&&c.textContent.length===s.anchorOffset&&c.parentNode.lastChild===c&&(f=r.nextElementSibling)&&"LI"===f.nodeName){for(this.buffer.set(),this.selection.save();f.childNodes.length;)r.appendChild(f.childNodes[0]);return elRemove(f),this.selection.restore(),void e.preventDefault()}}if(u=null,e.which===this.keyCode.BACKSPACE&&this.detect.isFirefox()&&(m=this.selection.block())&&"P"===m.tagName&&this.utils.isStartOfElement(m)){if((p=m.previousElementSibling)&&("OL"===p.nodeName||"UL"===p.nodeName)){for(this.buffer.set(),this.selection.save(),g=p.lastElementChild;m.childNodes.length;)g.appendChild(m.childNodes[0]);return elRemove(m),this.selection.restore(),void e.preventDefault()}p&&"P"===p.nodeName&&null!==(u=p.lastElementChild)&&"BR"!==u.nodeName&&(u=null)}if(!1===t.call(this,e)||e.originalEvent.defaultPrevented)null!==u&&this.detect.isFirefox()&&1===(y=s.getRangeAt(0)).startOffset&&y.startContainer.firstElementChild===u&&elRemove(u);else if(!(39!==(e=e.originalEvent).which||e.ctrlKey||e.shiftKey||e.metaKey||e.altKey)){if(!s.isCollapsed)return;if((b=s.anchorNode).nodeType!==Node.TEXT_NODE||s.getRangeAt(0).startOffset!==b.textContent.length)return;if("KBD"!==(N=b.parentNode).nodeName)return;for(v=!0,i=N;i&&i!==this.core.editor()[0];){if(null!==i.nextSibling){for(;i.nextSibling&&i.nextSibling.nodeType===Node.TEXT_NODE&&0===i.nextSibling.textContent.length;)i.parentNode.removeChild(i.nextSibling);if(i.nextSibling&&"BR"!==i.nextSibling.nodeName||null!==i.nextSibling.nextSibling){v=!1;break}}i=i.parentNode}v&&N.parentNode.insertBefore(document.createTextNode("​"),N.nextSibling)}}.bind(this),-1!==(i=window.navigator.userAgent.toLowerCase()).indexOf("linux")&&-1!==i.indexOf("android")&&-1!==i.indexOf("chrome")&&(this.keydown.checkEvents=function(){this.core.addEvent(!1)}.bind(this)),this.core.editor().off("keydown.redactor"),this.core.editor().on("keydown.redactor",this.keydown.init.bind(this)),this.keydown.onArrowDown=function(){var e,t,i,n=this.WoltLabKeydown._getBlocks();for(i=0;i<n.length;i++)if(t=n[i]){if(!this.utils.isEndOfElement(t))continue;if(null!==(e=t.nextElementSibling)&&"P"===e.nodeName)break;return void this.keydown.insertAfterLastElement(t)}}.bind(this),this.keydown.onArrowUp=function(){var e,t,i,n,o=this.WoltLabKeydown._getBlocks();for(i=0;i<o.length;i++)if(t=o[i]){if(!this.utils.isStartOfElement())break;if(null!==(e=t.previousElementSibling)&&"P"!==e.nodeName){n=$(this.opts.emptyHtml)[0],t.parentNode.insertBefore(n,t),this.caret.end(n);break}return void this.keydown.insertBeforeFirstElement(t)}}.bind(this),n=function(t){var i,n,o,l,r,d=this.core.callback("enter",t);if(!1===d)return t.preventDefault(),!1;if(this.keydown.blockquote&&!0===this.keydown.exitFromBlockquote(t))return!1;if(this.keydown.pre)return this.keydown.insertNewLine(t);if(this.keydown.blockquote||this.keydown.figcaption)return this.keydown.insertBreakLine(t);if(this.keydown.figure)setTimeout($.proxy((function(){this.keydown.replaceToParagraph("FIGURE")}),this),1);else if(this.keydown.block)i=null,this.detect.isFirefox()&&"P"===this.keydown.block.nodeName&&s.isCollapsed&&null!==(n=elClosest(s.getRangeAt(0).startContainer,"a"))&&null===elBySel("br",n)&&(i=this.keydown.block),setTimeout($.proxy((function(){var e,t,n;this.keydown.replaceToParagraph("DIV"),null!==i&&null!==i.previousElementSibling&&(e=[],elBySelAll("a",i.previousElementSibling,(function(t){e.push(t)})),e.length&&(t=e[e.length-1],null!==(n=elBySel("br",t))&&elRemove(n)))}),this),1),"LI"===this.keydown.block.tagName&&(o=this.selection.current(),l=elClosest(o,"li"),this.utils.isRedactorParent(l)&&this.utils.isEmpty(l.innerHTML)&&null===l.nextElementSibling&&(l.innerHTML=e?"<br>":"",e&&((r=document.createRange()).selectNodeContents(l),r.collapse(!1),s.removeAllRanges(),s.addRange(r))));else if(!this.keydown.block)return this.keydown.insertParagraph(t);return this.detect.isFirefox()&&this.utils.isInline(this.keydown.parent)?(this.keydown.insertBreakLine(t),void setTimeout(function(){for(var e,t=this.selection.block(),i=this.selection.inline();i&&i!==t;){if("A"===i.nodeName&&(e=!1,0===i.childNodes.length?e=!0:""===i.textContent.replace(/\u200B/g,"").trim()&&(e=!0,elBySelAll("*",i,(function(t){"SPAN"!==t.nodeName&&(e=!1)}))),e)){for(;i.childNodes.length;)i.parentNode.insertBefore(i.childNodes[0],i);elRemove(i);break}i=i.parentNode}}.bind(this),1)):void 0}.bind(this),this.keydown.onEnter=function(e){var t,i=this.keydown.blockquote;return i&&(this.keydown.blockquote=!1),t=n.call(this,e),i&&(this.keydown.blockquote=i),t}.bind(this),this.keydown.replaceToParagraph=function(e){var t,i,n,o,l=this.selection.block(),r=l.innerHTML.replace(/<br\s?\/?>/gi,"");if(l.tagName===e&&this.utils.isEmpty(r)&&!$(l).hasClass("redactor-in"))return t=document.createElement("p"),$(l).replaceWith(t),(i=document.createRange()).setStart(t,0),n=document.createTextNode("​"),i.insertNode(n),i.setStartAfter(n),i.collapse(!0),(o=window.getSelection()).removeAllRanges(),o.addRange(i),!1;"P"===l.tagName&&$(l).removeAttr("style")}.bind(this),this.keydown.onShiftEnter=function(e){return this.buffer.set(),this.keydown.pre?this.keydown.insertNewLine(e):this.insert.raw("<br>​")}.bind(this),o=this.keydown.onTab,this.keydown.onTab=function(e,t){var i,n,l;if(!this.keydown.pre){if(0===(i=$(this.selection.current()).closest("ul, ol, td",this.core.editor()[0])).length)return!0;if("TD"===(i=i[0]).nodeName)return n=null,e.originalEvent.shiftKey?null===(n=i.previousElementSibling)&&null!==(n=i.parentNode.previousElementSibling)&&(n=n.lastElementChild):null===(n=i.nextElementSibling)&&(null===(n=i.parentNode.nextElementSibling)&&(this.table.addRowBelow(),n=i.parentNode.nextElementSibling),n=n.firstElementChild),null!==n&&(this.utils.isEmpty(n.innerHTML)?this.caret.end(n):((l=document.createRange()).selectNodeContents(n),s.removeAllRanges(),s.addRange(l))),e.originalEvent.preventDefault(),!1}return o.call(this,e,t)}.bind(this),l=this.keydown.formatEmpty,this.keydown.formatEmpty=function(e){var t,i,n,o=this.$editor[0];for(i=0,n=o.childElementCount;i<n;i++)if("P"!==(t=o.children[i]).nodeName&&this.utils.isBlockTag(t.nodeName))return;return l.call(this,e)}.bind(this),r=this.keydown.removeInvisibleSpace,this.keydown.removeInvisibleSpace=function(){this.keydown.current!==this.$editor[0]&&r.call(this)}.bind(this),require(["Core","Environment"],function(e,t){var i,n,o;"desktop"===t.platform()&&null!==(i=this.$editor[0].closest("form, .message, .jsOuterEditorContainer"))&&null!==(n=elBySel(".formSubmit",i))&&(o=elBySel('input[type="submit"], button[data-type="save"], button[accesskey="s"]',n))&&(o.removeAttribute("accesskey"),this.WoltLabEvent.register("keydown",function(t){if(83===t.event.which){var i=!1;window.navigator.platform.match(/^Mac/)?t.event.ctrlKey&&t.event.altKey&&(i=!0):t.event.altKey&&!t.event.ctrlKey&&(i=!0),i&&(t.cancel=!0,"function"==typeof o.click?o.click():e.triggerEvent(o,"click"))}}.bind(this)))}.bind(this)),this.WoltLabKeydown._handleBackspaceAndDelete()},register:function(e){-1===t.indexOf(e)&&t.push(e)},_getBlocks:function(){var e,i,n=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption];for(e=0,i=t.length;e<i;e++)n.push(this.utils.isTag(this.keydown.current,t[e]));return n},_handleBackspaceAndDelete:function(){var e=function(e){return null===elBySel("img",e)&&""===e.textContent.replace(/\u200B/g,"").trim()},t=function(t){var i,n,o,l,r,s,d,a,h,c,f=this.selection.block();if(f)if("TD"===f.nodeName)"​"===(n=f.innerHTML)?t.preventDefault():""===n&&(t.preventDefault(),f.innerHTML="​");else if(-1!==f.nodeName.indexOf("-")&&e(f))(i=f.parentNode).insertBefore(this.marker.get(),f.nextSibling),elRemove(f),this.selection.restore();else if((i=f&&"P"===f.nodeName?f.parentNode:null)&&-1!==i.nodeName.indexOf("-")&&(o=window.getSelection().getRangeAt(0),(l=document.createRange()).setStartBefore(f),l.setEnd(o.startContainer,o.startOffset),r=l.cloneContents(),(s=elCreate("div")).appendChild(r),e(s))){if(t.preventDefault(),a=null,d=f.previousElementSibling)a=e(d);else for(i=f;(i=i.parentNode)&&i!==this.$editor[0];)if(d=i.previousElementSibling){a=!1;break}if(a)elRemove(d);else if(null!==a){if(h=f.parentNode,"P"===d.nodeName){for(d.appendChild(this.marker.get());f.childNodes.length;){if("BR"===(c=f.childNodes[0]).nodeName){elRemove(c);break}d.appendChild(c)}0===f.childNodes.length&&elRemove(f),this.selection.restore()}else d.appendChild(f),f.insertBefore(this.marker.get(),f.firstChild),this.selection.restore();e(h)&&elRemove(h)}else null===a&&(i=f.parentNode,e(i)&&elRemove(i))}}.bind(this),i=function(t){var i,n,o,l,r,s,d,a,h,c=this.selection.block();if(-1!==c.nodeName.indexOf("-")&&e(c))(i=c.parentNode).insertBefore(this.marker.get(),c.nextSibling),elRemove(c),this.selection.restore();else if((i=c&&"P"===c.nodeName?c.parentNode:null)&&-1!==i.nodeName.indexOf("-")&&(n=window.getSelection().getRangeAt(0),(o=document.createRange()).setStart(n.startContainer,n.startOffset),o.setEndAfter(c),l=o.cloneContents(),(r=elCreate("div")).appendChild(l),e(r))){if(t.preventDefault(),d=null,s=c.nextElementSibling)d=e(s);else for(i=c;(i=i.parentNode)&&i!==this.$editor[0];)if(s=i.nextElementSibling){d=!1;break}if(d)elRemove(s);else if(null!==d){if(a=s.parentNode,"P"===s.nodeName){for(;s.childNodes.length;)c.appendChild(s.childNodes[0]);elRemove(s)}else{if(c.appendChild(this.marker.get()),i=c.parentNode,-1!==s.nodeName.indexOf("-")){if((h=s.firstElementChild)&&"P"===h.nodeName){for(;h.childNodes.length;)c.appendChild(h.childNodes[0]);s.removeChild(h),e(s)&&elRemove(s)}}else i.insertBefore(s,c.nextSibling);this.selection.restore()}e(a)&&elRemove(a)}else null===d&&(i=c.parentNode,e(i)&&elRemove(i))}}.bind(this),n=function(){return this.opts.blockTags.filter((function(e){return-1!==e.indexOf("-")})).join(",")}.bind(this),o=[],l=function(){elBySelAll(n(),this.core.editor()[0],(function(e){null!==e.parentNode&&-1!==o.indexOf(e)&&["nextElementSibling","previousElementSibling"].forEach((function(t){for(var i,n,l=e[t];null!==l&&l.nodeName===e.nodeName&&-1===o.indexOf(l);){if("previousElementSibling"===t)for(n=l.childNodes.length-1;n>=0;n--)e.insertBefore(l.childNodes[n],e.firstChild);else for(;l.childNodes.length>0;)e.appendChild(l.childNodes[0]);i=l[t],elRemove(l),l=i}}))}))}.bind(this),r=0,s=function(){var e=!1;elBySelAll(n(),this.core.editor()[0],(function(t){var i,n=elData(t,"firefox-duplication-bug");if(""!==n){if(null!==(i=o[parseInt(n,10)])&&null!==i.parentNode&&t!==i&&i.contains(t)){for(;t.childNodes.length;)t.parentNode.insertBefore(t.childNodes[0],t);return t.parentNode.removeChild(t),void(e=!0)}t.removeAttribute("data-firefox-duplication-bug")}})),e&&elBySelAll("h1,h2,h3,h4,h5,h6",this.core.editor()[0],(function(e){elBySelAll("p",e,(function(e){for(;e.childNodes.length;)e.parentNode.insertBefore(e.childNodes[0],e);e.parentNode.removeChild(e)}))})),r=0}.bind(this);this.keydown.onBackspaceAndDeleteAfter=function(e){var d,a;this.detect.isFirefox()&&(this.selection.isCollapsed()?e.which===this.keyCode.BACKSPACE?t(e):e.which===this.keyCode.DELETE&&i(e):e.which!==this.keyCode.BACKSPACE&&e.which!==this.keyCode.DELETE||elBySelAll(n(),this.core.editor()[0],(function(e){o.push(e),elData(e,"firefox-duplication-bug",r++)}))),d=!1,e.which===this.keyCode.BACKSPACE&&this.selection.isCollapsed()&&this.detect.isWebkit()&&!1!==(a=this.selection.block())&&"PRE"===a.nodeName&&(d=!0),setTimeout($.proxy((function(){var t,i,n,r;if(o.length>0&&(this.selection.save(),l(),s(),this.selection.restore(),o=[]),d&&(!1===(i=this.selection.block())||"PRE"!==i.nodeName)&&(t=this.selection.current()).nodeType===Node.TEXT_NODE&&t.nextSibling&&"SPAN"===t.nextSibling.nodeName&&-1!==(n=t.nextSibling).style.getPropertyValue("font-family").indexOf("monospace")&&"pre-wrap"===n.style.getPropertyValue("white-space")){for(;n.childNodes.length;)n.parentNode.insertBefore(n.childNodes[0],n);elRemove(n)}this.code.syncFire=!1,this.keydown.removeEmptyLists(),r="",0!==this.opts.keepStyleAttr.length&&(r=","+this.opts.keepStyleAttr.join(",")),this.core.editor().find("*[style]").not("span, img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]"+r).removeAttr("style"),this.keydown.formatEmpty(e),"KBD"===(t=this.selection.current()).nodeName&&0===t.innerHTML.length&&elRemove(t),this.code.syncFire=!0}),this),1)}.bind(this)}}}; })(this);

// plugins/WoltLabKeyup.js
(function (window, undefined) { $.Redactor.prototype.WoltLabKeyup=function(){"use strict";return{init:function(){this.WoltLabEvent.register("keyup",function(e){e.event.originalEvent.which===this.keyCode.ENTER&&this.WoltLabKeyup._keyupEnter()}.bind(this))},_keyupEnter:function(){var e,n,t,o,r,i=this.$editor[0],l=window.getSelection(),d=null;if(this.detect.isFirefox()&&((e=l.anchorNode).nodeType===Node.TEXT_NODE&&0===l.anchorOffset&&(d=e.parentNode).childNodes[0]===e&&(e=e.parentNode),"LI"===e.nodeName&&"LI"===(d=(n=e.parentNode).parentNode).nodeName&&null===n.previousSibling))return d.insertBefore(this.marker.get(),n),d.insertBefore(elCreate("br"),n),void this.selection.restore();for(null!==(t=elClosest(l.anchorNode,"li"))&&i.contains(t)&&(null===(o=t.previousElementSibling)||"OL"!==o.nodeName&&"UL"!==o.nodeName||o.previousElementSibling.appendChild(o)),r=l.anchorNode;r.parentNode;){if(r.parentNode===i){d=r;break}r=r.parentNode}null!==d&&"P"===d.nodeName&&(this.WoltLabKeyup._rebuildEmptyParagraph(d,!1),null!==(d=d.previousElementSibling)&&"P"===d.nodeName&&this.WoltLabKeyup._rebuildEmptyParagraph(d,!0))},_rebuildEmptyParagraph:function(e,n){var t,o;if(!(e.textContent.replace(/\u200B/g,"").trim().length>0)){for(t=e;t.nodeType===Node.ELEMENT_NODE&&0!==t.childNodes.length;){if(t.children.length>1)return;t=1===t.children.length?t.children[0]:t.childNodes[0]}t.nodeType===Node.TEXT_NODE&&(o=elCreate("br"),t.parentNode.appendChild(o),n&&elRemove(t))}}}}; })(this);

// plugins/WoltLabLine.js
(function (window, undefined) { $.Redactor.prototype.WoltLabLine=function(){"use strict";return{init:function(){this.line.removeOnBackspace=function(){var t,i;this.utils.isCollapsed()&&0!==(t=$(this.selection.block())).length&&this.utils.isStartOfElement(t)&&(i=t.prev()).length&&"HR"===i[0].tagName&&(e.preventDefault(),i.remove())}.bind(this)}}}; })(this);

// plugins/WoltLabLink.js
(function (window, undefined) { $.Redactor.prototype.WoltLabLink=function(){"use strict";var i=null;return{init:function(){this.link.isUrl=function(i){var t="((xn--)?[\\W\\w\\D\\d]+(-(?!-[\\W\\w\\D\\d])+)*\\.)+[\\W\\w]{2,}",e=new RegExp("^(http|ftp|https|steam|ts3server)://"+t,"i"),s=new RegExp("^"+t,"i"),r=new RegExp(".(html|php)$","i"),l=new RegExp("^/","i"),n=new RegExp("^tel:(.*?)","i");return-1===i.search(e)&&-1!==i.search(s)&&-1===i.search(r)&&"/"!==i.substring(0,1)&&(i="http://"+i),(-1!==i.search(e)||-1!==i.search(r)||-1!==i.search(l)||-1!==i.search(n))&&i}.bind(this),this.link.show=this.WoltLabLink.show.bind(this),this.link.parse=function(i){if(this.link.isMailto(i.url))i.url="mailto:"+i.url.replace("mailto:","");else if(0!==i.url.search("#")&&this.opts.linkValidation){var t=this.link.isUrl(i.url);!1===t&&(t="http://"+i.url),i.url=t}return!this.link.isEmpty(i)&&!1!==i.url&&i}.bind(this),require(["WoltLabSuite/Core/Ui/Redactor/Link"],(function(t){i=t}))},show:function(t,e){var s,r,l;void 0!==t&&t.preventDefault&&t.preventDefault(),s=this.selection.is(),this.selection.save(),this.observe.closeAllTooltip(),r=e,s&&this.selection.restore(),l=this.link.buildLinkFromElement(r),s&&this.selection.save(),i.showDialog({insert:!1===r,submitCallback:function(){var i=this.link.buildLinkFromModal();return!1!==i&&(this.selection.restore(),this.link.insert(i,!0),!0)}.bind(this)}),l.url=this.link.removeSelfHostFromUrl(l.url),this.link.setModalValues(l),this.detect.isDesktop()&&$("#redactor-link-url").focus()}}}; })(this);

// plugins/WoltLabList.js
(function (window, undefined) { $.Redactor.prototype.WoltLabList=function(){"use strict";return{parentsQualifiedForLists:["woltlab-quote","woltlab-spoiler"],init:function(){this.list.combineAfterAndBefore=function(t){var e,i,s,n=$(t).prev(),o=$(t).next(),l=t&&"P"===t.tagName&&("<br>"===t.innerHTML||""===t.innerHTML),r=1===n.closest("ol, ul",this.core.editor()[0]).length&&1===o.closest("ol, ul",this.core.editor()[0]).length,a=!1;return r&&!l&&0===t.textContent.replace(/\u200b/g,"").trim().length&&(e=["A","B","BR","EM","I","STRONG","U"],i=!0,elBySelAll("*",t,(function(t){-1===e.indexOf(t.nodeName)&&("SPAN"===t.nodeName&&""===t.className.trim()||(i=!1))})),i&&(a=!0,l=!0)),!(!l||!r)&&("LI"===t.nodeName&&a?(n.append(this.marker.get()),elRemove(t),this.selection.restore(),!0):(n.children("li").last().append(this.marker.get()),n.append(o.contents()),"OL"!==(s=t.nextElementSibling).nodeName&&"UL"!==s.nodeName||0!==s.childElementCount||elRemove(s),a&&elRemove(t),this.selection.restore(),!0))}.bind(this),this.list.toggle=function(t){var e,i,s;if(!this.utils.inBlocks(["table","td","th","tr"]))return t=(t="unorderedlist"===(t="orderedlist"===t?"ol":t)?"ul":t).toLowerCase(),this.buffer.set(),this.selection.save(),e=this.list._getBlocks(),i=this.selection.block(),s=$(i).parent().closest("ol, ul",this.core.editor()[0]),0===e.length&&0!==s.length&&(e=[s.get(0)]),e=this.list._isUnformat(t,e)?this.list._unformat(t,e):this.list._format(t,e),this.selection.restore(),e}.bind(this),this.list._getBlocks=function(){return this.selection.blocks().filter(function(t){var e=t.parentNode;return!!e.classList.contains("redactor-in")||-1!==this.WoltLabList.parentsQualifiedForLists.indexOf(e.nodeName.toLowerCase())}.bind(this))}.bind(this)}}}; })(this);

// plugins/WoltLabMedia.js
(function (window, undefined) { $.Redactor.prototype.WoltLabMedia=function(){"use strict";return{init:function(){var t,e=this.button.add("woltlabMedia","");$(e).addClass("jsMediaEditorButton"),t=WCF.System.Event.addListener("com.woltlab.wcf.redactor2","metacode_wsm_"+this.$element[0].id,function(t){var e,a,i;1!==t.attributes.length&&(e="",3===t.attributes.length&&("left"===t.attributes[2]?e=" messageFloatObjectLeft":"right"===t.attributes[2]&&(e=" messageFloatObjectRight")),(a=elCreate("img")).className="woltlabSuiteMedia"+e,a.src=this.opts.woltlab.mediaUrl.replace(/&amp;/,"&").replace("-123456789",t.attributes[0]).replace("thumbnail=void",(function(){return t.attributes[1]?"thumbnail="+t.attributes[1]:""})),elData(a,"media-id",t.attributes[0]),elData(a,"media-size",t.attributes[1]),(i=t.metacode).parentNode.insertBefore(a,i),elRemove(i),t.cancel=!0)}.bind(this)),WCF.System.Event.addListener("com.woltlab.wcf.redactor2","destroy_"+this.$element[0].id,function(){WCF.System.Event.removeListener("com.woltlab.wcf.redactor2","metacode_wsm_"+this.$element[0].id,t)}.bind(this)),require(["WoltLabSuite/Core/Media/Manager/Editor"],function(t){new t({editor:this})}.bind(this))}}}; })(this);

// plugins/WoltLabMention.js
(function (window, undefined) { $.Redactor.prototype.WoltLabMention=function(){"use strict";return{init:function(){require(["WoltLabSuite/Core/Ui/Redactor/Mention"],function(t){new t(this)}.bind(this))}}}; })(this);

// plugins/WoltLabModal.js
(function (window, undefined) { $.Redactor.prototype.WoltLabModal=function(){"use strict";var t=null,i="",e=null,o={close:function(){this.selection.restore(),e.getDialog("redactorOverlay-"+this.uuid)&&e.close("redactorOverlay-"+this.uuid)},load:function(e,o){t.innerHTML=this.modal.getTemplate(e),i=o},setTitle:function(t){e.setTitle(this,t)},show:function(){this.selection.save(),e.open(this),e.setTitle(this,i)}};return{init:function(){(t=elCreate("div")).className="redactorModalWrapper",t.id="redactorOverlay-"+this.uuid,elHide(t),document.body.appendChild(t),this.$modalBody=$(t),require(["Ui/Dialog"],function(t){for(var i in e=t,o)o.hasOwnProperty(i)&&(this.modal[i]=o[i].bind(this))}.bind(this)),this._dialogSetup=function(){return{id:"redactorOverlay-"+this.uuid,options:{onClose:function(t){var i=e.getDialog(t);elBySelAll("[id]",i.content,(function(t){t.removeAttribute("id")}))}}}}},rebuild:function(){e&&e.rebuild("redactorOverlay-"+this.uuid)}}}; })(this);

// plugins/WoltLabObserve.js
(function (window, undefined) { $.Redactor.prototype.WoltLabObserve=function(){"use strict";return{init:function(){var t=elByClass("re-button",this.button.toolbar()[0]);this.button.setInactiveAll=function(e){var s,o,i;for(o=0,i=t.length;o<i;o++)(s=t[o]).classList.contains("re-"+e)||(s.classList.remove("redactor-act"),"html"!==s.rel&&elAttr(s,"tabindex",-1),elAttr(s,"aria-pressed",!1))}.bind(this),this.observe.buttons=function(t,e){var s,o,i,n,r,l=this.selection.current();if(!1!==t?this.button.setInactiveAll():this.button.setInactiveAll(e),!1!==t||"html"===e){if(this.utils.isRedactorParent(l)&&(s=this.WoltLabSource.isActive(),this.utils.isCurrentOrParentHeader()||this.utils.isCurrentOrParent(["table","pre","blockquote","li"])?this.button.disable("horizontalrule"):s||this.button.enable("horizontalrule"),this.utils.isCurrentOrParent(["table","li"])?(this.button.disable("code"),this.button.disable("spoiler"),this.button.disable("woltlabHtml"),this.button.disable("woltlabQuote")):s||(this.button.enable("code"),this.button.enable("spoiler"),this.button.enable("woltlabHtml"),this.button.enable("woltlabQuote")),s&&this.button.setActive("html"),this.core.box()[0].classList.contains("redactorBoxFullscreen")&&this.button.setActive("woltlabFullscreen"),o=this.$editor[0],l.nodeType!==Node.ELEMENT_NODE&&(l=l.parentNode),l.closest(".redactor-layer")===o))for(r=[];l!==o;)n=l.nodeName.toLowerCase(),-1===r.indexOf(n)&&(i=n,"pre"===n&&l.classList.contains("woltlabHtml")&&(i="woltlab-html"),this.opts.activeButtonsStates.hasOwnProperty(i)&&this.button.setActive(this.opts.activeButtonsStates[i]),"pre"!==n&&r.push(n)),l=l.parentNode}else-1!==$.inArray(e,this.opts.activeButtons)&&this.button.toggleActive(e)}.bind(this),this.observe.dropdowns=function(){var t,e,s,o,i,n,r,l,a,b,h,u,c,d=this.selection.current();if(d&&d.nodeType!==Node.ELEMENT_NODE&&(d=d.parentNode),t=this.$editor[0],o=[],e=d&&d.closest(".redactor-layer")===t)for(;d!==t;)s=d.nodeName.toLowerCase(),-1===o.indexOf(s)&&o.push(s),d=d.parentNode;for(i=null,r=0,l=this.opts.observe.dropdowns.length;r<l;r++)b=(a=(n=this.opts.observe.dropdowns[r]).observe).element,h=n.item,u=!!a.in&&a.in,c=!!a.out&&a.out,"a"===b&&null===i&&(i=$("<div />").html(this.selection.html()).find("a").length),-1!==o.indexOf(b)&&e||"a"===b&&0!==i?this.observe.setDropdownProperties(h,u,c):this.observe.setDropdownProperties(h,c,u)}.bind(this)}}}; })(this);

// plugins/WoltLabPage.js
(function (window, undefined) { $.Redactor.prototype.WoltLabPage=function(){"use strict";return{init:function(){var t=this.button.add("woltlabPage","");require(["WoltLabSuite/Core/Ui/Redactor/Page"],function(e){new e(this,t[0])}.bind(this))}}}; })(this);

// plugins/WoltLabPaste.js
(function (window, undefined) { $.Redactor.prototype.WoltLabPaste=function(){"use strict";var t=null;return{init:function(){var e,i,n,r,s=null,l=!1,a=document.documentMode&&"object"==typeof window.clipboardData,o=null,d=null,h=function(t){var e,i,n,r;this.rtePaste=!0,(e=!("pre"!==this.opts.type&&!this.utils.isCurrentOrParent("pre")))&&t.preventDefault(),this.utils.saveScroll(),this.selection.save(),this.paste.createPasteBox(e),i=this.paste.getPasteBoxCode(e),this.buffer.set(),this.selection.restore(),this.utils.restoreScroll(),n=this.clean.getCurrentType(i),i=this.clean.onPaste(i,n),i=void 0===(r=this.core.callback("paste",i))?i:r,this.paste.insert(i,n),this.rtePaste=!1,e&&this.clean.cleanPre()}.bind(this),c=this.paste.init;this.paste.init=function(e){var i,n,r,p,f,u;d=o=null,i="pre"===this.opts.type||this.utils.isCurrentOrParent("pre"),l=!i&&this.utils.isCurrentOrParent("kbd"),i||l?(s=a?window.clipboardData.getData("Text"):e.originalEvent.clipboardData.getData("text/plain"),n=this.clean.encodeEntities,this.clean.encodeEntities=function(t){return this.clean.encodeEntities=n,WCF.String.escapeHTML(t)}.bind(this)):a||(p=!1,-1!==(r=e.originalEvent.clipboardData.types).indexOf("text/html")&&((o=e.originalEvent.clipboardData.getData("text/html")).trim().match(/^<html[^>]*>[\s\S]*?<body[^>]*>([\s\S]+)<\/body>[\s\S]*?<\/html>$/)&&(o=RegExp.$1.replace(/^\s*(?:<!--StartFragment-->)(.+)(?:<!--EndFragment-->)?\s*$/,"$1")),p=0!==o.trim().length),p||-1===r.indexOf("text/plain")||(f=WCF.String.escapeHTML(e.originalEvent.clipboardData.getData("text/plain")),d="",1===(u=f.split("\n")).length?d=f:u.forEach((function(t){""===(t=t.trim())&&(t="<br>"),d+="<p>"+t+"</p>"})))),null===d&&null===o||e.preventDefault(),"android"===t.platform()&&"chrome"===t.browser()?h(e):c.call(this,e)}.bind(this),require(["Environment"],function(e){if("ios"===(t=e).platform()){var i=this.paste.appendPasteBox;this.paste.appendPasteBox=function(){this.$pasteBox.css({fontSize:"16px",height:"1px",left:"1px",overflow:"hidden",position:"absolute",top:~~(window.innerHeight/4)+window.pageYOffset+"px",width:"1px"}),i.call(this)}.bind(this)}}.bind(this)),e=this.paste.createPasteBox,this.paste.createPasteBox=function(t){null===o&&null===d&&e.call(this,t)}.bind(this),i=this.paste.getPasteBoxCode,this.paste.getPasteBoxCode=function(t){if(null!==o||null!==d)return this.tmpScrollTop=void 0,o||d;var e=i.call(this,t);return l?s:!t||e&&!a?e:s}.bind(this),this.core.editor().off("paste.redactor").on("paste.redactor",this.paste.init.bind(this)),this.paste.detectClipboardUpload=function(t){var e,i,n,r,s,l,o,d,h,c;if(t=t.originalEvent||t,e=null,a){if(!window.clipboardData.files.length)return!1;e=window.clipboardData.files.item(0)}else{if(this.detect.isFirefox())return!1;if(n=(i=t.clipboardData).types,Array.isArray(n)&&-1!==n.indexOf("public.tiff")){if(0===i.files.length)return;if(1!==i.files.length)return t.preventDefault(),!1;h=!0,null!==(e=i.files[0])&&t.preventDefault()}if(null===e){if(!i.items||!i.items.length)return;if(this.detect.isWebkit()){for(s=!1,l=!1,o=0,d=i.items.length;o<d;o++)"string"===(r=i.items[o]).kind&&"text/html"===r.type?l=!0:"file"===r.kind&&(s=!0);if(s&&l)return!1}if(h=!1,null===(e=i.items[0].getAsFile())){if(this.detect.isWebkit()&&i.items.length>1&&(h=!0,null!==(e=i.items[1].getAsFile())&&t.preventDefault()),null===e)return!1}else this.detect.isWebkit()&&1===i.items.length&&t.preventDefault()}}return(c=new FileReader).readAsDataURL(e),c.onload=this.paste.insertFromClipboard.bind(this),!1===h}.bind(this),this.paste.insertFromClipboard=function(t){window.FormData&&(this.buffer.set(),WCF.System.Event.fireEvent("com.woltlab.wcf.redactor2","pasteFromClipboard_"+this.$element[0].id,{blob:this.utils.dataURItoBlob(t.target.result)}),this.rtePaste=!1)}.bind(this),n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r=this.paste.insert,this.paste.insert=function(t,e){var i,s,o,d,h,c,p,f,u,b,m,g,v,A,x;if(l&&(e.pre=!0),this.utils.isCurrentOrParent("kbd")){for(r.call(this,t,e),(i=this.selection.current()).nodeType===Node.TEXT_NODE&&(i=i.parentNode),s=i.closest("kbd"),o=elByTag("p",s);o.length;)o[0].outerHTML=o[0].innerHTML;if((d=s.innerHTML.split(/<br\s*\/?>/)).length>1){for(h=this.selection.block(),c=1,p=d.length;c<p;c++)(f=elCreate(h.nodeName)).innerHTML="<kbd>"+d[c]+(c===p-1?this.marker.html():"")+"</kbd>",h.parentNode.insertBefore(f,h.nextSibling),h=f;s.innerHTML=d[0],this.selection.restore()}}else{if(e.pre)return r.call(this,t,e);if((u=elCreate("div")).innerHTML=t,1===u.childElementCount&&"A"===u.children[0].nodeName&&(b=u.children[0],u.firstChild===b&&u.lastChild===b&&b.href===b.textContent)){for(;b.childNodes.length;)u.insertBefore(b.childNodes[0],b);u.removeChild(b)}for(m=[],e.pre||e.text||elBySelAll("img",u,function(t){var e,i=t.src;0!==i.indexOf("data:image")&&0!==i.indexOf("blob:")||i===n||(t.src=n,e=WCF.getUUID(),elData(t,"uuid",e),m.push({src:i,uuid:e}),elHide(t))}.bind(this)),elBySelAll("pre",u,(function(t){elBySelAll("br",t,(function(t){var e=t.parentNode;e.insertBefore(document.createTextNode("\n"),t),e.removeChild(t)}))})),r.call(this,u.innerHTML,e),(g=window.getSelection()).rangeCount&&"A"===g.anchorNode.nodeName&&g.anchorOffset===g.anchorNode.childNodes.length&&this.caret.after(g.anchorNode),m.length&&window.setTimeout(function(){var t,e,i,n;for(i=0,n=m.length;i<n;i++)t=m[i],(e=elBySel('img[data-uuid="'+t.uuid+'"]',this.$editor[0]))&&(a?e.parentNode.removeChild(e):0===t.src.indexOf("blob:")?window.fetch(t.src).then((function(t){return t.blob()})).then(function(t){WCF.System.Event.fireEvent("com.woltlab.wcf.redactor2","pasteFromClipboard_"+this.$element[0].id,{blob:t,replace:e})}.bind(this)):WCF.System.Event.fireEvent("com.woltlab.wcf.redactor2","pasteFromClipboard_"+this.$element[0].id,{blob:this.utils.dataURItoBlob(t.src),replace:e}))}.bind(this),50),A=[],c=0,p=(x=this.core.editor()[0]).childNodes.length;c<p;c++)(v=x.childNodes[c]).nodeType===Node.TEXT_NODE&&"​"===v.textContent&&A.push(v);A.forEach(elRemove),this.WoltLabClean.removeRedundantStyles(),this.rtePaste=!1}}.bind(this),this.paste.clipboardUpload=function(){}}}}; })(this);

// plugins/WoltLabQuote.js
(function (window, undefined) { $.Redactor.prototype.WoltLabQuote=function(){"use strict";return{init:function(){var t=this.button.add("woltlabQuote","");this.WoltLabBlock.register("woltlab-quote",!0),this.opts.replaceTags.blockquote="woltlab-quote",this.opts.activeButtonsStates["woltlab-quote"]="woltlabQuote",require(["WoltLabSuite/Core/Ui/Redactor/Quote"],function(o){new o(this,t)}.bind(this))}}}; })(this);

// plugins/WoltLabReply.js
(function (window, undefined) { $.Redactor.prototype.WoltLabReply=function(){"use strict";var t=null,e=null,s=null;return{init:function(){var i=this.$editor[0].closest(".messageContent"),l=elById("messageQuickReply");i&&i.classList.contains("messageQuickReplyContent")&&l&&l.classList.contains("messageQuickReplyCollapsed")&&(t=this.WoltLabReply._click.bind(this),e=i,s=l,WCF.System.Event.addListener("com.woltlab.wcf.redactor2","showEditor",this.WoltLabReply.showEditor.bind(this)),e.addEventListener("click",t))},showEditor:function(){s?s.classList.contains("messageQuickReplyCollapsed")&&(s.classList.remove("messageQuickReplyCollapsed"),e.removeEventListener("click",t),this.WoltLabCaret.endOfEditor()):this.WoltLabCaret.endOfEditor()},_click:function(t){t.preventDefault(),WCF.System.Event.fireEvent("com.woltlab.wcf.redactor2","showEditor")}}}; })(this);

// plugins/WoltLabSize.js
(function (window, undefined) { $.Redactor.prototype.WoltLabSize=function(){"use strict";return{init:function(){var e,t,i,o,s,r=[8,10,12,14,18,24,36],n=this.WoltLabSize.setSize.bind(this),a={};for(t=0,i=r.length;t<i;t++)a["size_"+(e=r[t])]={title:e,func:n};a.removeSize={title:this.lang.get("remove-size"),func:this.WoltLabSize.removeSize.bind(this)},o=this.button.add("woltlabSize",""),this.button.addDropdown(o,a),(s=o.data("dropdown")).find("a").each((function(e,t){t.className.match(/redactor-dropdown-size_(\d{1,2})/)&&(t.style.setProperty("font-size",RegExp.$1+"pt",""),t.parentNode.classList.add("woltlab-size-selection"))})),$('<li class="dropdownDivider"></li>').insertBefore(s.children("li").last())},setSize:function(e){this.selection.save(),require(["WoltLabSuite/Core/Ui/Redactor/Format"],function(t){this.buffer.set(),t.format(this.$editor[0],"font-size",e.replace(/^size_/,"")+"pt"),this.buffer.set()}.bind(this)),this.selection.restore()},removeSize:function(){this.selection.save(),require(["WoltLabSuite/Core/Ui/Redactor/Format"],function(e){this.buffer.set(),e.removeFormat(this.$editor[0],"font-size"),this.buffer.set()}.bind(this)),this.selection.restore()}}}; })(this);

// plugins/WoltLabSmiley.js
(function (window, undefined) { $.Redactor.prototype.WoltLabSmiley=function(){"use strict";var e=0;return{init:function(){require(["EventHandler"],function(e){e.add("com.woltlab.wcf.redactor2","insertSmiley_"+this.$element[0].id,this.WoltLabSmiley._insert.bind(this))}.bind(this))},_insert:function(t){var i,o,n,r,d,c;this.WoltLabSource.isActive()||(this.buffer.set(),i="wscSmiley_"+this.uuid+"_"+e++,(o=t.img.cloneNode()).id=i,this.insert.html(o.outerHTML),(o=elById(i)).removeAttribute("id"),(n=o.nextSibling)&&n.nodeType===Node.TEXT_NODE&&"​"===n.textContent&&n.remove(),o.parentNode.insertBefore(document.createTextNode(" "),o),r=document.createTextNode(" "),o.parentNode.insertBefore(r,o.nextSibling),o.outerHTML=o.outerHTML,d=window.getSelection(),(c=document.createRange()).selectNode(r),c.collapse(!1),d.removeAllRanges(),d.addRange(c),this.WoltLabCaret.forceSelectionSave())}}}; })(this);

// plugins/WoltLabSource.js
(function (window, undefined) { $.Redactor.prototype.WoltLabSource=function(){"use strict";return{init:function(){var e,t,r,i,n,o=this.$element[0].id,l=function(e){elBySelAll("woltlab-quote",e,(function(e){var t;2===e.childElementCount&&"P"===e.children[0].nodeName&&"P"===e.children[1].nodeName&&""===(t=e.children[0]).innerHTML.trim()&&"<br>"===e.children[1].innerHTML.trim()&&e.removeChild(t)}))},a=function(e){elBySelAll("pre, woltlab-quote, woltlab-spoiler",e,(function(e){e.removeAttribute("data-title")})),WCF.System.Event.fireEvent("com.woltlab.wcf.redactor2","source_stripIntermediateCode_"+o,{div:e})},s=this.source.hide;this.source.hide=function(){var e=$("<div />").html(this.source.$textarea.val());!function(e){elBySelAll(".icon, .fa",e,(function(e){var t=e.className.split(" ");t=t.filter((function(e){return"fa"!==e&&"icon"!==e&&!e.match(/^icon\d{2}$/)&&!e.match(/^fa-[a-z\-]+$/)})),e.className=t.join(" "),""===e.className.trim()&&""===e.innerHTML&&elRemove(e)}))}(e[0]),this.source.$textarea.val(e[0].innerHTML),s.call(this),setTimeout(function(){this.focus.end(),l(this.core.editor()[0])}.bind(this),100),this.placeholder.enable()}.bind(this),e=this.source.$textarea[0],this.$element[0].parentNode.insertBefore(e,this.$element[0]),t=this.source.show,this.source.show=function(){var r,i=this.$editor[0].offsetHeight,n=this.code.get();t.call(this),this.source.$textarea.val(n.replace(/&nbsp;/g," ")),e.style.setProperty("height",Math.ceil(i)+"px",""),e.style.setProperty("display","block",""),(r=elCreate("div")).innerHTML=e.value,l(r),a(r),e.value=this.WoltLabSource.format(r.innerHTML),e.selectionStart=e.selectionEnd=e.value.length}.bind(this),WCF.System.Event.addListener("com.woltlab.wcf.redactor2","validate_"+o,function(e){this.WoltLabSource.isActive()&&(e.api.throwError(this.$element[0],WCF.Language.get("wcf.editor.source.error.active")),e.valid=!1)}.bind(this)),r=this.core.box()[0],(i=r.closest("form"))&&(n=r.closest("dl"),i.addEventListener("submit",function(e){var t,o="";this.WoltLabSource.isActive()&&(e.preventDefault(),o=WCF.Language.get("wcf.editor.source.error.active"),(t=i.querySelector(".formSubmit input[type=submit]"))&&(t.disabled=!1),require(["WoltLabSuite/Core/Ui/TabMenu"],(function(e){e._selectErroneousTabs()}))),elInnerError(r,o),o?n.classList.add("formError"):n.classList.remove("formError")}.bind(this)))},isActive:function(){return"none"===this.$editor[0].style.getPropertyValue("display")},format:function(e){var t,r,i,n,o,l,a,s,c,u,h,d,f=["ul","ol","li","table","tbody","thead","tr","td","th"];for(this.block.tags.forEach((function(e){f.push(e)})),f=f.join("|").toLowerCase(),t=["p","li","td","th"],r="[^'\">]*(?:(?:\"[^\"]*\"|'[^']*')[^'\">]*)*",i=[],n=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp("<pre"+r+">[\\s\\S]*?</pre>","g"),(function(e){return i.push(e),"@@@WCF_PRE_BACKUP_"+(i.length-1)+"@@@"}))).replace(new RegExp("\\s*</("+f+")>\\s*","g"),(function(e,r){return(-1===t.indexOf(r)?"\n":"")+"</"+r+">"}))).replace(new RegExp("\\s*<("+f+")("+r+")>\\s*","g"),(function(e,r,i){return"\n<"+r+i+">"+(-1===t.indexOf(r)?"\n":"")}))).replace(new RegExp("(<(?:"+f+")(?:"+r+")>\n)\n+(?=<(?:"+f+")(?:"+r+")>)","g"),"$1")).replace(/<woltlab-quote([^>]*)>\n\t*\n(\t*)<p/,"<woltlab-quote$1>\n$2<p")).replace(new RegExp("<(ol|ul)("+r+")>\\s*","g"),"<$1$2>\n")).replace(/(<\/[ou]l>)<\/li>/g,"$1\n</li>")).split(/\n/),o=0,c=new RegExp("^<("+f+")"),u=new RegExp("^</("+f+")>$"),h=!1,l=0,a=n.length;l<a;l++){if(h=!1,(s=n[l]).match(c)?-1===t.indexOf(RegExp.$1)&&(h=!0):s.match(u)&&-1===t.indexOf(RegExp.$1)&&o--,o>0){for(d=o,n[l]="";d--;)n[l]+="\t";n[l]+=s}h&&o++}for(e=n.join("\n"),l=0,a=i.length;l<a;l++)e=e.replace("@@@WCF_PRE_BACKUP_"+l+"@@@",i[l]);return(e=e.replace(/\r?\n<\/pre>/g,"</pre>")).trim()}}}; })(this);

// plugins/WoltLabSpoiler.js
(function (window, undefined) { $.Redactor.prototype.WoltLabSpoiler=function(){"use strict";return{init:function(){this.WoltLabBlock.register("woltlab-spoiler",!0),this.opts.activeButtonsStates["woltlab-spoiler"]="woltlabSpoiler",require(["WoltLabSuite/Core/Ui/Redactor/Spoiler"],function(t){new t(this)}.bind(this))}}}; })(this);

// plugins/WoltLabTable.js
(function (window, undefined) { $.Redactor.prototype.WoltLabTable=function(){"use strict";var e=null;return{init:function(){var t;this.WoltLabEvent.register("insertedTable",function(){window.setTimeout(function(){var e,t,i,o,s,l,n=this.selection.block()||this.selection.current();if(n===this.$editor[0]&&(e=window.getSelection()).isCollapsed&&e.anchorNode===this.$editor[0]&&e.anchorOffset>0&&(n=e.anchorNode.childNodes[e.anchorOffset-1]),"TBODY"===n.nodeName&&(n=n.parentNode),"TABLE"===n.nodeName){for(i=[],o=0,s=n.childNodes.length;o<s;o++)(t=n.childNodes[o]).nodeType===Node.TEXT_NODE&&t.textContent.length>0&&i.push(t);i.forEach(elRemove),(l=elBySel("td",n))&&this.caret.end(l)}}.bind(this),10)}.bind(this)),(t=this.button.get("table").data("dropdown").find(".redactor-dropdown-insert_table")).off("mousedown"),t[0].addEventListener("mousedown",this.WoltLabTable._promptTableSize.bind(this)),require(["WoltLabSuite/Core/Ui/Redactor/Table"],(function(t){e=t}))},_promptTableSize:function(t){t.preventDefault(),this.table.getTable()||(this.selection.save(),e.showDialog({submitCallback:function(){this.WoltLabTable._insertTable(~~elById("redactor-table-rows").value,~~elById("redactor-table-cols").value)}.bind(this)}))},_insertTable:function(e,t){var i,o,s,l;for(this.placeholder.hide(),o="<tr>",i=0;i<t;i++)o+="<td>"+this.opts.invisibleSpace+"</td>";for(o+="</tr>",s="<table>",i=0;i<e;i++)s+=0===i?o.replace(new RegExp("^(<tr><td>"+this.opts.invisibleSpace+")"),"$1"+this.marker.html()):o;s+="</table>",this.selection.restore(),this.buffer.set(),l=this.selection.current(),0!==$(l).closest("li",this.core.editor()[0]).length?$(l).closest("ul, ol").first().after(s):this.insert.html(s),this.selection.restore(),this.core.callback("insertedTable",void 0)}}}; })(this);

// plugins/WoltLabUtils.js
(function (window, undefined) { $.Redactor.prototype.WoltLabUtils=function(){"use strict";return{init:function(){var t=this.utils.replaceToTag;this.utils.replaceToTag=function(i,r){return"figure"===r?i:t.call(this,i,r)}.bind(this)}}}; })(this);

// plugins/alignment.js
(function (window, undefined) { jQuery.Redactor.prototype.alignment=function(){return{langs:{en:{align:"Align","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify"}},init:function(){var t,e=this,i={};i.left={title:e.lang.get("align-left"),func:e.alignment.setLeft},i.center={title:e.lang.get("align-center"),func:e.alignment.setCenter},i.right={title:e.lang.get("align-right"),func:e.alignment.setRight},i.justify={title:e.lang.get("align-justify"),func:e.alignment.setJustify},t=this.button.add("alignment",this.lang.get("align")),this.button.setIcon(t,'<i class="re-icon-alignment"></i>'),this.button.addDropdown(t,i)},removeAlign:function(){this.block.removeClass("text-center"),this.block.removeClass("text-right"),this.block.removeClass("text-justify")},setLeft:function(){this.buffer.set(),this.alignment.removeAlign()},setCenter:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-center"),this.core.editor().focus()},setRight:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-right"),this.core.editor().focus()},setJustify:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-justify"),this.core.editor().focus()}}}; })(this);

// plugins/source.js
(function (window, undefined) { !function(e){e.Redactor.prototype.source=function(){return{init:function(){var t,o=this.button.addFirst("html","HTML");this.button.addCallback(o,this.source.toggle),t={width:"100%",margin:"0",background:"#111","box-sizing":"border-box",color:"rgba(255, 255, 255, .8)","font-size":"14px",outline:"none",padding:"16px","line-height":"22px","font-family":'Menlo, Monaco, Consolas, "Courier New", monospace'},this.source.$textarea=e("<textarea />"),this.source.$textarea.css(t).hide(),"textarea"===this.opts.type?this.core.box().append(this.source.$textarea):this.core.box().after(this.source.$textarea),this.core.element().on("destroy.callback.redactor",e.proxy((function(){this.source.$textarea.remove()}),this))},toggle:function(){return this.source.$textarea.hasClass("open")?this.source.hide():this.source.show()},setCaretOnShow:function(){},setCaretOnHide:function(e){return e},hide:function(){this.source.$textarea.removeClass("open").hide(),this.source.$textarea.off(".redactor-source");var e=this.source.$textarea.val();e=this.paragraphize.load(e),this.code.start(e),this.button.enableAll(),this.core.editor().show().focus(),this.selection.restore(),this.code.sync()},show:function(){var t,o;this.selection.save(),t=this.core.editor().innerHeight(),o=(o=(o=this.code.get()).replace(/\n\n\n/g,"\n")).replace(/\n\n/g,"\n"),this.core.editor().hide(),this.button.disableAll(["html","woltlabFullscreen"]),this.source.$textarea.val(o).height(t).addClass("open").show(),this.source.$textarea.on("keyup.redactor-source",e.proxy((function(){"textarea"===this.opts.type&&this.core.textarea().val(this.source.$textarea.val())}),this)),this.marker.remove(),e(window).scrollTop(scroll),this.source.$textarea[0].setSelectionRange&&this.source.$textarea[0].setSelectionRange(this.source.start,this.source.end),this.source.$textarea[0].scrollTop=0,setTimeout(e.proxy((function(){this.source.$textarea.focus(),this.button.setActive("html")}),this),0)},enlargeOffset:function(){}}}}(jQuery); })(this);

// plugins/table.js
(function (window, undefined) { !function(e){e.Redactor.prototype.table=function(){return{langs:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(){var e,t={};t.insert_table={title:this.lang.get("insert-table"),func:this.table.insert,observe:{element:"table",in:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_row_above={title:this.lang.get("insert-row-above"),func:this.table.addRowAbove,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_row_below={title:this.lang.get("insert-row-below"),func:this.table.addRowBelow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_column_left={title:this.lang.get("insert-column-left"),func:this.table.addColumnLeft,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_column_right={title:this.lang.get("insert-column-right"),func:this.table.addColumnRight,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.add_head={title:this.lang.get("add-head"),func:this.table.addHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_head={title:this.lang.get("delete-head"),func:this.table.deleteHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_column={title:this.lang.get("delete-column"),func:this.table.deleteColumn,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_row={title:this.lang.get("delete-row"),func:this.table.deleteRow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_table={title:this.lang.get("delete-table"),func:this.table.deleteTable,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e=this.button.addBefore("link","table",this.lang.get("table")),this.button.setIcon(e,'<i class="re-icon-table"></i>'),this.button.addDropdown(e,t)},insert:function(){var t,a,i,l,n,r,s,o,d,h;if(!this.table.getTable()){for(this.placeholder.hide(),t=2,a=3,i=e("<div>"),l=e("<table />"),n=0;n<t;n++){for(r=e("<tr>"),s=0;s<a;s++)o=e("<td>"+this.opts.invisibleSpace+"</td>"),0===n&&0===s&&o.append(this.marker.get()),e(r).append(o);l.append(r)}i.append(l),d=i.html(),this.buffer.set(),h=this.selection.current(),0!==e(h).closest("li",this.core.editor()[0]).length?e(h).closest("ul, ol").first().after(d):(this.air.collapsed(),this.insert.html(d)),this.selection.restore(),this.core.callback("insertedTable",l)}},getTable:function(){var t=e(this.selection.current()).closest("table");return!!this.utils.isRedactorParent(t)&&(0!==t.length&&t)},restoreAfterDelete:function(e){this.selection.restore(),e.find("span.redactor-selection-marker").remove()},deleteTable:function(){var e,t=this.table.getTable();t&&(this.buffer.set(),e=t.next(),this.opts.linebreaks||0===e.length?this.caret.after(t):this.caret.start(e),t.remove())},deleteRow:function(){var t,a,i,l,n=this.table.getTable();n&&(t=e(this.selection.current()),this.buffer.set(),(i=(a=t.closest("tr")).prev().length?a.prev():a.next()).length&&(l=i.children("td, th").first()).length&&l.prepend(this.marker.get()),a.remove(),this.table.restoreAfterDelete(n))},deleteColumn:function(){var t,a,i=this.table.getTable();i&&(this.buffer.set(),t=e(this.selection.current()).closest("td, th"),a=t[0].cellIndex,i.find("tr").each(e.proxy((function(t,i){var l=e(i),n=a-1<0?a+1:a-1;0===t&&l.find("td, th").eq(n).prepend(this.marker.get()),l.find("td, th").eq(a).remove()}),this)),this.table.restoreAfterDelete(i))},addHead:function(){var t,a=this.table.getTable();a&&(this.buffer.set(),0===a.find("thead").length?((t=a.find("tr").first().clone()).find("td").replaceWith(e.proxy((function(){return e("<th>").html(this.opts.invisibleSpace)}),this)),$thead=e("<thead></thead>").append(t),a.prepend($thead)):this.table.deleteHead())},deleteHead:function(){var e,t=this.table.getTable();t&&0!==(e=t.find("thead")).length&&(this.buffer.set(),e.remove())},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(t){var a,i,l=this.table.getTable();l&&(this.buffer.set(),(i=(a=e(this.selection.current()).closest("tr")).clone()).find("th").replaceWith((function(){var t=e("<td>");return t[0].attributes=this.attributes,t.append(e(this).contents())})),i.find("td").html(this.opts.invisibleSpace),"after"===t?a.after(i):a.before(i))},addColumn:function(t){var a,i,l,n,r=this.table.getTable();r&&(a=0,i=e(this.selection.current()),this.buffer.set(),l=i.closest("tr"),n=i.closest("td, th"),l.find("td, th").each(e.proxy((function(t,i){e(i)[0]===n[0]&&(a=t)}),this)),r.find("tr").each(e.proxy((function(i,l){var n=e(l).find("td, th").eq(a),r=n.clone();r.html(this.opts.invisibleSpace),"after"===t?n.after(r):n.before(r)}),this)))}}}}(jQuery); })(this);

